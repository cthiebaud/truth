import{Offcanvas as e,Carousel as t,Modal as s}from"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/+esm";import n from"https://cdn.jsdelivr.net/npm/bezier-easing@2.1.0/+esm";import i from"https://cdn.jsdelivr.net/npm/isotope-layout@3.0.6/+esm";import r from"https://cdn.jsdelivr.net/npm/showdown@2.1.0/+esm";import o from"https://cdn.jsdelivr.net/npm/tinycolor2@1.6.0/+esm";import{Howler as l,Howl as a}from"https://cdn.jsdelivr.net/npm/howler@2.2.4/+esm";class c{#e;#t;#s;#n;constructor(e,t,s){this.#e=e,this.#s=document.getElementById(t),this.#t=s,this.#n=new r.Converter({tables:!0,strikethrough:!0})}safeById=(e,t)=>{if(!e||!this.#s)return;const s=this.#s.querySelector("#"+e);return s?t(s):void 0};display(e){const t=this.#s.querySelector(".offcanvas-body");if(!t)throw new Exception("no element where to insert response text");const s=t.lastElementChild,n=this.#n.makeHtml(e);s?s.innerHTML=n:t.innerHTML=n,this.#s.querySelectorAll("table:not(.table)").forEach((e=>{e.classList.add("table","table-sm","table-borderless")})),this.#s.querySelectorAll("img").forEach((e=>{e.alt&&!(e.alt.includes("Android")||e.alt.includes("Apple")||e.alt.includes("example")||e.alt.includes("github"))&&e.classList.add("img-fluid")})),this.safeById("logic_symbols",(e=>{e.addEventListener("click",(e=>{e.preventDefault(),this.#s.classList.remove("javascript"),this.safeById("AetB",(e=>e.innerHTML="𝖠 ∧ 𝖡")),this.safeById("AouB",(e=>e.innerHTML="𝖠 ∨ 𝖡")),this.safeById("nonAounonB",(e=>e.innerHTML="¬𝖠 ∨ ¬𝖡"))}))})),this.safeById("javascript_expressions",(e=>{e.addEventListener("click",(e=>{e.preventDefault(),this.#s.classList.add("javascript"),this.safeById("AetB",(e=>e.innerHTML="α & β")),this.safeById("AouB",(e=>e.innerHTML="α | β")),this.safeById("nonAounonB",(e=>e.innerHTML="!α | !β"))}))}))}fetch(e){if(this.#t){const t=this,s=new XMLHttpRequest;s.open("GET",this.#t,!0),s.onreadystatechange=function(){4===s.readyState&&200===s.status&&(t.display(s.responseText),e&&e())},s.send()}return new this.#e(this.#s)}}class d{static safeGetElementByIdThen(e,t,...s){if(e){const n=document.getElementById(e);if(n)return t(n,...s)}}static normalizeVraiment(e,t,s,n,i){if(s===t)return 0;if(Math.abs(e-s)<Number.EPSILON)return i;return n+(i-n)*(e-t)/(s-t)}static isFiniteNumber(e){return isFinite(e)&&!isNaN(e)}static formatDuration(e,t="seconds"){if("seconds"!==t&&"milliseconds"!==t)throw new Error("Invalid 'type' parameter. 'type' must be either 'seconds' or 'milliseconds'.");if("seconds"===t&&(e*=1e3),6e5<=e)throw new Error(`Duration ${e} must be under 9′59″9999`);const s=Math.floor(e/6e4),n=Math.floor(e/1e3)%60;let i=s+"′"+String(n).padStart(2,"0")+"″";if("milliseconds"===t){const t=Math.floor(e%1e3);i+=String(t).padStart(4,"0")}return i}static shuffleArray(e){for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}}static toggleElementsVisibility(e,t){let s=null;for(let n of e)null==s&&(s=n.style.display!==t?t:"none"),n.style.display=s;return s}}class u{static mapNumberToColor(e){const t=[{value:120,color:"#00852B"},{value:60,color:"#1E5AA8"},{value:30,color:"#B40000"},{value:0,color:"#FF0000"}];if(t[0].value<e)return t[0].color;if(e<=t[t.length-1].value)return t[t.length-1].color;let s=null;for(let n=0;n<t.length-1;n++)if(t[n].value>=e&&e>t[n+1].value){s=n;break}if(null===s)return"#000000";const n=(e-t[s].value)/(t[s+1].value-t[s].value);return o.mix(t[s].color,t[s+1].color,100*n).toHexString()}constructor(){let e=["#F4F4F4","#FAC80A","#B40000","#00852B","#1E5AA8","#8A928D","#ABD9FF","#91501C","#545955"],t=Math.floor(Math.random()*e.length);this.colorTrue=e[t],this.colorFalse="transparent",e.splice(t,1),this.colors=[...e,...e],this.shuffleColors(4)}#i=4;#r=0;nextColor(){const e=this.colors[this.#r++];return this.#r%=this.colors.length,e}shuffleColors(e=this.#i){return this.colors=function(e,t){e.length;let s=[...e],n=new Map,i=[];for(let e=0;e<s.length;e++)n.has(s[e])?n.set(s[e],n.get(s[e])+1):n.set(s[e],1);if(t||(t=0),t<0||n.size<t)throw new Error("Invalid parameters: lengthOfNonConsecutiveColors should be a number greater or equal than zero and less than the length of possible colors array");let r=[];for(;;){let e,s=[];if(n.forEach(((e,t)=>{e>0&&!i.includes(t)&&s.push({value:t,remain:e})})),0===s.length&&n.forEach(((e,t)=>{e>0&&s.push({value:t,remain:e})})),0===s.length)break;if(1===s.length)e=s[0];else{let t=Math.floor(Math.random()*s.length);e=s[t]}r.push(e.value),i.push(e.value),i.length>t&&i.shift(),n.set(e.value,e.remain-1);let o=!0;if(n.forEach((e=>{e>0&&(o=!1)})),o)break}return r}(this.colors,e),this.colors}bg2color(e){return o(e).darken(3).toString("hex6")}}class h{static overlaySingleton=null;static getOrCreateOverlaySingleton(){return null==h.overlaySingleton&&(h.overlaySingleton=document.createElement("div"),h.overlaySingleton.classList.add("overlay"),h.overlaySingleton.style.display="none",document.body.appendChild(h.overlaySingleton),window.addEventListener("resize",(()=>{(new h).updateOverlayPosition()}))),h.overlaySingleton}#o;#l;constructor(e){this.#l=e,this.#o=h.getOrCreateOverlaySingleton()}show(){this.#o.style.display="block"}move(e){this.elementCoveredByOverlay=e,this.updateOverlayPosition()}hide(){this.#o.style.display="none"}clear(){this.#o.style.display="none",this.elementCoveredByOverlay=null}updateOverlayPosition(){if(null==this.elementCoveredByOverlay)return;const e=this.elementCoveredByOverlay.querySelectorAll(this.#l);if(0===e.length)return;let t=Number.MAX_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER;e.forEach((e=>{const r=e.getBoundingClientRect();t=Math.min(t,r.top),s=Math.min(s,r.left),n=Math.max(n,r.bottom),i=Math.max(i,r.right)}));const r=this.#o.parentElement.getBoundingClientRect();this.elementCoveredByOverlay.getBoundingClientRect();const o=this.#o.style;o.position="absolute",o.top=t-r.top+"px",o.left=s-r.left+"px",o.width=i-s+"px",o.height=n-t+"px"}}class m{constructor(e,t){if(this.swipeArea=document.getElementById(e),!this.swipeArea)throw new Error(`Element with id '${e}' not found.`);this.startX=0,this.startY=0,this.currentX=0,this.minY=0,this.maxY=0,this.touchThresholdX=150,this.touchThresholdY=80,this.swipeHandler=t,this.swipeArea.addEventListener("touchstart",this.handleTouchStart.bind(this),{passive:!1}),this.swipeArea.addEventListener("touchmove",this.handleTouchMove.bind(this),{passive:!1}),this.swipeArea.addEventListener("touchend",this.handleTouchEnd.bind(this),{passive:!1}),this.swipeElement=this.swipeArea,this.swipeElement.addEventListener("swipe",this.handleSwipe.bind(this))}handleTouchStart(e){this.startX=this.currentX=e.touches[0].clientX,this.startY=this.minY=this.maxY=e.touches[0].clientY}handleTouchMove(e){this.currentX=e.touches[0].clientX,this.minY=Math.min(this.minY,e.touches[0].clientY),this.maxY=Math.max(this.maxY,e.touches[0].clientY)}handleTouchEnd(e){if(!(this.startX&&this.currentX&&this.startY&&this.minY))return;const t=this.currentX-this.startX,s=this.maxY-this.minY;Math.abs(t)>this.touchThresholdX&&Math.abs(s)<this.touchThresholdY&&(t>0?this.fireSwipeEvent("swiperight"):this.fireSwipeEvent("swipeleft")),this.startX=this.currentX=void 0}fireSwipeEvent(e){const t=new CustomEvent("swipe",{detail:e});this.swipeElement.dispatchEvent(t)}handleSwipe(e){"function"==typeof this.swipeHandler&&this.swipeHandler(e.detail)}}class p{constructor(e,t,s={}){try{this.timerContainer=document.getElementById(t),this.timerContainer.disabled=!1,this.timerElementPlaying=this.timerContainer.querySelector(".timer-playing"),this.timerElementNotPlaying=this.timerContainer.querySelector(".timer-not-playing"),this.ticks=0,this.innerCircle1=this.timerElementPlaying.querySelector("#innerCircle1"),this.innerCircle2=this.timerElementPlaying.querySelector("#innerCircle2"),this.radius1=this.innerCircle1.getAttribute("r"),this.radius2=this.innerCircle2.getAttribute("r"),this.circonf1=2*this.radius1*Math.PI,this.circonf2=2*this.radius2*Math.PI,this.radius=this.timerElementPlaying.width/4,this.centerX=this.timerElementPlaying.width/2,this.centerY=this.timerElementPlaying.height/2,this.timerId=null,this.startTime=null,this.stopTime=null,this.totalTime=e,this.callbacks={onStart:()=>{},onTick:()=>{},onExpired:()=>{},onStop:()=>{},onClose:()=>{}},this.callbacks=Object.assign(this.callbacks,s)}catch(e){console.error(e)}}drawTimer(e){let t=(this.totalTime-e)/this.totalTime,s=t*this.circonf1,n=this.circonf1-s,i=t*this.circonf2,r=this.circonf2-i;innerCircle1.setAttribute("stroke-dasharray",`0 ${s} ${n}`),i-6>=0?(innerCircle2.setAttribute("stroke-dasharray",`0 3 ${i-6} ${r+3}`),innerCircle2.setAttribute("stroke-width",2)):innerCircle2.setAttribute("stroke-width",0)}updateTimer(e){const t=(e-this.startTime)/1e3,s=Math.max(this.totalTime-t,0);s>0?(this.drawTimer(s),this.timerId=requestAnimationFrame((e=>this.updateTimer(e)))):(clearInterval(this.showNumber),this.callbacks.onExpired())}start(e){e&&(this.totalTime=e),this.timerElementPlaying.style.display="block",this.timerElementNotPlaying.style.display="none",this.ticks=0,this.stopTime=null,this.startTime=performance.now(),this.timerId=requestAnimationFrame((e=>this.updateTimer(e,this.startTime))),this.callbacks.onStart(),this.callbacks.onTick(this.totalTime,this.ticks),this.showNumber=setInterval((()=>{this.callbacks.onTick(this.totalTime,++this.ticks)}),1e3)}stop(){return null!==this.stopTime||(clearInterval(this.showNumber),cancelAnimationFrame(this.timerId),this.timerId=null,this.callbacks.onStop(),this.stopTime=performance.now()-this.startTime),this.stopTime}close(){this.callbacks.onClose(),this.timerElementPlaying.style.display="none",this.timerElementNotPlaying.style.display="block"}}class y{static newHowl(e){if(!l.usingWebAudio)return{play:()=>{},fade:()=>{},stop:()=>{},volume:()=>{}};return new class extends a{constructor(e){super(e),this._initialVolume=e.volume}play(e){this._initialVolume&&this.volume(this._initialVolume),super.play(e)}fade(e,t,s,n){void 0===e&&(e=this.volume()),void 0===s&&(s=1e3),super.fade(e,t,s,n)}}(e)}constructor(){this.tortoise=y.newHowl({src:["/assets/audio/ticking.mp3"],loop:!0,volume:.5}),this.hare=y.newHowl({src:["/assets/audio/hare.mp3"],loop:!1,volume:.3}),this.achilles=y.newHowl({src:["/assets/audio/achilles-v9.mp3"],loop:!1,volume:.8}),this.underwater=y.newHowl({src:["/assets/audio/underwater-v2.mp3"],loop:!0,volume:.001}),this.coin=y.newHowl({src:["/assets/audio/coin.mp3"]}),this.laughs=y.newHowl({src:["/assets/audio/guitar-string-snap.mp3"],loop:!1,volume:.2}),this.tada=y.newHowl({src:["/assets/audio/tada.mp3"],loop:!1,volume:.8}),this.fail=y.newHowl({src:["/assets/audio/fail2.mp3"]}),this.completed_with_errors=y.newHowl({src:["/assets/audio/completed_with_errors.mp3"]}),this.boo=y.newHowl({src:["/assets/audio/boo.mp3"]}),this.guitar=y.newHowl({src:["/assets/audio/guitar-riff.mp3"]}),this.boredom=y.newHowl({src:["/assets/audio/boredom.mp3"]}),this.gong=y.newHowl({src:["/assets/audio/gong.mp3"],loop:!1,volume:.3}),this.abort=y.newHowl({src:["/assets/audio/short-whoosh.mp3"]}),this.riser=y.newHowl({src:["/assets/audio/scary-riser-v2.mp3"],loop:!1,volume:.67})}}class g{#a;constructor(e){this.#a=e}get value(){return this.#a}set value(e){"number"==typeof e?this.#a=e:console.error("Value must be a number")}increment(){const e=this.#a;return this.#a+=1,e}}class v{#c;#d;#u;#h;#m;#p;#y;constructor(e,t,s){this.#m=e,this.scrambled=t,this.displayMode=s,this.reset()}reset(){this.#c=void 0,this.#d=new g(1),this.#u=new g(0),this.#h=new g(0)}get level(){return this.#m}get scrambled(){return this.#y}set scrambled(e){if(void 0!==e)if(null===e||"boolean"==typeof e)this.#y=e;else if("string"==typeof e){const t=e.toLowerCase();this.#y="true"===t||"false"!==t&&!!e}else this.#y=!!e}get displayMode(){return this.#p}set displayMode(e){this.#p="𝖠"===e?"canonical":"α"===e?"javascript":null}get elapsed(){return this.#d}get erred(){return this.#u}get unconcealed(){return this.#h}get timerDuration(){return this.#c}set timerDuration(e){this.#c=e}get victory(){return 0===this.erred.value&&32===this.unconcealed.value}}const f=document.querySelector("head meta[name='truth-reservoir']"),b=f&&f.getAttribute("content")||"http://192.168.1.53:5000";console.log(b);const w=new class{constructor(e){this.baseUrl=e}async write(e){const t=await fetch(this.baseUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return await t.json()}async read(e={}){const t=new URL(this.baseUrl);Object.keys(e).forEach((s=>t.searchParams.append(s,e[s])));const s=await fetch(t);return await s.json()}async erase(e={}){const t=new URL(this.baseUrl);Object.keys(e).forEach((s=>t.searchParams.append(s,e[s])));const s=await fetch(t,{method:"DELETE"});return await s.text()}}(b);try{w.read({pseudo:"christophet60"}).then((e=>{console.log("GET response:",e),document.getElementById("console").innerHTML+=JSON.stringify(e)})).catch((e=>{console.error("GET error:",e),document.getElementById("console").innerHTML+=e}))}catch(e){console.error("GET error:",e),document.getElementById("console").innerHTML+=e}const E=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document;console.log(navigator.userAgent,`[${E?"":"NOT "}a iOS device]`);class T{#s;#g=n(.5,.2,.5,1);#v;#f;#b;constructor(){this.#s=document.querySelector(".compte-à-rebours"),this.#v=120,this.#b=600}get animationTimeInMilliseconds(){return this.#b}set animationTimeInMilliseconds(e){this.#b=e}get duration(){return this.#v}set duration(e){this.animateSetDuration(e)}animateSetDuration(e){let t=Number(e),s=this.duration;const n=performance.now(),i=()=>{const e=Math.min(performance.now()-n,this.#b),r=d.normalizeVraiment(e,0,this.#b,0,1),o=this.#g(r),l=s+o*(t-s);this._duration_=l,e<this.animationTimeInMilliseconds?requestAnimationFrame(i):this._duration_=t};cancelAnimationFrame(this.#f),this.#f=requestAnimationFrame(i)}set _duration_(e){if(!d.isFiniteNumber(e))throw new Error(`not a finite number: ${e} !`);this.#v=e,this.#s.style.color=u.mapNumberToColor(this.#v),this.#s.textContent=d.formatDuration(this.#v)}}let M=null;M=new class{#w;constructor(e){this.#w=document.getElementById(e)}get element(){return this.#w}set innerHTML(e){this.#w&&(this.#w.innerHTML=e)}}("tables");let S=null;S=new class{#E;constructor(){let e;document.getElementById("result-modal").addEventListener("hidden.bs.modal",(e=>{S.stop()})),this.restarting=!1,this._soundMachine=new y,document.getElementById("controls").style.visibility="visible",this.compteARebours=new T,this.compteARebours.duration=Number(document.querySelector(".carousel-item.active").dataset.time),this._timer=new p(this.compteARebours.duration,"play",{onStart:this.onTimerStart,onTick:this.onTimerTick,onExpired:this.onTimerExpired,onStop:this.onTimerStop,onClose:this.onTimerClose}),this.tortoiseHareAchilles=new t(document.getElementById("tortoise-hare-achilles"),{}),document.getElementById("tortoise-hare-achilles").addEventListener("slide.bs.carousel",(t=>{e=performance.now(),this.compteARebours.animateSetDuration(t.relatedTarget.dataset.time)})),document.getElementById("tortoise-hare-achilles").addEventListener("slid.bs.carousel",(t=>{e&&(this.compteARebours.animationTimeInMilliseconds=performance.now()-e);const s=document.getElementById("tortoise-hare-achilles"),n=s.querySelector(".carousel-item.active");s.style.opacity="1",s.querySelector(".carousel-control-next").disabled=!1,s.querySelector(".carousel-control-prev").disabled=!1,"tortoise"===n.id?s.querySelector(".carousel-control-prev").disabled=!0:"achilles"===n.id&&(s.querySelector(".carousel-control-next").disabled=!0)}))}get restarting(){return this.#E}set restarting(e){this.#E=e}get level(){return document.querySelector(".carousel-item.active").dataset.sound}stopTimerShowResultThenCloseTimer(e,t){S.result.timerDuration=S._timer.stop(),document.getElementById("result-msg").innerHTML=e,[...document.querySelectorAll("#cloche svg")].forEach((e=>{e.style.display="none"})),d.safeGetElementByIdThen("result-display-mode",((e,t)=>{e.innerHTML=t}),t.displayMode),document.getElementById(`result-level-${t.level}`).style.display="block",document.getElementById(`result-scrambled-${t.scrambled}`).style.display="block",document.getElementById("result-elapsed").innerHTML=d.formatDuration(t.timerDuration,"milliseconds"),document.getElementById("result-unconcealed").innerHTML=t.unconcealed.value,0!==t.erred.value?(document.getElementById("empty-set").style.display="none",document.getElementById("result-erred").innerHTML=t.erred.value):(document.getElementById("result-erred").innerHTML="",document.getElementById("empty-set").style.display="block");const n=new Date;const i=function(){const e=new Date;return`${e.getUTCFullYear()}-${String(e.getUTCMonth()+1).padStart(2,"0")}-${String(e.getUTCDate()).padStart(2,"0")}T${String(e.getUTCHours()).padStart(2,"0")}:${String(e.getUTCMinutes()).padStart(2,"0")}:${String(e.getUTCSeconds()).padStart(2,"0")}Z`}();d.safeGetElementByIdThen("result-timestamp",((e,t)=>{e.innerHTML=t}),n.toLocaleString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"}));const r={pseudo:"christophet60",level:t.level,elapsed:Math.round(t.timerDuration),erred:t.erred.value,revealed:t.unconcealed.value,symbol:t.displayMode,scrambled:t.scrambled,when:i};w.write(r).then((e=>{console.log("POST response:",e),document.getElementById("console").innerHTML+=JSON.stringify(e)})).catch((e=>{console.error("POST error:",e),document.getElementById("console").innerHTML+=e})),new s(document.getElementById("result-modal")).show()}onTimerStart(){S._soundMachine.underwater.play(),S._soundMachine[S.level].play()}onTimerTick(e,t){S.compteARebours.duration=e-t,S.result.elapsed.increment(),S.compteARebours.duration<=17&&!S._soundMachine.riser.playing()&&S._soundMachine.riser.play()}onTimerExpired(){requestAnimationFrame((()=>{let e;0===S.result.erred.value&&0===S.result.unconcealed.value?(S.boredom(),e="Rather quiet today, isn't it?"):(S.fail(),e="Time's up!"),S.stopTimerShowResultThenCloseTimer(e,S.result)}))}onTimerStop(){"achilles"===S.level?S.result.victory||S._soundMachine[S.level].fade(void 0,.001,2500):S._soundMachine[S.level].fade(void 0,.001),S._soundMachine.underwater.fade(void 0,.001),S._soundMachine.riser.fade(void 0,.001,1500)}onTimerClose(){document.getElementById("shuffle-all").disabled=!1,S.unveilBricks(),S._soundMachine[S.level].stop(),S._soundMachine.underwater.stop()}victory(){requestAnimationFrame((()=>{let e;S.result.erred.value>=32&&0===S.result.unconcealed.value?(S.guitar(),e="Ooooh&hellip; Subtle!"):0===S.result.erred.value&&32===S.result.unconcealed.value?("achilles"==S.level&&S.result.victory?S.gong():S.tada(),e="You won!"):S.result.erred.value>=28&&32===S.result.unconcealed.value?(S.boo(),e="You cheated?!"):(S.completed_with_errors(),e="You <i>quasi</i> won&hellip;"),S.stopTimerShowResultThenCloseTimer(e,S.result)}))}get isPlaying(){return document.getElementById("play").classList.contains("playing")}set isPlaying(e){this.isPlaying!==e&&(e?document.getElementById("play").classList.add("playing"):document.getElementById("play").classList.remove("playing"))}coin(){this._soundMachine.coin.play()}tada(){this._soundMachine.tada.play()}gong(){this._soundMachine.gong.play()}laughs(){this._soundMachine.laughs.play(),this.result.erred.increment()}fail(){this._soundMachine.fail.play()}abortSound(){this._soundMachine.abort.play()}completed_with_errors(){this._soundMachine.completed_with_errors.play()}boo(){this._soundMachine.boo.play()}guitar(){this._soundMachine.guitar.play()}boredom(){this._soundMachine.boredom.play()}veilBricks(){this.#T("veil")}unveilBricks(){this.restarting||this.#T("unveil")}async#T(e){const t="veil"===e;function s(e,t){return new Promise((s=>{e.parentNode.classList.remove("completed");const n=e.querySelectorAll("td");t?n.forEach((e=>{e.classList.contains("true")&&e.classList.add("concealed"),e.classList.remove("clicked")})):1!=S.isPlaying&&n.forEach((e=>{e.classList.contains("true")&&e.classList.remove("concealed"),e.classList.remove("clicked")})),setTimeout((()=>{s(e)}),20)}))}const n=[...document.querySelectorAll("#tables tbody")],i=Array.from({length:n.length},((e,t)=>t));d.shuffleArray(i);for(const e of i){const i=n[e];await s(i,t)}}start(){if(this.isPlaying)return;this.isPlaying=!0,this.result=new v(this.level,M.element.dataset.scrambled,C.displayMode.symbol),window.scrollTo({top:0,behavior:"smooth"}),this.veilBricks();const e=Number(document.querySelector(".carousel-item.active").dataset.time);this._timer.start(e),document.getElementById("shuffle-all").disabled=!0,document.getElementById("tortoise-hare-achilles").style.opacity=".5",document.querySelectorAll("#tortoise-hare-achilles button").forEach((e=>{e.disabled=!0})),this.result.reset(),this.restarting=!1}abort(){requestAnimationFrame((()=>{S.abortSound();S.stopTimerShowResultThenCloseTimer("You stopped!",S.result)}))}stop(){this.isPlaying=!1,this.compteARebours.duration=Number(document.querySelector(".carousel-item.active").dataset.time);const e=document.getElementById("tortoise-hare-achilles"),t=e.querySelector(".carousel-item.active");e.style.opacity="1",e.querySelector(".carousel-control-next").disabled=!1,e.querySelector(".carousel-control-prev").disabled=!1,"tortoise"===t.id?e.querySelector(".carousel-control-prev").disabled=!0:"achilles"===t.id&&(e.querySelector(".carousel-control-next").disabled=!0),this.result&&(this.result.timerDuration=this._timer.stop()),this._timer.close()}};const I=new class{constructor(){this.axesArray=[null,!0,!1],this.visible=!1,this.setCellWidth()}setCellWidth(){let e=61;this.visible&&(e=52);let t=Math.round(.7*e);document.documentElement.style.setProperty("--cell-width_and_height",`${e}px`),document.documentElement.style.setProperty("--cell-width_and_height-smaller",`${t}px`),document.documentElement.style.setProperty("--header-width_and_height","18px"),document.documentElement.style.setProperty("--border-color","#215c4d40")}iterate(e){this.axesArray.forEach(e)}applyVisibility(){(e=>{for(let t of e)t.style.display=this.visible?"table-cell":"none"})(document.querySelectorAll("#tables th"))}toggleVisibility(){const e=d.toggleElementsVisibility(document.querySelectorAll("#tables th"),"table-cell");return this.visible="none"!==e,this.setCellWidth(),this.visible}},L=new u;class B{constructor(e,t){this.c=0,this.colors=[e],t&&this.colors.push(t)}next(){const e=this.colors[this.c];return this.c=(this.c+1)%this.colors.length,e}}class A{static falseFunc="";static trueFunc="true";#M=[A.falseFunc,"α & β","α & !β","!α & !β","!α & β","α","β","!α","!β","α ^ β","α ^ !β","α | β","α | !β","!α | !β","!α | β",A.trueFunc];#p={canonical:{symbol:"𝖠",facade:"(𝖠,𝖡)",key:"canonical"},javascript:{symbol:"α",facade:"(α,β)",key:"javascript"}};#S="canonical";constructor(){const e="<span class='negation canonical'>𝖠</span>",t="<span class='negation canonical'>𝖡</span>";this.#M.forEach((s=>{if("string"==typeof s){const n=s;this.#p.javascript[n]=s.replace(/^$/g,"&nbsp;"),this.#p.canonical[n]=s.replace(/&/g,"∧").replace(/\|/g,"∨").replace(new RegExp(`^${A.trueFunc}$`),"⊤").replace(new RegExp(`^${A.falseFunc}$`),"⊥").replace(/\^/g,"⊻").replace(/(!?)α|(!?)β/g,((s,n,i)=>"!"===n?e:"!"===i?t:"α"===s?"𝖠":"𝖡"))}}))}static toAnonymous(e){return new Function("α","β",`return ${e};`)}iterate(e){this.#M.forEach(e)}getOneOrTwoColors(e){return e===A.falseFunc?new B(L.colorFalse):e===A.trueFunc?new B(L.colorTrue):e.includes("^")?new B(L.nextColor(),L.nextColor()):new B(L.nextColor())}toggleDisplayMode(){return this.#S="canonical"===this.#S?"javascript":"canonical",this.#S}get displayMode(){return this.#p[this.#S]}}const C=new A;let k;function P(e,t=!0){t?(M.element.dataset.scrambled=!0,k.shuffle()):(M.element.dataset.scrambled=!1,k.arrange({sortBy:"original-order"})),k.layout()}document.querySelector("#αβ > span").innerHTML=C.displayMode.facade;class _{#I=void 0;#L=null;constructor(e){this.#I=e,this.#L=null}blend(e,t){null===this.#L?this.#I.innerHTML=e:this.#L.insertAdjacentHTML("afterend",e),this.#L=document.getElementById(t)}}window.addEventListener("load",(t=>{const n=function(){if(S.isPlaying)return;const e=new _(M);C.iterate(((t,s)=>{const n=`element${s}`,i=`thead${s}`,r=`tbody${s}`,o=`<div id="${n}" class="ISOTOPE" data-function="${t}">\n<table class="table inline table-sm caption-top table-borderless">\n<caption class="text-center">${C.displayMode[t]}</caption>\n<thead id="${i}"></thead>\n<tbody id="${r}"></tbody>\n</table>\n</div>\n`;e.blend(o,n);let l=C.getOneOrTwoColors(t);I.iterate((e=>{const s=document.createElement("tr");I.iterate((n=>{const i=document.createElement(null===e||null===n?"th":"td");if(null===n)i.innerHTML=null===e?'<div class="diagonal-line">&nbsp;</div>':`<div class="vertical-text">${e}</div>`;else if(null===e)i.innerHTML=`${n}`;else{const s=A.toAnonymous(t)(e,n);i.classList.add(s?"true":"false"),s?(i.style.backgroundColor=l.next(),i.style.color=L.bg2color(i.style.backgroundColor),i.innerHTML=""):(i.style.backgroundColor=L.colorFalse,i.innerHTML="")}s.appendChild(i)})),document.getElementById(null===e?i:r).appendChild(s)})),I.applyVisibility()})),document.getElementById("aletheia").style.visibility="visible",document.querySelectorAll("#tables td").forEach((e=>{e.addEventListener("click",(t=>{if(t.preventDefault(),t.stopPropagation(),!S.isPlaying)return;if(e.classList.contains("concealed")){function i(e,t){for(;e=e.parentElement;)if(e.classList.contains(t))return e;return null}function r(e,t,s,n){const r=i(e,t);return r?{result:[...r.getElementsByClassName(s)].every((function(e){return!e.classList.contains(n)})),ancestor:r}:{result:!1,ancestor:void 0}}e.classList.remove("concealed"),S.result.unconcealed.increment();const o=r(e,"table","true","concealed");o.result&&(o.ancestor.classList.add("completed"),S.coin())}else e.classList.contains("false")&&(S.laughs(),e.classList.add("red-cross"),e.classList.add("clicked"),setTimeout((()=>{e.classList.remove("red-cross")}),1e3));let s=document.querySelectorAll("#tables td.true.concealed").length,n=document.querySelectorAll("#tables td.false.clicked").length;(0===s||n>=32&&32===s)&&S.victory()}))}));let t=null,s=new h("td"),n=null;function r(){t&&(clearTimeout(t),t=null),[...document.querySelectorAll(".hint")].forEach((e=>{e.classList.remove("hint"),n=null})),s.hide(),S._soundMachine.underwater.fade(void 0,.001,1500)}return window.addEventListener("scroll",(function(e){r()})),window.addEventListener("touchmove",(function(e){n&&!(n==e.target||e.target instanceof Node&&n.contains(e.target))&&r()})),window.addEventListener("touchend",(e=>{r()})),[...document.getElementsByTagName("caption")].forEach((e=>{e.addEventListener("touchstart",(t=>{S.isPlaying&&(n=e,t.preventDefault())})),e.addEventListener("pointerdown",(n=>{S.isPlaying&&(s.move(e.parentNode),s.show(),e.setPointerCapture(n.pointerId),S._soundMachine.underwater.fade(void 0,.4),t=setTimeout((()=>{n.target.parentNode.classList.add("hint"),n.target.parentNode.parentNode.classList.add("hint")}),300))})),e.addEventListener("pointerup",(t=>{r(),e.releasePointerCapture(t.pointerId)}))})),k=new i(M.element,{itemSelector:"div.ISOTOPE",layoutMode:"masonry",masonry:{columnWidth:10,fitWidth:!0}}),[...document.querySelectorAll("#tables>div")]}();function r(){S.isPlaying||P()}function o(){S.isPlaying||function(e){L.shuffleColors(),e.forEach((e=>{if(e.dataset.function){let t=C.getOneOrTwoColors(e.dataset.function);e.querySelectorAll("td.true").forEach((e=>{e.style.backgroundColor=t.next(),e.style.color=L.bg2color(e.style.backgroundColor)}))}}))}(n)}function l(){return function(e,t){if(!e)return;const s=document.getElementById(e);return s?t(s):void 0}("tables",(e=>e.classList.contains("transparent-border")?(e.classList.remove("transparent-border"),!1):(e.classList.add("transparent-border"),!0)))}function a(){return C.toggleDisplayMode(),"canonical"===C.displayMode.key?document.getElementById("main-id").classList.remove("javascript"):document.getElementById("main-id").classList.add("javascript"),document.getElementById("canonical-or-javascript.label").innerHTML=C.displayMode.symbol,document.querySelector("#αβ > span").innerHTML=C.displayMode.facade,document.querySelectorAll("#tables [data-function] caption").forEach((e=>{e.innerHTML=C.displayMode[e.parentNode.parentNode.dataset.function]})),"canonical"!==C.displayMode.key}document.getElementById("table-borders").addEventListener("click",(e=>{e.stopPropagation(),l()})),document.getElementById("ab-axes").addEventListener("click",(e=>{e.stopPropagation(),I.toggleVisibility()})),document.getElementById("canonical-or-javascript")?.addEventListener("click",(e=>{e.stopPropagation(),a()}));const d=new c(e,"offcanvas-right","/QUICK-GUIDE.md").fetch((()=>{console.log("/QUICK-GUIDE.md fetched")})),u=new c(e,"offcanvas-left","/WIP.md").fetch((()=>{console.log("/WIP.md fetched")}));function p(e){e.preventDefault(),e.stopPropagation(),S.isPlaying?S.abort():S.start()}function y(){S.restarting=!0,S.veilBricks();let e=document.getElementById("result-modal");e.addEventListener("hidden.bs.modal",(e=>{requestAnimationFrame((()=>{r(),S.start()}))}),{once:!0}),s.getInstance(e).hide()}new m("body-id",(function(e){"swiperight"===e?d._element.classList.contains("show")?d.hide():u._element.classList.contains("show")||u.show():"swipeleft"===e&&(u._element.classList.contains("show")?u.hide():d._element.classList.contains("show")||d.show())})),document.getElementById("shuffle-all").addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),r()})),document.getElementById("play").addEventListener("click",(e=>{p(e),document.activeElement?.blur()})),document.addEventListener("keyup",(function(e){{const e=document.getElementById("result-modal");if("none"!==window.getComputedStyle(e).getPropertyValue("display"))return void("Space"===event.code&&y())}switch(event.code){case"Space":p(e);break;case"Escape":S.isPlaying&&S.stop();break;case"KeyS":r();break;case"KeyO":S.isPlaying||P(0,!1);break;case"KeyC":o();break;case"KeyQ":document.getElementById("table-borders").checked=!l();break;case"KeyW":document.getElementById("ab-axes").checked=I.toggleVisibility();break;case"KeyA":document.getElementById("canonical-or-javascript").checked=a();break;case"ArrowRight":S.isPlaying||S.tortoiseHareAchilles.next();break;case"ArrowLeft":S.isPlaying||S.tortoiseHareAchilles.prev()}})),document.getElementById("play-again").addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),y()})),[...document.getElementsByClassName("carousel-item")].forEach((e=>{e.addEventListener("click",(e=>{if(e.preventDefault(),e.stopPropagation(),S.isPlaying)return;const t=e.target.getBoundingClientRect();event.clientX-t.left<t.width/2?S.tortoiseHareAchilles.prev():S.tortoiseHareAchilles.next()}))}))}));
