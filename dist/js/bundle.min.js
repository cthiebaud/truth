import{Offcanvas as e,Carousel as t,Modal as n}from"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/+esm";import s from"https://cdn.jsdelivr.net/npm/bezier-easing@2.1.0/+esm";import i from"https://cdn.jsdelivr.net/npm/isotope-layout@3.0.6/+esm";import o from"https://cdn.jsdelivr.net/npm/showdown@2.1.0/+esm";import r from"https://cdn.jsdelivr.net/npm/tinycolor2@1.6.0/+esm";import{Howler as l,Howl as a}from"https://cdn.jsdelivr.net/npm/howler@2.2.4/+esm";class c{#e;#t;#n;#s;constructor(e,t,n){this.#e=e,this.#n=document.getElementById(t),this.#t=n,this.#s=new o.Converter({tables:!0,strikethrough:!0})}safeById=(e,t)=>{if(!e||!this.#n)return;const n=this.#n.querySelector("#"+e);return n?t(n):void 0};display(e){const t=this.#n.querySelector(".offcanvas-body");if(!t)throw new Exception("no element where to insert response text");const n=t.lastElementChild,s=this.#s.makeHtml(e);n?n.innerHTML=s:t.innerHTML=s,this.#n.querySelectorAll("table:not(.table)").forEach((e=>{e.classList.add("table","table-sm","table-borderless")})),this.#n.querySelectorAll("img").forEach((e=>{e.alt&&!(e.alt.includes("Android")||e.alt.includes("Apple")||e.alt.includes("example")||e.alt.includes("github"))&&e.classList.add("img-fluid")})),this.safeById("logic_symbols",(e=>{e.addEventListener("click",(e=>{e.preventDefault(),this.#n.classList.remove("javascript"),this.safeById("AetB",(e=>e.innerHTML="𝖠 ∧ 𝖡")),this.safeById("AouB",(e=>e.innerHTML="𝖠 ∨ 𝖡")),this.safeById("nonAounonB",(e=>e.innerHTML="¬𝖠 ∨ ¬𝖡"))}))})),this.safeById("javascript_expressions",(e=>{e.addEventListener("click",(e=>{e.preventDefault(),this.#n.classList.add("javascript"),this.safeById("AetB",(e=>e.innerHTML="α & β")),this.safeById("AouB",(e=>e.innerHTML="α | β")),this.safeById("nonAounonB",(e=>e.innerHTML="!α | !β"))}))}))}fetch(e){if(this.#t){const t=this,n=new XMLHttpRequest;n.open("GET",this.#t,!0),n.onreadystatechange=function(){4===n.readyState&&200===n.status&&(t.display(n.responseText),e&&e())},n.send()}return new this.#e(this.#n)}}class d{static safeGetElementByIdThen(e,t,...n){if(e){const s=document.getElementById(e);if(s)return t(s,...n)}}static normalizeVraiment(e,t,n,s,i){if(n===t)return 0;if(Math.abs(e-n)<Number.EPSILON)return i;return s+(i-s)*(e-t)/(n-t)}static isFiniteNumber(e){return isFinite(e)&&!isNaN(e)}static formatReadableDateLong(e){return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}static formatReadableDate(e){const t=new Date(e),n=new Intl.DateTimeFormat("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}).format(t);return`${("0"+t.getDate()).slice(-2)} ${t.toLocaleString("en-US",{month:"short"})} ${t.getFullYear()} · ${n}`}static formatDuration(e,t="seconds"){if("seconds"!==t&&"milliseconds"!==t)throw new Error("Invalid 'type' parameter. 'type' must be either 'seconds' or 'milliseconds'.");if("seconds"===t&&(e*=1e3),6e5<=e)throw new Error(`Duration ${e} must be under 9′59″999`);const n=Math.floor(e/6e4),s=Math.floor(e/1e3)%60;let i=n+"′"+String(s).padStart(2,"0")+"″";if("milliseconds"===t){const t=Math.floor(e%1e3);i+=String(t).padStart(3,"0")}return i}static shuffleArray(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}}static toggleElementsVisibility(e,t){let n=null;for(let s of e)null==n&&(n=s.style.display!==t?t:"none"),s.style.display=n;return n}}class u{static mapNumberToColor(e){const t=[{value:120,color:"#00852B"},{value:60,color:"#1E5AA8"},{value:30,color:"#B40000"},{value:0,color:"#FF0000"}];if(t[0].value<e)return t[0].color;if(e<=t[t.length-1].value)return t[t.length-1].color;let n=null;for(let s=0;s<t.length-1;s++)if(t[s].value>=e&&e>t[s+1].value){n=s;break}if(null===n)return"#000000";const s=(e-t[n].value)/(t[n+1].value-t[n].value);return r.mix(t[n].color,t[n+1].color,100*s).toHexString()}constructor(){let e=["#F4F4F4","#FAC80A","#B40000","#00852B","#1E5AA8","#8A928D","#ABD9FF","#91501C","#545955"],t=Math.floor(Math.random()*e.length);this.colorTrue=e[t],this.colorFalse="transparent",e.splice(t,1),this.colors=[...e,...e],this.shuffleColors(4)}#i=4;#o=0;nextColor(){const e=this.colors[this.#o++];return this.#o%=this.colors.length,e}shuffleColors(e=this.#i){return this.colors=function(e,t){e.length;let n=[...e],s=new Map,i=[];for(let e=0;e<n.length;e++)s.has(n[e])?s.set(n[e],s.get(n[e])+1):s.set(n[e],1);if(t||(t=0),t<0||s.size<t)throw new Error("Invalid parameters: lengthOfNonConsecutiveColors should be a number greater or equal than zero and less than the length of possible colors array");let o=[];for(;;){let e,n=[];if(s.forEach(((e,t)=>{e>0&&!i.includes(t)&&n.push({value:t,remain:e})})),0===n.length&&s.forEach(((e,t)=>{e>0&&n.push({value:t,remain:e})})),0===n.length)break;if(1===n.length)e=n[0];else{let t=Math.floor(Math.random()*n.length);e=n[t]}o.push(e.value),i.push(e.value),i.length>t&&i.shift(),s.set(e.value,e.remain-1);let r=!0;if(s.forEach((e=>{e>0&&(r=!1)})),r)break}return o}(this.colors,e),this.colors}bg2color(e){return r(e).darken(3).toString("hex6")}}class h{static overlaySingleton=null;static getOrCreateOverlaySingleton(){return null==h.overlaySingleton&&(h.overlaySingleton=document.createElement("div"),h.overlaySingleton.classList.add("overlay"),h.overlaySingleton.style.display="none",document.body.appendChild(h.overlaySingleton),window.addEventListener("resize",(()=>{(new h).updateOverlayPosition()}))),h.overlaySingleton}#r;#l;constructor(e){this.#l=e,this.#r=h.getOrCreateOverlaySingleton()}show(){this.#r.style.display="block"}move(e){this.elementCoveredByOverlay=e,this.updateOverlayPosition()}hide(){this.#r.style.display="none"}clear(){this.#r.style.display="none",this.elementCoveredByOverlay=null}updateOverlayPosition(){if(null==this.elementCoveredByOverlay)return;const e=this.elementCoveredByOverlay.querySelectorAll(this.#l);if(0===e.length)return;let t=Number.MAX_SAFE_INTEGER,n=Number.MAX_SAFE_INTEGER,s=Number.MIN_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER;e.forEach((e=>{const o=e.getBoundingClientRect();t=Math.min(t,o.top),n=Math.min(n,o.left),s=Math.max(s,o.bottom),i=Math.max(i,o.right)}));const o=this.#r.parentElement.getBoundingClientRect();this.elementCoveredByOverlay.getBoundingClientRect();const r=this.#r.style;r.position="absolute",r.top=t-o.top+"px",r.left=n-o.left+"px",r.width=i-n+"px",r.height=s-t+"px"}}class m{constructor(e,t){if(this.swipeArea=document.getElementById(e),!this.swipeArea)throw new Error(`Element with id '${e}' not found.`);this.startX=0,this.startY=0,this.currentX=0,this.minY=0,this.maxY=0,this.touchThresholdX=150,this.touchThresholdY=80,this.swipeHandler=t,this.swipeArea.addEventListener("touchstart",this.handleTouchStart.bind(this),{passive:!1}),this.swipeArea.addEventListener("touchmove",this.handleTouchMove.bind(this),{passive:!1}),this.swipeArea.addEventListener("touchend",this.handleTouchEnd.bind(this),{passive:!1}),this.swipeElement=this.swipeArea,this.swipeElement.addEventListener("swipe",this.handleSwipe.bind(this))}handleTouchStart(e){this.startX=this.currentX=e.touches[0].clientX,this.startY=this.minY=this.maxY=e.touches[0].clientY}handleTouchMove(e){this.currentX=e.touches[0].clientX,this.minY=Math.min(this.minY,e.touches[0].clientY),this.maxY=Math.max(this.maxY,e.touches[0].clientY)}handleTouchEnd(e){if(!(this.startX&&this.currentX&&this.startY&&this.minY))return;const t=this.currentX-this.startX,n=this.maxY-this.minY;Math.abs(t)>this.touchThresholdX&&Math.abs(n)<this.touchThresholdY&&(t>0?this.fireSwipeEvent("swiperight"):this.fireSwipeEvent("swipeleft")),this.startX=this.currentX=void 0}fireSwipeEvent(e){const t=new CustomEvent("swipe",{detail:e});this.swipeElement.dispatchEvent(t)}handleSwipe(e){"function"==typeof this.swipeHandler&&this.swipeHandler(e.detail)}}class p{constructor(e,t,n={}){try{this.timerContainer=document.getElementById(t),this.timerContainer.disabled=!1,this.timerElementPlaying=this.timerContainer.querySelector(".timer-playing"),this.timerElementNotPlaying=this.timerContainer.querySelector(".timer-not-playing"),this.ticks=0,this.innerCircle1=this.timerElementPlaying.querySelector("#innerCircle1"),this.innerCircle2=this.timerElementPlaying.querySelector("#innerCircle2"),this.radius1=this.innerCircle1.getAttribute("r"),this.radius2=this.innerCircle2.getAttribute("r"),this.circonf1=2*this.radius1*Math.PI,this.circonf2=2*this.radius2*Math.PI,this.radius=this.timerElementPlaying.width/4,this.centerX=this.timerElementPlaying.width/2,this.centerY=this.timerElementPlaying.height/2,this.timerId=null,this.startTime=null,this.stopTime=null,this.totalTime=e,this.callbacks={onStart:()=>{},onTick:()=>{},onExpired:()=>{},onStop:()=>{},onClose:()=>{}},this.callbacks=Object.assign(this.callbacks,n)}catch(e){console.error(e)}}drawTimer(e){let t=(this.totalTime-e)/this.totalTime,n=t*this.circonf1,s=this.circonf1-n,i=t*this.circonf2,o=this.circonf2-i;innerCircle1.setAttribute("stroke-dasharray",`0 ${n} ${s}`),i-6>=0?(innerCircle2.setAttribute("stroke-dasharray",`0 3 ${i-6} ${o+3}`),innerCircle2.setAttribute("stroke-width",2)):innerCircle2.setAttribute("stroke-width",0)}updateTimer(e){const t=(e-this.startTime)/1e3,n=Math.max(this.totalTime-t,0);n>0?(this.drawTimer(n),this.timerId=requestAnimationFrame((e=>this.updateTimer(e)))):(clearInterval(this.showNumber),this.callbacks.onExpired())}start(e){e&&(this.totalTime=e),this.timerElementPlaying.style.display="block",this.timerElementNotPlaying.style.display="none",this.ticks=0,this.stopTime=null,this.startTime=performance.now(),this.timerId=requestAnimationFrame((e=>this.updateTimer(e,this.startTime))),this.callbacks.onStart(),this.callbacks.onTick(this.totalTime,this.ticks),this.showNumber=setInterval((()=>{this.callbacks.onTick(this.totalTime,++this.ticks)}),1e3)}stop(){return null!==this.stopTime||(clearInterval(this.showNumber),cancelAnimationFrame(this.timerId),this.timerId=null,this.callbacks.onStop(),this.stopTime=performance.now()-this.startTime),this.stopTime}close(){this.callbacks.onClose(),this.timerElementPlaying.style.display="none",this.timerElementNotPlaying.style.display="block"}}class y{static newHowl(e){if(!l.usingWebAudio)return{play:()=>{},fade:()=>{},stop:()=>{},volume:()=>{}};return new class extends a{constructor(e){super(e),this._initialVolume=e.volume}play(e){this._initialVolume&&this.volume(this._initialVolume),super.play(e)}fade(e,t,n,s){void 0===e&&(e=this.volume()),void 0===n&&(n=1e3),super.fade(e,t,n,s)}}(e)}constructor(){this.tortoise=y.newHowl({src:["/assets/audio/ticking.mp3"],loop:!0,volume:.5}),this.hare=y.newHowl({src:["/assets/audio/hare.mp3"],loop:!1,volume:.3}),this.achilles=y.newHowl({src:["/assets/audio/achilles-v9.mp3"],loop:!1,volume:.8}),this.underwater=y.newHowl({src:["/assets/audio/underwater-v2.mp3"],loop:!0,volume:.001}),this.coin=y.newHowl({src:["/assets/audio/coin.mp3"]}),this.laughs=y.newHowl({src:["/assets/audio/guitar-string-snap.mp3"],loop:!1,volume:.2}),this.tada=y.newHowl({src:["/assets/audio/tada.mp3"],loop:!1,volume:.8}),this.fail=y.newHowl({src:["/assets/audio/fail2.mp3"]}),this.completed_with_errors=y.newHowl({src:["/assets/audio/completed_with_errors.mp3"]}),this.boo=y.newHowl({src:["/assets/audio/boo.mp3"]}),this.guitar=y.newHowl({src:["/assets/audio/guitar-riff.mp3"]}),this.boredom=y.newHowl({src:["/assets/audio/boredom.mp3"]}),this.gong=y.newHowl({src:["/assets/audio/gong.mp3"],loop:!1,volume:.3}),this.abort=y.newHowl({src:["/assets/audio/short-whoosh.mp3"]}),this.riser=y.newHowl({src:["/assets/audio/scary-riser-v2.mp3"],loop:!1,volume:.67})}}class g{#a;constructor(e){this.#a=e}get value(){return this.#a}set value(e){"number"==typeof e?this.#a=e:console.error("Value must be a number")}increment(){const e=this.#a;return this.#a+=1,e}}class v{#c;#d;#u;#h;#m;#p;#y;constructor(e,t,n){this.#m=e,this.scrambled=t,this.displayMode=n,this.reset()}reset(){this.#c=void 0,this.#d=new g(1),this.#u=new g(0),this.#h=new g(0)}get level(){return this.#m}get scrambled(){return this.#y}set scrambled(e){if(void 0!==e)if(null===e||"boolean"==typeof e)this.#y=e;else if("string"==typeof e){const t=e.toLowerCase();this.#y="true"===t||"false"!==t&&!!e}else this.#y=!!e}get displayMode(){return this.#p}set displayMode(e){this.#p="𝖠"===e?"canonical":"α"===e?"javascript":null}get elapsed(){return this.#d}get erred(){return this.#u}get unconcealed(){return this.#h}get timerDuration(){return this.#c}set timerDuration(e){this.#c=e}get victory(){return 0===this.erred.value&&32===this.unconcealed.value}}function f(e){var t=new Date;t.setDate(t.getDate()+365),document.cookie=`sessionId=${e}; expires=${t.toUTCString()}; path=/`}class b{#g;#v;constructor(e){this.#g=e,this.fetchSessionId().then((e=>{this.setSessionId(e)}))}changeSessionId(e){f(e),this.setSessionId(e)}setSessionId(e){this.#v=e,document.getElementById("session-id").innerText=this.#v}fetchSessionId(){return new Promise(((e,t)=>{const n=function(){const e=document.cookie.split("; ");for(const t of e){const[e,n]=t.split("=");if("sessionId"===e)return n}return null}();if(n)e(n);else{const n=new URL(this.#g+"/sessionId");fetch(n).then((e=>e.json())).then((t=>{const n=t.sessionId;f(n),e(n)})).catch((e=>{t(e+" - at url "+n)}))}}))}write(e){return new Promise(((t,n)=>{fetch(this.#g,{method:"POST",headers:{"Content-Type":"application/json","Session-Id":this.#v},body:JSON.stringify(e)}).then((e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()})).then((e=>{t(e)})).catch((e=>{n(e)}))}))}best(){return new Promise(((e,t)=>{const n=new URL(this.#g+"/bests");fetch(n).then((t=>{if(204===t.status)e();else if(!t.ok)throw new Error("Network response was not ok");return t.json()})).then((t=>{e(t)})).catch((e=>{t(e)}))}))}read(e={}){return new Promise(((t,n)=>{const s=new URL(this.#g);Object.keys(e).forEach((t=>s.searchParams.append(t,e[t]))),fetch(s).then((e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()})).then((e=>{t(e)})).catch((e=>{n(e)}))}))}erase(e={}){return new Promise(((t,n)=>{const s=new URL(this.#g);Object.keys(e).forEach((t=>s.searchParams.append(t,e[t]))),fetch(s,{method:"DELETE"}).then((e=>{if(!e.ok)throw new Error("Network response was not ok");return e.text()})).then((e=>{t(e)})).catch((e=>{n(e)}))}))}}function w(e,t){if(!e)return;const n=document.getElementById(e);return n?t(n):void 0}let E=!1,T=null;function S(){try{T.best().then((e=>{void 0!==e?e.forEach((e=>{console.log(e);const t=`${e.scrambled?"scrambled-true":"scrambled-false"}-${e.level}`;w(`result-elapsed-${t}`,(t=>{t.innerHTML=d.formatDuration(e.elapsed,"milliseconds")})),w(`result-pseudo-${t}`,(t=>{t.innerHTML=e.sessionId})),w(`result-when-${t}`,(t=>{t.innerHTML=d.formatReadableDate(e.when)}))})):console.log("GET response ok, but with no data (204)")})).catch((e=>{console.log("GET error:",e)}))}catch(e){console.error("GET error:",e)}}const I=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document;console.log(navigator.userAgent,`[${I?"":"NOT "}a iOS device]`);class M{#n;#f=s(.5,.2,.5,1);#b;#w;#E;constructor(){this.#n=document.querySelector(".compte-à-rebours"),this.#b=120,this.#E=600}get animationTimeInMilliseconds(){return this.#E}set animationTimeInMilliseconds(e){this.#E=e}get duration(){return this.#b}set duration(e){this.animateSetDuration(e)}animateSetDuration(e){let t=Number(e),n=this.duration;const s=performance.now(),i=()=>{const e=Math.min(performance.now()-s,this.#E),o=d.normalizeVraiment(e,0,this.#E,0,1),r=this.#f(o),l=n+r*(t-n);this._duration_=l,e<this.animationTimeInMilliseconds?requestAnimationFrame(i):this._duration_=t};cancelAnimationFrame(this.#w),this.#w=requestAnimationFrame(i)}set _duration_(e){if(!d.isFiniteNumber(e))throw new Error(`not a finite number: ${e} !`);this.#b=e,this.#n.style.color=u.mapNumberToColor(this.#b),this.#n.textContent=d.formatDuration(this.#b)}}let L=null;L=new class{#T;constructor(e){this.#T=document.getElementById(e)}get element(){return this.#T}set innerHTML(e){this.#T&&(this.#T.innerHTML=e)}}("tables");let k=null;k=new class{#S;constructor(){let e;document.getElementById("result-modal").addEventListener("hidden.bs.modal",(e=>{k.stop()})),this.restarting=!1,this._soundMachine=new y,document.getElementById("controls").style.visibility="visible",this.compteARebours=new M,this.compteARebours.duration=Number(document.querySelector(".carousel-item.active").dataset.time),this._timer=new p(this.compteARebours.duration,"play",{onStart:this.onTimerStart,onTick:this.onTimerTick,onExpired:this.onTimerExpired,onStop:this.onTimerStop,onClose:this.onTimerClose}),this.tortoiseHareAchilles=new t(document.getElementById("tortoise-hare-achilles"),{}),document.getElementById("tortoise-hare-achilles").addEventListener("slide.bs.carousel",(t=>{e=performance.now(),this.compteARebours.animateSetDuration(t.relatedTarget.dataset.time)})),document.getElementById("tortoise-hare-achilles").addEventListener("slid.bs.carousel",(t=>{e&&(this.compteARebours.animationTimeInMilliseconds=performance.now()-e);const n=document.getElementById("tortoise-hare-achilles"),s=n.querySelector(".carousel-item.active");n.style.opacity="1",n.querySelector(".carousel-control-next").disabled=!1,n.querySelector(".carousel-control-prev").disabled=!1,"tortoise"===s.id?n.querySelector(".carousel-control-prev").disabled=!0:"achilles"===s.id&&(n.querySelector(".carousel-control-next").disabled=!0)}))}get restarting(){return this.#S}set restarting(e){this.#S=e}get level(){return document.querySelector(".carousel-item.active").dataset.sound}stopTimerShowResultThenCloseTimer(e,t){k.result.timerDuration=k._timer.stop(),document.getElementById("result-msg").innerHTML=e,[...document.querySelectorAll("#cloche svg")].forEach((e=>{e.style.display="none"})),document.getElementById(`result-level-${t.level}`).style.display="block",document.getElementById(`result-scrambled-${t.scrambled}`).style.display="block",document.getElementById("result-elapsed").innerHTML=d.formatDuration(t.timerDuration,"milliseconds"),document.getElementById("result-unconcealed").innerHTML=t.unconcealed.value,0!==t.erred.value?(document.getElementById("empty-set").style.display="none",document.getElementById("result-erred").innerHTML=t.erred.value):(document.getElementById("result-erred").innerHTML="",document.getElementById("empty-set").style.display="block");const s=new Date;const i=function(){const e=new Date;return`${e.getUTCFullYear()}-${String(e.getUTCMonth()+1).padStart(2,"0")}-${String(e.getUTCDate()).padStart(2,"0")}T${String(e.getUTCHours()).padStart(2,"0")}:${String(e.getUTCMinutes()).padStart(2,"0")}:${String(e.getUTCSeconds()).padStart(2,"0")}.${String(e.getUTCMilliseconds()).padStart(3,"0")}Z`}();if(d.safeGetElementByIdThen("result-timestamp",((e,t)=>{e.innerHTML=t}),s.toLocaleString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"})),!E&&T){const e={pseudo:E?"christophe":"anonymous",level:t.level,elapsed:Math.round(t.timerDuration),erred:t.erred.value,unconcealed:t.unconcealed.value,victory:0===t.erred.value&&32===t.unconcealed.value,symbol:t.displayMode,scrambled:t.scrambled,when:i};T.write(e).then((e=>{console.log("POST response:",e),S()})).catch((e=>{console.log("POST error:",e)}))}new n(document.getElementById("result-modal")).show()}onTimerStart(){k._soundMachine.underwater.play(),k._soundMachine[k.level].play()}onTimerTick(e,t){k.compteARebours.duration=e-t,k.result.elapsed.increment(),k.compteARebours.duration<=17&&!k._soundMachine.riser.playing()&&k._soundMachine.riser.play()}onTimerExpired(){requestAnimationFrame((()=>{let e;0===k.result.erred.value&&0===k.result.unconcealed.value?(k.boredom(),e="Rather quiet today, isn't it?"):(k.fail(),e="Time's up!"),k.stopTimerShowResultThenCloseTimer(e,k.result)}))}onTimerStop(){"achilles"===k.level?k.result.victory||k._soundMachine[k.level].fade(void 0,.001,2500):k._soundMachine[k.level].fade(void 0,.001),k._soundMachine.underwater.fade(void 0,.001),k._soundMachine.riser.fade(void 0,.001,1500)}onTimerClose(){document.getElementById("shuffle-all").disabled=!1,k.unveilBricks(),k._soundMachine[k.level].stop(),k._soundMachine.underwater.stop()}victory(){requestAnimationFrame((()=>{let e;k.result.erred.value>=32&&0===k.result.unconcealed.value?(k.guitar(),e="Ooooh&hellip; Subtle!"):0===k.result.erred.value&&32===k.result.unconcealed.value?("achilles"==k.level&&k.result.victory?k.gong():k.tada(),e="You won!"):k.result.erred.value>=28&&32===k.result.unconcealed.value?(k.boo(),e="You cheated?!"):(k.completed_with_errors(),e="You <i>quasi</i> won&hellip;"),k.stopTimerShowResultThenCloseTimer(e,k.result)}))}get isPlaying(){return document.getElementById("play").classList.contains("playing")}set isPlaying(e){this.isPlaying!==e&&(e?document.getElementById("play").classList.add("playing"):document.getElementById("play").classList.remove("playing"))}coin(){this._soundMachine.coin.play()}tada(){this._soundMachine.tada.play()}gong(){this._soundMachine.gong.play()}laughs(){this._soundMachine.laughs.play(),this.result.erred.increment()}fail(){this._soundMachine.fail.play()}abortSound(){this._soundMachine.abort.play()}completed_with_errors(){this._soundMachine.completed_with_errors.play()}boo(){this._soundMachine.boo.play()}guitar(){this._soundMachine.guitar.play()}boredom(){this._soundMachine.boredom.play()}veilBricks(){this.#I("veil")}unveilBricks(){this.restarting||this.#I("unveil")}async#I(e){const t="veil"===e;function n(e,t){return new Promise((n=>{e.parentNode.classList.remove("completed");const s=e.querySelectorAll("td");t?s.forEach((e=>{e.classList.contains("true")&&e.classList.add("concealed"),e.classList.remove("clicked")})):1!=k.isPlaying&&s.forEach((e=>{e.classList.contains("true")&&e.classList.remove("concealed"),e.classList.remove("clicked")})),setTimeout((()=>{n(e)}),20)}))}const s=[...document.querySelectorAll("#tables tbody")],i=Array.from({length:s.length},((e,t)=>t));d.shuffleArray(i);for(const e of i){const i=s[e];await n(i,t)}}start(){if(this.isPlaying)return;this.isPlaying=!0,this.result=new v(this.level,L.element.dataset.scrambled,_.displayMode.symbol),window.scrollTo({top:0,behavior:"smooth"}),this.veilBricks();const e=Number(document.querySelector(".carousel-item.active").dataset.time);this._timer.start(e),document.getElementById("shuffle-all").disabled=!0,document.getElementById("tortoise-hare-achilles").style.opacity=".5",document.querySelectorAll("#tortoise-hare-achilles button").forEach((e=>{e.disabled=!0})),this.result.reset(),this.restarting=!1}abort(){requestAnimationFrame((()=>{k.abortSound();k.stopTimerShowResultThenCloseTimer("You stopped!",k.result)}))}stop(){this.isPlaying=!1,this.compteARebours.duration=Number(document.querySelector(".carousel-item.active").dataset.time);const e=document.getElementById("tortoise-hare-achilles"),t=e.querySelector(".carousel-item.active");e.style.opacity="1",e.querySelector(".carousel-control-next").disabled=!1,e.querySelector(".carousel-control-prev").disabled=!1,"tortoise"===t.id?e.querySelector(".carousel-control-prev").disabled=!0:"achilles"===t.id&&(e.querySelector(".carousel-control-next").disabled=!0),this.result&&(this.result.timerDuration=this._timer.stop()),this._timer.close()}};const C=new class{constructor(){this.axesArray=[null,!0,!1],this.visible=!1,this.setCellWidth()}setCellWidth(){let e=61;this.visible&&(e=52);let t=Math.round(.7*e);document.documentElement.style.setProperty("--cell-width_and_height",`${e}px`),document.documentElement.style.setProperty("--cell-width_and_height-smaller",`${t}px`),document.documentElement.style.setProperty("--header-width_and_height","18px"),document.documentElement.style.setProperty("--border-color","#215c4d40")}iterate(e){this.axesArray.forEach(e)}applyVisibility(){(e=>{for(let t of e)t.style.display=this.visible?"table-cell":"none"})(document.querySelectorAll("#tables th"))}toggleVisibility(){const e=d.toggleElementsVisibility(document.querySelectorAll("#tables th"),"table-cell");return this.visible="none"!==e,this.setCellWidth(),this.visible}},A=new u;class B{constructor(e,t){this.c=0,this.colors=[e],t&&this.colors.push(t)}next(){const e=this.colors[this.c];return this.c=(this.c+1)%this.colors.length,e}}class P{static falseFunc="";static trueFunc="true";#M=[P.falseFunc,"α & β","α & !β","!α & !β","!α & β","α","β","!α","!β","α ^ β","α ^ !β","α | β","α | !β","!α | !β","!α | β",P.trueFunc];#p={canonical:{symbol:"𝖠",facade:"(𝖠,𝖡)",key:"canonical"},javascript:{symbol:"α",facade:"(α,β)",key:"javascript"}};#L="canonical";constructor(){const e="<span class='negation canonical'>𝖠</span>",t="<span class='negation canonical'>𝖡</span>";this.#M.forEach((n=>{if("string"==typeof n){const s=n;this.#p.javascript[s]=n.replace(/^$/g,"&nbsp;"),this.#p.canonical[s]=n.replace(/&/g,"∧").replace(/\|/g,"∨").replace(new RegExp(`^${P.trueFunc}$`),"⊤").replace(new RegExp(`^${P.falseFunc}$`),"⊥").replace(/\^/g,"⊻").replace(/(!?)α|(!?)β/g,((n,s,i)=>"!"===s?e:"!"===i?t:"α"===n?"𝖠":"𝖡"))}}))}static toAnonymous(e){return new Function("α","β",`return ${e};`)}iterate(e){this.#M.forEach(e)}getOneOrTwoColors(e){return e===P.falseFunc?new B(A.colorFalse):e===P.trueFunc?new B(A.colorTrue):e.includes("^")?new B(A.nextColor(),A.nextColor()):new B(A.nextColor())}toggleDisplayMode(){return this.#L="canonical"===this.#L?"javascript":"canonical",this.#L}get displayMode(){return this.#p[this.#L]}}const _=new P;let x;function D(e,t=!0){t?(L.element.dataset.scrambled=!0,x.shuffle()):(L.element.dataset.scrambled=!1,x.arrange({sortBy:"original-order"})),x.layout()}document.querySelector("#αβ > span").innerHTML=_.displayMode.facade;class H{#k=void 0;#C=null;constructor(e){this.#k=e,this.#C=null}blend(e,t){null===this.#C?this.#k.innerHTML=e:this.#C.insertAdjacentHTML("afterend",e),this.#C=document.getElementById(t)}}window.addEventListener("load",(t=>{const s=function(){if(k.isPlaying)return;const e=new H(L);_.iterate(((t,n)=>{const s=`element${n}`,i=`thead${n}`,o=`tbody${n}`,r=`<div id="${s}" class="ISOTOPE" data-function="${t}">\n<table class="table inline table-sm caption-top table-borderless">\n<caption class="text-center">${_.displayMode[t]}</caption>\n<thead id="${i}"></thead>\n<tbody id="${o}"></tbody>\n</table>\n</div>\n`;e.blend(r,s);let l=_.getOneOrTwoColors(t);C.iterate((e=>{const n=document.createElement("tr");C.iterate((s=>{const i=document.createElement(null===e||null===s?"th":"td");if(null===s)i.innerHTML=null===e?'<div class="diagonal-line">&nbsp;</div>':`<div class="vertical-text">${e}</div>`;else if(null===e)i.innerHTML=`${s}`;else{const n=P.toAnonymous(t)(e,s);i.classList.add(n?"true":"false"),n?(i.style.backgroundColor=l.next(),i.style.color=A.bg2color(i.style.backgroundColor),i.innerHTML=""):(i.style.backgroundColor=A.colorFalse,i.innerHTML="")}n.appendChild(i)})),document.getElementById(null===e?i:o).appendChild(n)})),C.applyVisibility()})),document.getElementById("aletheia").style.visibility="visible",document.querySelectorAll("#tables td").forEach((e=>{e.addEventListener("click",(t=>{if(t.preventDefault(),t.stopPropagation(),!k.isPlaying)return;if(e.classList.contains("concealed")){function i(e,t){for(;e=e.parentElement;)if(e.classList.contains(t))return e;return null}function o(e,t,n,s){const o=i(e,t);return o?{result:[...o.getElementsByClassName(n)].every((function(e){return!e.classList.contains(s)})),ancestor:o}:{result:!1,ancestor:void 0}}e.classList.remove("concealed"),k.result.unconcealed.increment();const r=o(e,"table","true","concealed");r.result&&(r.ancestor.classList.add("completed"),k.coin())}else e.classList.contains("false")&&(k.laughs(),e.classList.add("red-cross"),e.classList.add("clicked"),setTimeout((()=>{e.classList.remove("red-cross")}),1e3));let n=document.querySelectorAll("#tables td.true.concealed").length,s=document.querySelectorAll("#tables td.false.clicked").length;(0===n||s>=32&&32===n)&&k.victory()}))}));let t=null,n=new h("td"),s=null;function o(){t&&(clearTimeout(t),t=null),[...document.querySelectorAll(".hint")].forEach((e=>{e.classList.remove("hint"),s=null})),n.hide(),k._soundMachine.underwater.fade(void 0,.001,1500)}return window.addEventListener("scroll",(function(e){o()})),window.addEventListener("touchmove",(function(e){s&&!(s==e.target||e.target instanceof Node&&s.contains(e.target))&&o()})),window.addEventListener("touchend",(e=>{o()})),[...document.getElementsByTagName("caption")].forEach((e=>{e.addEventListener("touchstart",(t=>{k.isPlaying&&(s=e,t.preventDefault())})),e.addEventListener("pointerdown",(s=>{k.isPlaying&&(n.move(e.parentNode),n.show(),e.setPointerCapture(s.pointerId),k._soundMachine.underwater.fade(void 0,.4),t=setTimeout((()=>{s.target.parentNode.classList.add("hint"),s.target.parentNode.parentNode.classList.add("hint")}),300))})),e.addEventListener("pointerup",(t=>{o(),e.releasePointerCapture(t.pointerId)}))})),x=new i(L.element,{itemSelector:"div.ISOTOPE",layoutMode:"masonry",masonry:{columnWidth:10,fitWidth:!0}}),[...document.querySelectorAll("#tables>div")]}();function o(){k.isPlaying||D()}function r(){k.isPlaying||function(e){A.shuffleColors(),e.forEach((e=>{if(e.dataset.function){let t=_.getOneOrTwoColors(e.dataset.function);e.querySelectorAll("td.true").forEach((e=>{e.style.backgroundColor=t.next(),e.style.color=A.bg2color(e.style.backgroundColor)}))}}))}(s)}function l(){return w("tables",(e=>e.classList.contains("transparent-border")?(e.classList.remove("transparent-border"),!1):(e.classList.add("transparent-border"),!0)))}function a(){return _.toggleDisplayMode(),"canonical"===_.displayMode.key?document.getElementById("main-id").classList.remove("javascript"):document.getElementById("main-id").classList.add("javascript"),document.getElementById("canonical-or-javascript.label").innerHTML=_.displayMode.symbol,document.querySelector("#αβ > span").innerHTML=_.displayMode.facade,document.querySelectorAll("#tables [data-function] caption").forEach((e=>{e.innerHTML=_.displayMode[e.parentNode.parentNode.dataset.function]})),"canonical"!==_.displayMode.key}document.getElementById("table-borders").addEventListener("click",(e=>{e.stopPropagation(),l()})),document.getElementById("ab-axes").addEventListener("click",(e=>{e.stopPropagation(),C.toggleVisibility()})),document.getElementById("canonical-or-javascript")?.addEventListener("click",(e=>{e.stopPropagation(),a()}));const d=new c(e,"offcanvas-right","/QUICK-GUIDE.md").fetch((()=>{console.log("/QUICK-GUIDE.md fetched")})),u=new c(e,"offcanvas-left").fetch((()=>{console.log("/WIP.md fetched")}));function p(e){e.preventDefault(),e.stopPropagation(),k.isPlaying?k.abort():k.start()}function y(){k.restarting=!0,k.veilBricks();let e=document.getElementById("result-modal");e.addEventListener("hidden.bs.modal",(e=>{requestAnimationFrame((()=>{o(),k.start()}))}),{once:!0}),n.getInstance(e).hide()}new m("body-id",(function(e){"swiperight"===e?d._element.classList.contains("show")?d.hide():u._element.classList.contains("show")||u.show():"swipeleft"===e&&(u._element.classList.contains("show")?u.hide():d._element.classList.contains("show")||d.show())})),document.getElementById("shuffle-all").addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),o()})),document.getElementById("play").addEventListener("click",(e=>{p(e),document.activeElement?.blur()})),document.addEventListener("keyup",(function(e){{const t=document.getElementById("result-modal");if("none"!==window.getComputedStyle(t).getPropertyValue("display"))return void("Space"===e.code&&y())}switch(event.code){case"Space":p(e);break;case"Escape":k.isPlaying&&k.stop();break;case"KeyS":o();break;case"KeyO":k.isPlaying||D(0,!1);break;case"KeyC":r();break;case"KeyQ":document.getElementById("table-borders").checked=!l();break;case"KeyW":document.getElementById("ab-axes").checked=C.toggleVisibility();break;case"KeyA":document.getElementById("canonical-or-javascript").checked=a();break;case"ArrowRight":k.isPlaying||k.tortoiseHareAchilles.next();break;case"ArrowLeft":k.isPlaying||k.tortoiseHareAchilles.prev()}})),document.getElementById("play-again").addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),y()})),[...document.getElementsByClassName("carousel-item")].forEach((e=>{e.addEventListener("click",(e=>{if(e.preventDefault(),e.stopPropagation(),k.isPlaying)return;const t=e.target.getBoundingClientRect();event.clientX-t.left<t.width/2?k.tortoiseHareAchilles.prev():k.tortoiseHareAchilles.next()}))}));let g=0;let v;document.getElementById("αβ").addEventListener("click",(function(){v&&clearTimeout(v),g++,7===g?(E=!0,alert("Admin role granted! Your scores will not be saved."),g=0):v=setTimeout((()=>{g=0}),1e4)}));const f=document.querySelector("head meta[name='truth-reservoir']"),I=f&&f.getAttribute("content")||"http://192.168.1.53:8080";console.log(I),T=new b(I),S();const M=document.getElementById("session-id-container"),B=document.getElementById("session-id");let q=B.textContent.trim();function N(){B.textContent=q,B.contentEditable=!1}function $(){const e=B.textContent.trim();/^[a-zA-Z0-9\-]+$/.test(e)?(B.contentEditable=!1,console.log("Valid session ID:",e),T.changeSessionId(e)):(alert("Invalid session ID! User-defined session ID must not be null and must contain only alphanumeric characters or the hyphen ('-')."),N())}M.addEventListener("click",(function(e){B.isContentEditable||(e.preventDefault(),e.stopPropagation(),B.contentEditable=!0,B.focus(),q=B.textContent.trim())})),document.addEventListener("keydown",(function(e){B.isContentEditable&&("Enter"===e.key?(e.preventDefault(),e.stopPropagation(),$()):"Escape"===e.key&&(e.preventDefault(),e.stopPropagation(),N()))})),document.addEventListener("click",(function(e){B.isContentEditable&&e.target!==B&&(e.preventDefault(),e.stopPropagation(),$())}))}));
