import{Offcanvas as e,Carousel as t,Modal as s}from"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/+esm";import n from"https://cdn.jsdelivr.net/npm/bezier-easing@2.1.0/+esm";import i from"https://cdn.jsdelivr.net/npm/isotope-layout@3.0.6/+esm";import o from"https://cdn.jsdelivr.net/npm/showdown@2.1.0/+esm";import r from"https://cdn.jsdelivr.net/npm/tinycolor2@1.6.0/+esm";import{Howler as l,Howl as a}from"https://cdn.jsdelivr.net/npm/howler@2.2.4/+esm";class c{#e;#t;#s;#n;constructor(e,t,s){this.#e=e,this.#s=document.getElementById(t),this.#t=s,this.#n=new o.Converter({tables:!0,strikethrough:!0})}safeById=(e,t)=>{if(!e||!this.#s)return;const s=this.#s.querySelector("#"+e);return s?t(s):void 0};display(e){const t=this.#s.querySelector(".offcanvas-body");if(!t)throw new Exception("no element where to insert response text");const s=t.lastElementChild,n=this.#n.makeHtml(e);s?s.innerHTML=n:t.innerHTML=n,this.#s.querySelectorAll("table:not(.table)").forEach((e=>{e.classList.add("table","table-sm","table-borderless")})),this.#s.querySelectorAll("img").forEach((e=>{e.alt&&!(e.alt.includes("Android")||e.alt.includes("Apple")||e.alt.includes("example")||e.alt.includes("github"))&&e.classList.add("img-fluid")})),this.safeById("logic_symbols",(e=>{e.addEventListener("click",(e=>{e.preventDefault(),this.#s.classList.remove("javascript"),this.safeById("AetB",(e=>e.innerHTML="𝖠 ∧ 𝖡")),this.safeById("AouB",(e=>e.innerHTML="𝖠 ∨ 𝖡")),this.safeById("nonAounonB",(e=>e.innerHTML="¬𝖠 ∨ ¬𝖡"))}))})),this.safeById("javascript_expressions",(e=>{e.addEventListener("click",(e=>{e.preventDefault(),this.#s.classList.add("javascript"),this.safeById("AetB",(e=>e.innerHTML="α & β")),this.safeById("AouB",(e=>e.innerHTML="α | β")),this.safeById("nonAounonB",(e=>e.innerHTML="!α | !β"))}))}))}fetch(e){if(this.#t){const t=this,s=new XMLHttpRequest;s.open("GET",this.#t,!0),s.onreadystatechange=function(){4===s.readyState&&200===s.status&&(t.display(s.responseText),e&&e())},s.send()}return new this.#e(this.#s)}}class d{static safeGetElementByIdThen(e,t,...s){if(e){const n=document.getElementById(e);if(n)return t(n,...s)}}static normalizeVraiment(e,t,s,n,i){if(s===t)return 0;if(Math.abs(e-s)<Number.EPSILON)return i;return n+(i-n)*(e-t)/(s-t)}static isFiniteNumber(e){return isFinite(e)&&!isNaN(e)}static formatReadableDateLong(e){return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}static formatReadableDate(e){const t=new Date(e),s=new Intl.DateTimeFormat("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}).format(t);return`${("0"+t.getDate()).slice(-2)} ${t.toLocaleString("en-US",{month:"short"})} ${t.getFullYear()} · ${s}`}static formatDuration(e,t="seconds"){if("seconds"!==t&&"milliseconds"!==t)throw new Error("Invalid 'type' parameter. 'type' must be either 'seconds' or 'milliseconds'.");if("seconds"===t&&(e*=1e3),6e5<=e)throw new Error(`Duration ${e} must be under 9′59″999`);const s=Math.floor(e/6e4),n=Math.floor(e/1e3)%60;let i=s+"′"+String(n).padStart(2,"0")+"″";if("milliseconds"===t){const t=Math.floor(e%1e3);i+=String(t).padStart(3,"0")}return i}static shuffleArray(e){for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}}static toggleElementsVisibility(e,t){let s=null;for(let n of e)null==s&&(s=n.style.display!==t?t:"none"),n.style.display=s;return s}}class u{static mapNumberToColor(e){const t=[{value:120,color:"#00852B"},{value:60,color:"#1E5AA8"},{value:30,color:"#B40000"},{value:0,color:"#FF0000"}];if(t[0].value<e)return t[0].color;if(e<=t[t.length-1].value)return t[t.length-1].color;let s=null;for(let n=0;n<t.length-1;n++)if(t[n].value>=e&&e>t[n+1].value){s=n;break}if(null===s)return"#000000";const n=(e-t[s].value)/(t[s+1].value-t[s].value);return r.mix(t[s].color,t[s+1].color,100*n).toHexString()}constructor(){let e=["#F4F4F4","#FAC80A","#B40000","#00852B","#1E5AA8","#8A928D","#ABD9FF","#91501C","#545955"],t=Math.floor(Math.random()*e.length);this.colorTrue=e[t],this.colorFalse="transparent",e.splice(t,1),this.colors=[...e,...e],this.shuffleColors(4)}#i=4;#o=0;nextColor(){const e=this.colors[this.#o++];return this.#o%=this.colors.length,e}shuffleColors(e=this.#i){return this.colors=function(e,t){e.length;let s=[...e],n=new Map,i=[];for(let e=0;e<s.length;e++)n.has(s[e])?n.set(s[e],n.get(s[e])+1):n.set(s[e],1);if(t||(t=0),t<0||n.size<t)throw new Error("Invalid parameters: lengthOfNonConsecutiveColors should be a number greater or equal than zero and less than the length of possible colors array");let o=[];for(;;){let e,s=[];if(n.forEach(((e,t)=>{e>0&&!i.includes(t)&&s.push({value:t,remain:e})})),0===s.length&&n.forEach(((e,t)=>{e>0&&s.push({value:t,remain:e})})),0===s.length)break;if(1===s.length)e=s[0];else{let t=Math.floor(Math.random()*s.length);e=s[t]}o.push(e.value),i.push(e.value),i.length>t&&i.shift(),n.set(e.value,e.remain-1);let r=!0;if(n.forEach((e=>{e>0&&(r=!1)})),r)break}return o}(this.colors,e),this.colors}bg2color(e){return r(e).darken(3).toString("hex6")}}class h{static overlaySingleton=null;static getOrCreateOverlaySingleton(){return null==h.overlaySingleton&&(h.overlaySingleton=document.createElement("div"),h.overlaySingleton.classList.add("overlay"),h.overlaySingleton.style.display="none",document.body.appendChild(h.overlaySingleton),window.addEventListener("resize",(()=>{(new h).updateOverlayPosition()}))),h.overlaySingleton}#r;#l;constructor(e){this.#l=e,this.#r=h.getOrCreateOverlaySingleton()}show(){this.#r.style.display="block"}move(e){this.elementCoveredByOverlay=e,this.updateOverlayPosition()}hide(){this.#r.style.display="none"}clear(){this.#r.style.display="none",this.elementCoveredByOverlay=null}updateOverlayPosition(){if(null==this.elementCoveredByOverlay)return;const e=this.elementCoveredByOverlay.querySelectorAll(this.#l);if(0===e.length)return;let t=Number.MAX_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER;e.forEach((e=>{const o=e.getBoundingClientRect();t=Math.min(t,o.top),s=Math.min(s,o.left),n=Math.max(n,o.bottom),i=Math.max(i,o.right)}));const o=this.#r.parentElement.getBoundingClientRect();this.elementCoveredByOverlay.getBoundingClientRect();const r=this.#r.style;r.position="absolute",r.top=t-o.top+"px",r.left=s-o.left+"px",r.width=i-s+"px",r.height=n-t+"px"}}class m{constructor(e,t){if(this.swipeArea=document.getElementById(e),!this.swipeArea)throw new Error(`Element with id '${e}' not found.`);this.startX=0,this.startY=0,this.currentX=0,this.minY=0,this.maxY=0,this.touchThresholdX=150,this.touchThresholdY=80,this.swipeHandler=t,this.swipeArea.addEventListener("touchstart",this.handleTouchStart.bind(this),{passive:!1}),this.swipeArea.addEventListener("touchmove",this.handleTouchMove.bind(this),{passive:!1}),this.swipeArea.addEventListener("touchend",this.handleTouchEnd.bind(this),{passive:!1}),this.swipeElement=this.swipeArea,this.swipeElement.addEventListener("swipe",this.handleSwipe.bind(this))}handleTouchStart(e){this.startX=this.currentX=e.touches[0].clientX,this.startY=this.minY=this.maxY=e.touches[0].clientY}handleTouchMove(e){this.currentX=e.touches[0].clientX,this.minY=Math.min(this.minY,e.touches[0].clientY),this.maxY=Math.max(this.maxY,e.touches[0].clientY)}handleTouchEnd(e){if(!(this.startX&&this.currentX&&this.startY&&this.minY))return;const t=this.currentX-this.startX,s=this.maxY-this.minY;Math.abs(t)>this.touchThresholdX&&Math.abs(s)<this.touchThresholdY&&(t>0?this.fireSwipeEvent("swiperight"):this.fireSwipeEvent("swipeleft")),this.startX=this.currentX=void 0}fireSwipeEvent(e){const t=new CustomEvent("swipe",{detail:e});this.swipeElement.dispatchEvent(t)}handleSwipe(e){"function"==typeof this.swipeHandler&&this.swipeHandler(e.detail)}}class p{constructor(e,t,s={}){try{this.timerContainer=document.getElementById(t),this.timerContainer.disabled=!1,this.timerElementPlaying=this.timerContainer.querySelector(".timer-playing"),this.timerElementNotPlaying=this.timerContainer.querySelector(".timer-not-playing"),this.ticks=0,this.innerCircle1=this.timerElementPlaying.querySelector("#innerCircle1"),this.innerCircle2=this.timerElementPlaying.querySelector("#innerCircle2"),this.radius1=this.innerCircle1.getAttribute("r"),this.radius2=this.innerCircle2.getAttribute("r"),this.circonf1=2*this.radius1*Math.PI,this.circonf2=2*this.radius2*Math.PI,this.radius=this.timerElementPlaying.width/4,this.centerX=this.timerElementPlaying.width/2,this.centerY=this.timerElementPlaying.height/2,this.timerId=null,this.startTime=null,this.stopTime=null,this.totalTime=e,this.callbacks={onStart:()=>{},onTick:()=>{},onExpired:()=>{},onStop:()=>{},onClose:()=>{}},this.callbacks=Object.assign(this.callbacks,s)}catch(e){console.error(e)}}drawTimer(e){let t=(this.totalTime-e)/this.totalTime,s=t*this.circonf1,n=this.circonf1-s,i=t*this.circonf2,o=this.circonf2-i;innerCircle1.setAttribute("stroke-dasharray",`0 ${s} ${n}`),i-6>=0?(innerCircle2.setAttribute("stroke-dasharray",`0 3 ${i-6} ${o+3}`),innerCircle2.setAttribute("stroke-width",2)):innerCircle2.setAttribute("stroke-width",0)}updateTimer(e){const t=(e-this.startTime)/1e3,s=Math.max(this.totalTime-t,0);s>0?(this.drawTimer(s),this.timerId=requestAnimationFrame((e=>this.updateTimer(e)))):(clearInterval(this.showNumber),this.callbacks.onExpired())}start(e){e&&(this.totalTime=e),this.timerElementPlaying.style.display="block",this.timerElementNotPlaying.style.display="none",this.ticks=0,this.stopTime=null,this.startTime=performance.now(),this.timerId=requestAnimationFrame((e=>this.updateTimer(e,this.startTime))),this.callbacks.onStart(),this.callbacks.onTick(this.totalTime,this.ticks),this.showNumber=setInterval((()=>{this.callbacks.onTick(this.totalTime,++this.ticks)}),1e3)}stop(){return null!==this.stopTime||(clearInterval(this.showNumber),cancelAnimationFrame(this.timerId),this.timerId=null,this.callbacks.onStop(),this.stopTime=performance.now()-this.startTime),this.stopTime}close(){this.callbacks.onClose(),this.timerElementPlaying.style.display="none",this.timerElementNotPlaying.style.display="block"}}class y{static newHowl(e){if(!l.usingWebAudio)return{play:()=>{},fade:()=>{},stop:()=>{},volume:()=>{}};return new class extends a{constructor(e){super(e),this._initialVolume=e.volume}play(e){this._initialVolume&&this.volume(this._initialVolume),super.play(e)}fade(e,t,s,n){void 0===e&&(e=this.volume()),void 0===s&&(s=1e3),super.fade(e,t,s,n)}}(e)}constructor(){this.tortoise=y.newHowl({src:["/assets/audio/ticking.mp3"],loop:!0,volume:.5}),this.hare=y.newHowl({src:["/assets/audio/hare.mp3"],loop:!1,volume:.3}),this.achilles=y.newHowl({src:["/assets/audio/achilles-v9.mp3"],loop:!1,volume:.8}),this.underwater=y.newHowl({src:["/assets/audio/underwater-v2.mp3"],loop:!0,volume:.001}),this.coin=y.newHowl({src:["/assets/audio/coin.mp3"]}),this.laughs=y.newHowl({src:["/assets/audio/guitar-string-snap.mp3"],loop:!1,volume:.2}),this.tada=y.newHowl({src:["/assets/audio/tada.mp3"],loop:!1,volume:.8}),this.fail=y.newHowl({src:["/assets/audio/fail2.mp3"]}),this.completed_with_errors=y.newHowl({src:["/assets/audio/completed_with_errors.mp3"]}),this.boo=y.newHowl({src:["/assets/audio/boo.mp3"]}),this.guitar=y.newHowl({src:["/assets/audio/guitar-riff.mp3"]}),this.boredom=y.newHowl({src:["/assets/audio/boredom.mp3"]}),this.gong=y.newHowl({src:["/assets/audio/gong.mp3"],loop:!1,volume:.3}),this.abort=y.newHowl({src:["/assets/audio/short-whoosh.mp3"]}),this.riser=y.newHowl({src:["/assets/audio/scary-riser-v2.mp3"],loop:!1,volume:.67})}}class g{#a;constructor(e){this.#a=e}get value(){return this.#a}set value(e){"number"==typeof e?this.#a=e:console.error("Value must be a number")}increment(){const e=this.#a;return this.#a+=1,e}}class v{#c;#d;#u;#h;#m;#p;#y;constructor(e,t,s){this.#m=e,this.scrambled=t,this.displayMode=s,this.reset()}reset(){this.#c=void 0,this.#d=new g(1),this.#u=new g(0),this.#h=new g(0)}get level(){return this.#m}get scrambled(){return this.#y}set scrambled(e){if(void 0!==e)if(null===e||"boolean"==typeof e)this.#y=e;else if("string"==typeof e){const t=e.toLowerCase();this.#y="true"===t||"false"!==t&&!!e}else this.#y=!!e}get displayMode(){return this.#p}set displayMode(e){this.#p="𝖠"===e?"canonical":"α"===e?"javascript":null}get elapsed(){return this.#d}get erred(){return this.#u}get unconcealed(){return this.#h}get timerDuration(){return this.#c}set timerDuration(e){this.#c=e}get victory(){return 0===this.erred.value&&32===this.unconcealed.value}}function f(e){var t=new Date;t.setDate(t.getDate()+365),document.cookie=`sessionId=${e}; expires=${t.toUTCString()}; path=/`}class b{#g;#v;constructor(e){this.#g=e,this.fetchSessionId().then((e=>{this.setSessionId(e)}))}changeSessionId(e){f(e),this.setSessionId(e)}setSessionId(e){this.#v=e,document.getElementById("session-id").innerText=this.#v}fetchSessionId(){return new Promise(((e,t)=>{const s=function(){const e=document.cookie.split("; ");for(const t of e){const[e,s]=t.split("=");if("sessionId"===e)return s}return null}();if(s)e(s);else{const s=new URL(this.#g+"/sessionId");fetch(s).then((e=>e.json())).then((t=>{const s=t.sessionId;f(s),e(s)})).catch((e=>{t(e+" - at url "+s)}))}}))}write(e){return new Promise(((t,s)=>{fetch(this.#g,{method:"POST",headers:{"Content-Type":"application/json","Session-Id":this.#v},body:JSON.stringify(e)}).then((e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()})).then((e=>{t(e)})).catch((e=>{s(e)}))}))}best(){return new Promise(((e,t)=>{const s=new URL(this.#g+"/bests");fetch(s).then((t=>{if(204===t.status)e();else if(!t.ok)throw new Error("Network response was not ok");return t.json()})).then((t=>{e(t)})).catch((e=>{t(e)}))}))}read(e={}){return new Promise(((t,s)=>{const n=new URL(this.#g);Object.keys(e).forEach((t=>n.searchParams.append(t,e[t]))),fetch(n).then((e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()})).then((e=>{t(e)})).catch((e=>{s(e)}))}))}erase(e={}){return new Promise(((t,s)=>{const n=new URL(this.#g);Object.keys(e).forEach((t=>n.searchParams.append(t,e[t]))),fetch(n,{method:"DELETE"}).then((e=>{if(!e.ok)throw new Error("Network response was not ok");return e.text()})).then((e=>{t(e)})).catch((e=>{s(e)}))}))}}class w{#f;#b;#w;#E;constructor(e){this.#E=e,this.#f=document.getElementById("session-id-container"),this.#b=document.getElementById("session-id"),this.#w=this.#b.textContent.trim(),this.#f.addEventListener("click",(e=>{this.isEditing()||(e.preventDefault(),e.stopPropagation(),this.enterEditMode())})),this.#b.addEventListener("keyup",(e=>{this.isEditing()&&(e.preventDefault(),e.stopPropagation(),"Enter"===e.key?this.validateEditMode():"Escape"===e.key&&this.abortEditMode())})),document.addEventListener("click",(e=>{this.isEditing()&&e.target!==this.#b&&(e.preventDefault(),e.stopPropagation(),this.validateEditMode())}))}isEditing(){return this.#b.isContentEditable}enterEditMode(){this.#b.contentEditable=!0,this.#b.focus(),this.#w=this.#b.textContent.trim()}abortEditMode(){this.#b.textContent=this.#w,this.#b.contentEditable=!1}validateEditMode(){const e=this.#b.textContent.trim();0===e.length||/^[a-z0-9\-]+$/.test(e)?(this.#b.contentEditable=!1,console.log("Valid session ID:",e),this.#E.changeSessionId(e)):(alert("Invalid session ID! User-defined session ID must contain only lowercase alphanumeric characters or the hyphen ('-'), or be empty."),this.abortEditMode())}}function E(e,t){if(!e)return;const s=document.getElementById(e);return s?t(s):void 0}let T=!1,I=null;function S(){try{I.best().then((e=>{void 0!==e?e.forEach((e=>{console.log(e);const t=`${e.scrambled?"scrambled-true":"scrambled-false"}-${e.level}`;E(`result-elapsed-${t}`,(t=>{t.innerHTML=d.formatDuration(e.elapsed,"milliseconds")})),E(`result-pseudo-${t}`,(t=>{t.innerHTML=e.sessionId})),E(`result-when-${t}`,(t=>{t.innerHTML=d.formatReadableDate(e.when)}))})):console.log("GET response ok, but with no data (204)")})).catch((e=>{console.log("GET error:",e)}))}catch(e){console.error("GET error:",e)}}const M=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document;console.log(navigator.userAgent,`[${M?"":"NOT "}a iOS device]`);class L{#s;#T=n(.5,.2,.5,1);#I;#S;#M;constructor(){this.#s=document.querySelector(".compte-à-rebours"),this.#I=120,this.#M=600}get animationTimeInMilliseconds(){return this.#M}set animationTimeInMilliseconds(e){this.#M=e}get duration(){return this.#I}set duration(e){this.animateSetDuration(e)}animateSetDuration(e){let t=Number(e),s=this.duration;const n=performance.now(),i=()=>{const e=Math.min(performance.now()-n,this.#M),o=d.normalizeVraiment(e,0,this.#M,0,1),r=this.#T(o),l=s+r*(t-s);this._duration_=l,e<this.animationTimeInMilliseconds?requestAnimationFrame(i):this._duration_=t};cancelAnimationFrame(this.#S),this.#S=requestAnimationFrame(i)}set _duration_(e){if(!d.isFiniteNumber(e))throw new Error(`not a finite number: ${e} !`);this.#I=e,this.#s.style.color=u.mapNumberToColor(this.#I),this.#s.textContent=d.formatDuration(this.#I)}}let k=null;k=new class{#L;constructor(e){this.#L=document.getElementById(e)}get element(){return this.#L}set innerHTML(e){this.#L&&(this.#L.innerHTML=e)}}("tables");let C=null;C=new class{#k;constructor(){let e;document.getElementById("result-modal").addEventListener("hidden.bs.modal",(e=>{C.stop()})),this.restarting=!1,this._soundMachine=new y,document.getElementById("controls").style.visibility="visible",this.compteARebours=new L,this.compteARebours.duration=Number(document.querySelector(".carousel-item.active").dataset.time),this._timer=new p(this.compteARebours.duration,"play",{onStart:this.onTimerStart,onTick:this.onTimerTick,onExpired:this.onTimerExpired,onStop:this.onTimerStop,onClose:this.onTimerClose}),this.tortoiseHareAchilles=new t(document.getElementById("tortoise-hare-achilles"),{}),document.getElementById("tortoise-hare-achilles").addEventListener("slide.bs.carousel",(t=>{e=performance.now(),this.compteARebours.animateSetDuration(t.relatedTarget.dataset.time)})),document.getElementById("tortoise-hare-achilles").addEventListener("slid.bs.carousel",(t=>{e&&(this.compteARebours.animationTimeInMilliseconds=performance.now()-e);const s=document.getElementById("tortoise-hare-achilles"),n=s.querySelector(".carousel-item.active");s.style.opacity="1",s.querySelector(".carousel-control-next").disabled=!1,s.querySelector(".carousel-control-prev").disabled=!1,"tortoise"===n.id?s.querySelector(".carousel-control-prev").disabled=!0:"achilles"===n.id&&(s.querySelector(".carousel-control-next").disabled=!0)}))}get restarting(){return this.#k}set restarting(e){this.#k=e}get level(){return document.querySelector(".carousel-item.active").dataset.sound}stopTimerShowResultThenCloseTimer(e,t){C.result.timerDuration=C._timer.stop(),document.getElementById("result-msg").innerHTML=e,[...document.querySelectorAll("#cloche svg")].forEach((e=>{e.style.display="none"})),document.getElementById(`result-level-${t.level}`).style.display="block",document.getElementById(`result-scrambled-${t.scrambled}`).style.display="block",document.getElementById("result-elapsed").innerHTML=d.formatDuration(t.timerDuration,"milliseconds"),document.getElementById("result-unconcealed").innerHTML=t.unconcealed.value,0!==t.erred.value?(document.getElementById("empty-set").style.display="none",document.getElementById("result-erred").innerHTML=t.erred.value):(document.getElementById("result-erred").innerHTML="",document.getElementById("empty-set").style.display="block");const n=new Date;const i=function(){const e=new Date;return`${e.getUTCFullYear()}-${String(e.getUTCMonth()+1).padStart(2,"0")}-${String(e.getUTCDate()).padStart(2,"0")}T${String(e.getUTCHours()).padStart(2,"0")}:${String(e.getUTCMinutes()).padStart(2,"0")}:${String(e.getUTCSeconds()).padStart(2,"0")}.${String(e.getUTCMilliseconds()).padStart(3,"0")}Z`}();if(d.safeGetElementByIdThen("result-timestamp",((e,t)=>{e.innerHTML=t}),n.toLocaleString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"})),!T&&I){const e={pseudo:T?"christophe":"anonymous",level:t.level,elapsed:Math.round(t.timerDuration),erred:t.erred.value,unconcealed:t.unconcealed.value,victory:0===t.erred.value&&32===t.unconcealed.value,symbol:t.displayMode,scrambled:t.scrambled,when:i};I.write(e).then((e=>{console.log("POST response:",e),S()})).catch((e=>{console.log("POST error:",e)}))}new s(document.getElementById("result-modal")).show()}onTimerStart(){C._soundMachine.underwater.play(),C._soundMachine[C.level].play()}onTimerTick(e,t){C.compteARebours.duration=e-t,C.result.elapsed.increment(),C.compteARebours.duration<=17&&!C._soundMachine.riser.playing()&&C._soundMachine.riser.play()}onTimerExpired(){requestAnimationFrame((()=>{let e;0===C.result.erred.value&&0===C.result.unconcealed.value?(C.boredom(),e="Rather quiet today, isn't it?"):(C.fail(),e="Time's up!"),C.stopTimerShowResultThenCloseTimer(e,C.result)}))}onTimerStop(){"achilles"===C.level?C.result.victory||C._soundMachine[C.level].fade(void 0,.001,2500):C._soundMachine[C.level].fade(void 0,.001),C._soundMachine.underwater.fade(void 0,.001),C._soundMachine.riser.fade(void 0,.001,1500)}onTimerClose(){document.getElementById("shuffle-all").disabled=!1,C.unveilBricks(),C._soundMachine[C.level].stop(),C._soundMachine.underwater.stop()}victory(){requestAnimationFrame((()=>{let e;C.result.erred.value>=32&&0===C.result.unconcealed.value?(C.guitar(),e="Ooooh&hellip; Subtle!"):0===C.result.erred.value&&32===C.result.unconcealed.value?("achilles"==C.level&&C.result.victory?C.gong():C.tada(),e="You won!"):C.result.erred.value>=28&&32===C.result.unconcealed.value?(C.boo(),e="You cheated?!"):(C.completed_with_errors(),e="You <i>quasi</i> won&hellip;"),C.stopTimerShowResultThenCloseTimer(e,C.result)}))}get isPlaying(){return document.getElementById("play").classList.contains("playing")}set isPlaying(e){this.isPlaying!==e&&(e?document.getElementById("play").classList.add("playing"):document.getElementById("play").classList.remove("playing"))}coin(){this._soundMachine.coin.play()}tada(){this._soundMachine.tada.play()}gong(){this._soundMachine.gong.play()}laughs(){this._soundMachine.laughs.play(),this.result.erred.increment()}fail(){this._soundMachine.fail.play()}abortSound(){this._soundMachine.abort.play()}completed_with_errors(){this._soundMachine.completed_with_errors.play()}boo(){this._soundMachine.boo.play()}guitar(){this._soundMachine.guitar.play()}boredom(){this._soundMachine.boredom.play()}veilBricks(){this.#C("veil")}unveilBricks(){this.restarting||this.#C("unveil")}async#C(e){const t="veil"===e;function s(e,t){return new Promise((s=>{e.parentNode.classList.remove("completed");const n=e.querySelectorAll("td");t?n.forEach((e=>{e.classList.contains("true")&&e.classList.add("concealed"),e.classList.remove("clicked")})):1!=C.isPlaying&&n.forEach((e=>{e.classList.contains("true")&&e.classList.remove("concealed"),e.classList.remove("clicked")})),setTimeout((()=>{s(e)}),20)}))}const n=[...document.querySelectorAll("#tables tbody")],i=Array.from({length:n.length},((e,t)=>t));d.shuffleArray(i);for(const e of i){const i=n[e];await s(i,t)}}start(){if(this.isPlaying)return;this.isPlaying=!0,this.result=new v(this.level,k.element.dataset.scrambled,_.displayMode.symbol),window.scrollTo({top:0,behavior:"smooth"}),this.veilBricks();const e=Number(document.querySelector(".carousel-item.active").dataset.time);this._timer.start(e),document.getElementById("shuffle-all").disabled=!0,document.getElementById("tortoise-hare-achilles").style.opacity=".5",document.querySelectorAll("#tortoise-hare-achilles button").forEach((e=>{e.disabled=!0})),this.result.reset(),this.restarting=!1}abort(){requestAnimationFrame((()=>{C.abortSound();C.stopTimerShowResultThenCloseTimer("You stopped!",C.result)}))}stop(){this.isPlaying=!1,this.compteARebours.duration=Number(document.querySelector(".carousel-item.active").dataset.time);const e=document.getElementById("tortoise-hare-achilles"),t=e.querySelector(".carousel-item.active");e.style.opacity="1",e.querySelector(".carousel-control-next").disabled=!1,e.querySelector(".carousel-control-prev").disabled=!1,"tortoise"===t.id?e.querySelector(".carousel-control-prev").disabled=!0:"achilles"===t.id&&(e.querySelector(".carousel-control-next").disabled=!0),this.result&&(this.result.timerDuration=this._timer.stop()),this._timer.close()}};const B=new class{constructor(){this.axesArray=[null,!0,!1],this.visible=!1,this.setCellWidth()}setCellWidth(){let e=61;this.visible&&(e=52);let t=Math.round(.7*e);document.documentElement.style.setProperty("--cell-width_and_height",`${e}px`),document.documentElement.style.setProperty("--cell-width_and_height-smaller",`${t}px`),document.documentElement.style.setProperty("--header-width_and_height","18px"),document.documentElement.style.setProperty("--border-color","#215c4d40")}iterate(e){this.axesArray.forEach(e)}applyVisibility(){(e=>{for(let t of e)t.style.display=this.visible?"table-cell":"none"})(document.querySelectorAll("#tables th"))}toggleVisibility(){const e=d.toggleElementsVisibility(document.querySelectorAll("#tables th"),"table-cell");return this.visible="none"!==e,this.setCellWidth(),this.visible}},A=new u;class P{constructor(e,t){this.c=0,this.colors=[e],t&&this.colors.push(t)}next(){const e=this.colors[this.c];return this.c=(this.c+1)%this.colors.length,e}}class D{static falseFunc="";static trueFunc="true";#B=[D.falseFunc,"α & β","α & !β","!α & !β","!α & β","α","β","!α","!β","α ^ β","α ^ !β","α | β","α | !β","!α | !β","!α | β",D.trueFunc];#p={canonical:{symbol:"𝖠",facade:"(𝖠,𝖡)",key:"canonical"},javascript:{symbol:"α",facade:"(α,β)",key:"javascript"}};#A="canonical";constructor(){const e="<span class='negation canonical'>𝖠</span>",t="<span class='negation canonical'>𝖡</span>";this.#B.forEach((s=>{if("string"==typeof s){const n=s;this.#p.javascript[n]=s.replace(/^$/g,"&nbsp;"),this.#p.canonical[n]=s.replace(/&/g,"∧").replace(/\|/g,"∨").replace(new RegExp(`^${D.trueFunc}$`),"⊤").replace(new RegExp(`^${D.falseFunc}$`),"⊥").replace(/\^/g,"⊻").replace(/(!?)α|(!?)β/g,((s,n,i)=>"!"===n?e:"!"===i?t:"α"===s?"𝖠":"𝖡"))}}))}static toAnonymous(e){return new Function("α","β",`return ${e};`)}iterate(e){this.#B.forEach(e)}getOneOrTwoColors(e){return e===D.falseFunc?new P(A.colorFalse):e===D.trueFunc?new P(A.colorTrue):e.includes("^")?new P(A.nextColor(),A.nextColor()):new P(A.nextColor())}toggleDisplayMode(){return this.#A="canonical"===this.#A?"javascript":"canonical",this.#A}get displayMode(){return this.#p[this.#A]}}const _=new D;let x;function H(e,t=!0){t?(k.element.dataset.scrambled=!0,x.shuffle()):(k.element.dataset.scrambled=!1,x.arrange({sortBy:"original-order"})),x.layout()}document.querySelector("#αβ > span").innerHTML=_.displayMode.facade;class q{#P=void 0;#D=null;constructor(e){this.#P=e,this.#D=null}blend(e,t){null===this.#D?this.#P.innerHTML=e:this.#D.insertAdjacentHTML("afterend",e),this.#D=document.getElementById(t)}}window.addEventListener("load",(t=>{const n=function(){if(C.isPlaying)return;const e=new q(k);_.iterate(((t,s)=>{const n=`element${s}`,i=`thead${s}`,o=`tbody${s}`,r=`<div id="${n}" class="ISOTOPE" data-function="${t}">\n<table class="table inline table-sm caption-top table-borderless">\n<caption class="text-center">${_.displayMode[t]}</caption>\n<thead id="${i}"></thead>\n<tbody id="${o}"></tbody>\n</table>\n</div>\n`;e.blend(r,n);let l=_.getOneOrTwoColors(t);B.iterate((e=>{const s=document.createElement("tr");B.iterate((n=>{const i=document.createElement(null===e||null===n?"th":"td");if(null===n)i.innerHTML=null===e?'<div class="diagonal-line">&nbsp;</div>':`<div class="vertical-text">${e}</div>`;else if(null===e)i.innerHTML=`${n}`;else{const s=D.toAnonymous(t)(e,n);i.classList.add(s?"true":"false"),s?(i.style.backgroundColor=l.next(),i.style.color=A.bg2color(i.style.backgroundColor),i.innerHTML=""):(i.style.backgroundColor=A.colorFalse,i.innerHTML="")}s.appendChild(i)})),document.getElementById(null===e?i:o).appendChild(s)})),B.applyVisibility()})),document.getElementById("aletheia").style.visibility="visible",document.querySelectorAll("#tables td").forEach((e=>{e.addEventListener("click",(t=>{if(t.preventDefault(),t.stopPropagation(),!C.isPlaying)return;if(e.classList.contains("concealed")){function i(e,t){for(;e=e.parentElement;)if(e.classList.contains(t))return e;return null}function o(e,t,s,n){const o=i(e,t);return o?{result:[...o.getElementsByClassName(s)].every((function(e){return!e.classList.contains(n)})),ancestor:o}:{result:!1,ancestor:void 0}}e.classList.remove("concealed"),C.result.unconcealed.increment();const r=o(e,"table","true","concealed");r.result&&(r.ancestor.classList.add("completed"),C.coin())}else e.classList.contains("false")&&(C.laughs(),e.classList.add("red-cross"),e.classList.add("clicked"),setTimeout((()=>{e.classList.remove("red-cross")}),1e3));let s=document.querySelectorAll("#tables td.true.concealed").length,n=document.querySelectorAll("#tables td.false.clicked").length;(0===s||n>=32&&32===s)&&C.victory()}))}));let t=null,s=new h("td"),n=null;function o(){t&&(clearTimeout(t),t=null),[...document.querySelectorAll(".hint")].forEach((e=>{e.classList.remove("hint"),n=null})),s.hide(),C._soundMachine.underwater.fade(void 0,.001,1500)}return window.addEventListener("scroll",(function(e){o()})),window.addEventListener("touchmove",(function(e){n&&!(n==e.target||e.target instanceof Node&&n.contains(e.target))&&o()})),window.addEventListener("touchend",(e=>{o()})),[...document.getElementsByTagName("caption")].forEach((e=>{e.addEventListener("touchstart",(t=>{C.isPlaying&&(n=e,t.preventDefault())})),e.addEventListener("pointerdown",(n=>{C.isPlaying&&(s.move(e.parentNode),s.show(),e.setPointerCapture(n.pointerId),C._soundMachine.underwater.fade(void 0,.4),t=setTimeout((()=>{n.target.parentNode.classList.add("hint"),n.target.parentNode.parentNode.classList.add("hint")}),300))})),e.addEventListener("pointerup",(t=>{o(),e.releasePointerCapture(t.pointerId)}))})),x=new i(k.element,{itemSelector:"div.ISOTOPE",layoutMode:"masonry",masonry:{columnWidth:10,fitWidth:!0}}),[...document.querySelectorAll("#tables>div")]}(),o=document.querySelector("head meta[name='truth-reservoir-url']")?.getAttribute("content")||"http://localhost:8080";function r(){C.isPlaying||H()}function l(){C.isPlaying||function(e){A.shuffleColors(),e.forEach((e=>{if(e.dataset.function){let t=_.getOneOrTwoColors(e.dataset.function);e.querySelectorAll("td.true").forEach((e=>{e.style.backgroundColor=t.next(),e.style.color=A.bg2color(e.style.backgroundColor)}))}}))}(n)}function a(){return E("tables",(e=>e.classList.contains("transparent-border")?(e.classList.remove("transparent-border"),!1):(e.classList.add("transparent-border"),!0)))}function d(){return _.toggleDisplayMode(),"canonical"===_.displayMode.key?document.getElementById("main-id").classList.remove("javascript"):document.getElementById("main-id").classList.add("javascript"),document.getElementById("canonical-or-javascript.label").innerHTML=_.displayMode.symbol,document.querySelector("#αβ > span").innerHTML=_.displayMode.facade,document.querySelectorAll("#tables [data-function] caption").forEach((e=>{e.innerHTML=_.displayMode[e.parentNode.parentNode.dataset.function]})),"canonical"!==_.displayMode.key}console.log(o),I=new b(o),S(),new w(I),document.getElementById("table-borders").addEventListener("click",(e=>{e.stopPropagation(),a()})),document.getElementById("ab-axes").addEventListener("click",(e=>{e.stopPropagation(),B.toggleVisibility()})),document.getElementById("canonical-or-javascript")?.addEventListener("click",(e=>{e.stopPropagation(),d()}));const u=new c(e,"offcanvas-right","/QUICK-GUIDE.md").fetch((()=>{console.log("/QUICK-GUIDE.md fetched")})),p=new c(e,"offcanvas-left").fetch((()=>{console.log("/WIP.md fetched")}));function y(e){e.preventDefault(),e.stopPropagation(),C.isPlaying?C.abort():C.start()}function g(){C.restarting=!0,C.veilBricks();let e=document.getElementById("result-modal");e.addEventListener("hidden.bs.modal",(e=>{requestAnimationFrame((()=>{r(),C.start()}))}),{once:!0}),s.getInstance(e).hide()}new m("body-id",(function(e){"swiperight"===e?u._element.classList.contains("show")?u.hide():p._element.classList.contains("show")||p.show():"swipeleft"===e&&(p._element.classList.contains("show")?p.hide():u._element.classList.contains("show")||u.show())})),document.getElementById("shuffle-all").addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),r()})),document.getElementById("play").addEventListener("click",(e=>{y(e),document.activeElement?.blur()})),document.addEventListener("keyup",(function(e){{const t=document.getElementById("result-modal");if("none"!==window.getComputedStyle(t).getPropertyValue("display"))return void("Space"===e.code&&g())}switch(event.code){case"Space":y(e);break;case"Escape":C.isPlaying&&C.stop();break;case"KeyS":r();break;case"KeyO":C.isPlaying||H(0,!1);break;case"KeyC":l();break;case"KeyQ":document.getElementById("table-borders").checked=!a();break;case"KeyW":document.getElementById("ab-axes").checked=B.toggleVisibility();break;case"KeyA":document.getElementById("canonical-or-javascript").checked=d();break;case"ArrowRight":C.isPlaying||C.tortoiseHareAchilles.next();break;case"ArrowLeft":C.isPlaying||C.tortoiseHareAchilles.prev()}})),document.getElementById("play-again").addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),g()})),[...document.getElementsByClassName("carousel-item")].forEach((e=>{e.addEventListener("click",(e=>{if(e.preventDefault(),e.stopPropagation(),C.isPlaying)return;const t=e.target.getBoundingClientRect();event.clientX-t.left<t.width/2?C.tortoiseHareAchilles.prev():C.tortoiseHareAchilles.next()}))}));let v=0;let f;document.getElementById("αβ").addEventListener("click",(function(){f&&clearTimeout(f),v++,7===v?(T=!0,alert("Admin role granted! Your scores will not be saved."),v=0):f=setTimeout((()=>{v=0}),1e4)}))}));
