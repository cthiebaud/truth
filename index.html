<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-TPVM6DVS53"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-TPVM6DVS53');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LEGO® meets Truth Tables</title>
    <meta name="description" content="LEGO® meets Truth Tables.">

    <!-- Open Graph data -->
    <meta property="og:locale" content="en_US">
    <meta property="og:title" content="Truth" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://truth.cthiebaud.com" />
    <meta property="og:description" content="LEGO® meets Truth Tables" />
    <meta property="og:site_name" content="truth.cthiebaud.com" />

    <meta property="og:image" content="https://truth.cthiebaud.com/screenshot.jpg" />
    <meta property="og:image:url" content="https://truth.cthiebaud.com/screenshot.jpg" />
    <meta property="og:image:type" content="image/jpeg" />
    <meta property="og:image:width" content="1800" />
    <meta property="og:image:height" content="1800" />

    <!-- Imports the manifest to represent the web application. A web app must have a manifest to be a PWA. -->
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#f1efe0" />

    <link href="./favicon.ico" rel="icon" type="image/x-icon">
    <!-- PROD
    -->
    <link rel="stylesheet" href="/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/dist/css/index.min.css">
    <!-- end PROD -->
    <!-- DEV 
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@latest/dist/css/bootstrap.min.css">
        <link rel="stylesheet" href="/css/index.css">
        <script type="text/javascript" src="https://livejs.com/live.js"></script>
    -->
    <!-- end DEV -->
</head>

<body class="">

    <!-- Modal -->
    <div id="resultsModal" class="modal fade" tabindex="-1" aria-labelledby="resultsModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="resultsModalLabel">Result</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div id="modal-body" class="modal-body">
                    <h1 id="results-msg"></h1>
                    <div>Elapsed: <span id="results-elapsed"></span> seconds</div>
                    <div>Unconcealed: <span id="results-unconcealed"></span> out of 32</div>
                    <div>Erred: <span id="results-erred"></span></div>
                </div>
                <div id="modal-footer" class="modal-footer">
                    &nbsp;
                </div>
            </div>
        </div>
    </div>

    <div id="con" class="container">
        <div id="alpha-beta" class="p-2 d-flex justify-content-between align-items-start">
            <h1 id="αβ">(α,β)<svg width="32" height="32" preserveAspectRatio="none" viewBox="0 -2 24 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4 6L10.4 6C13.4928 6 16 8.50721 16 11.6L16 18" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    <path d="M16 18.6L12 15" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    <path d="M16 18.6L20 15" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </h1>
            <button id="play" type="button" class="btn btn-light" aria-label="play">
                <div id="not_playing">▶</div>
                <div id="timer-svg" style="display: none;">
                    <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                        <g transform="rotate(-90 50 50)">
                            <circle id="innerCircle1" cx="50" cy="50" r="55" stroke="rgba(23, 63, 53, .25)" stroke-width="46" fill="none" />
                            <circle id="innerCircle2" cx="50" cy="50" r="40" stroke="rgba(23, 63, 53, .666)" stroke-width="0" fill="none" />
                        </g>
                    </svg>
                </div>
            </button>
            <div id="buttons" class="btn-group btn-group-sm" role="group">

                <!-- Button trigger modal for test
                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#resultsModal">
                        *
                    </button>
                -->

                <input type="checkbox" class="btn-check" id="table-borders" autocomplete="off" aria-label="table-borders toggle">
                <label class="btn btn-outline-light" for="table-borders">
                    <svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" width="16" height="16" viewBox="0 0 16 16">
                        <g stroke="none" fill-rule="evenodd"> <!-- fill="#434343" -->
                            <path
                                d="M13.048.99h1.993v1.987h.907V.057h-2.9V.99zM.923 3.008V.99h2.028V0H.027v3.008h.896zM2.951 15.03H.964v-1.95H.027v2.928h2.924v-.977zM15 5.013v2.01h.989v-2.01H15ZM15 9.013v1.961h.982v-1.96H15ZM9 .013V.98h1.984V.013H9ZM5 .013v.973h1.995V.013H5ZM9 15.013v.973h1.958v-.973H9ZM5 15.013v.993h1.987v-.993H5ZM0 5.013v1.99h.98v-1.99H0ZM0 9.013v1.962h.954V9.013H0ZM15.006 13.013v2.073H13v.946h3.003v-3.019h-.997z" />
                        </g>
                    </svg>
                </label>
                <input type="checkbox" class="btn-check" id="ab-axes" autocomplete="off" aria-label="axes toggle">
                <label class="btn btn-outline-light" for="ab-axes">
                    <svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" width="16" height="16" viewBox="0 0 488 488">
                        <path stroke="none"
                            d="M487.9 40.927c-2.35 9.897-13.446 14.868-19.292 22.693-8.157 6.418-16.073 22.787-28.015 13.913-11.227-11.134 11.485-21.639 12.022-27.506H50.433v403.485c7.839-7.427 20.099-25.259 29.798-10.102 2.235 12.49-12.18 18.605-18.785 27.395-7.671 5.32-12.84 18.958-23.914 16.414-11.894-7.987-20.681-20.27-31.428-29.828-17.476-14.372 9.54-28.283 17.755-10.45 8.926 12.934 6.328-1.958 6.57-9.992V40.027c2.392-14.958 20.102-8.657 30.706-10.002h392.76C446.513 22.197 428.589 9.94 443.819.32c12.549-2.226 18.67 12.156 27.468 18.793 5.017 7.223 17.043 11.935 16.613 21.815z" />
                    </svg>
                </label>
                <input type="checkbox" class="btn-check" id="paragraph-breaks" autocomplete="off" aria-label="paragraph-breaks toggle">
                <label class="btn btn-outline-light" for="paragraph-breaks">
                    <svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" width="16" height="16" viewBox="0 0 14.963 14.974">
                        <path stroke="none"
                            d="M14.963 0H3.955A3.96 3.96 0 0 0 0 3.955a3.958 3.958 0 0 0 3.955 3.954h3.008v7.065h1V1h2.015v13.974h1V1h3.985zm-8 6.91H3.955A2.957 2.957 0 0 1 1 3.956a2.958 2.958 0 0 1 2.955-2.955h3.008z" />
                    </svg>
                </label>
                <!-- https://stackoverflow.com/a/72784674/1070215 -->
                <div class="m-0 p-0 button-separator"></div>
                <button id="shuffle-colors" type="button" class="btn btn-outline-light float-end" aria-label="shuffle-colors">
                    <svg width="16" height="16" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 49.7 49.7"
                        xml:space="preserve">
                        <g>
                            <path d="M27,13.85h9v8.964l13.7-9.964L36,2.886v8.964h-9c-7.168,0-13,5.832-13,13c0,6.065-4.935,11-11,11H1c-0.553,0-1,0.447-1,1
                       s0.447,1,1,1h2c7.168,0,13-5.832,13-13C16,18.785,20.935,13.85,27,13.85z M38,6.814l8.3,6.036L38,18.886V6.814z" />
                            <path d="M1,13.85h2c2.713,0,5.318,0.994,7.336,2.799c0.191,0.171,0.43,0.255,0.667,0.255c0.274,0,0.548-0.112,0.745-0.333
                       c0.368-0.412,0.333-1.044-0.078-1.412C9.285,13.025,6.206,11.85,3,11.85H1c-0.553,0-1,0.447-1,1S0.447,13.85,1,13.85z" />
                            <path d="M36,35.85h-9c-2.685,0-5.27-0.976-7.278-2.748c-0.411-0.365-1.044-0.327-1.411,0.089c-0.365,0.414-0.326,1.046,0.089,1.411
                       c2.374,2.095,5.429,3.248,8.601,3.248h9v8.964l13.7-9.964L36,26.886V35.85z M38,30.814l8.3,6.036L38,42.886V30.814z" />
                        </g>
                    </svg>
                </button>
            </div>
        </div>
        <div id="tables" class="transparent-border center-children"></div>
        <h1 id="aletheia" class="text-center p-2 mb-0 d-flex justify-content-between align-items-end">
            <div id="copyright" class="text-body-tertiary float-start">
                ©&nbsp;CT
            </div>
            <a href="https://en.wikipedia.org/wiki/Aletheia" target="_wikipedia">ἀλήθεια</a>
            <!--Truth-->
            <button id="github" type="button" class="btn btn-sm btn-outline-light float-end" aria-label="github">
                <svg width="16" height="16" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" stroke="none" clip-rule="evenodd"
                        d="M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z"
                        transform="scale(64)" /><!-- fill="#1B1F23" -->
                </svg>
            </button>
        </h1>
    </div>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register(
                '/js/sw.js'
            );
        }
    </script>
    <script type="module">
        import { Modal as bsModal } from 'https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/+esm'
        import hammerjs from 'https://cdn.jsdelivr.net/npm/hammerjs@2.0.8/+esm'
        import tinycolor2 from 'https://cdn.jsdelivr.net/npm/tinycolor2@1.6.0/+esm'
        /* PROD
        */
        import { Timer } from './dist/js/TimerClass.min.js';
        /* end PROD */
        /* DEV 
        import { Timer } from './js/TimerClass.js';
        */
        /* end DEV */

        let paragraphBreaks = false // true // 

        class ResultProperty {
            constructor(value) {
                this._value = value;
            }

            // Getter for value
            get value() {
                return this._value;
            }

            // Setter for value
            set value(newValue) {
                if (typeof newValue === 'number') {
                    this._value = newValue;
                } else {
                    console.error('Value must be a number');
                }
            }

            // Method to increment value
            increment() {
                const previous = this._value
                this._value += 1;
                return previous
            }
        }

        class Results {
            constructor() {
                this.reset()
            }

            reset() {
                this._elapsed = new ResultProperty(1);
                this._erred = new ResultProperty(0);
                this._revealed = new ResultProperty(0);
            }

            // Getter for elapsed
            get elapsed() {
                return this._elapsed;
            }

            // Getter for erred
            get erred() {
                return this._erred;
            }

            // Getter for unconcealed
            get unconcealed() {
                return this._revealed;
            }
        }

        let player = null
        class Player {
            constructor() {
                this.results = new Results()
                const resultsModal = document.getElementById('resultsModal')
                resultsModal.addEventListener('hidden.bs.modal', event => {
                    player._timer.close()
                })
                this._timer = new Timer(40, 'timer-svg', this.expired, this.afterTimerClosed);
                this._timer.loadResources()
            }

            stopTimerShowResultsThenCloseTimer(msg, results) {
                // stop number drawing
                clearInterval(player.showNumber)
                // stop timer
                player._timer.stop();
                document.getElementById('results-msg').innerHTML = msg
                document.getElementById('results-elapsed').innerHTML = results.elapsed.value - 1
                document.getElementById('results-unconcealed').innerHTML = results.unconcealed.value
                document.getElementById('results-erred').innerHTML = results.erred.value
                const currentDate = new Date();
                const options = {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: 'numeric',
                    minute: 'numeric',
                    // second: 'numeric',
                    // timeZoneName: 'short',
                };
                const formattedDate = currentDate.toLocaleString('en-US', options);
                document.getElementById('modal-footer').innerHTML = formattedDate
                // show results
                let resultsModal = new bsModal(document.getElementById('resultsModal'));
                resultsModal.show(); // will close timer when dismissed
            }

            expired() {
                setTimeout(() => {
                    player.fail()
                    player.stopTimerShowResultsThenCloseTimer(`Raté&nbsp;!`, player.results)
                }, 100)
            }

            victory() {
                setTimeout(() => {
                    let msg
                    if (this.results.erred.value === 0) {
                        this.tada()
                        msg = `You won!`
                    } else if (this.results.erred.value === 32) {
                        this.boo()
                        msg = `You cheated?!`
                    } else {
                        this.completed_with_errors()
                        msg = `Pas mal, mais peut mieux faire.`
                    }
                    player.stopTimerShowResultsThenCloseTimer(msg, player.results)
                }, 100)
            }

            get playing() {
                return this._timer.timerId != null;
            }

            set playing(value) {
            }

            coin() {
                this._timer.coin.play()

            }

            tada() {
                this._timer.tada.play()
            }

            laughs() {
                this._timer.laughs.play()
                this.results.erred.increment()
            }

            fail() {
                this._timer.fail.play()
            }

            completed_with_errors() {
                this._timer.completed_with_errors.play()
            }

            boo() {
                this._timer.boo.play()
            }

            start() {
                if (this.playing) return
                this._timer.initializeAudio().then(() => {
                    this._timer.start();
                }).catch((error) => {
                    console.error('Error initializing audio context:', error);
                }).finally(() => {
                    document.getElementById('play').classList.add('playing')
                    document.querySelectorAll('#tables td').forEach(elem => {
                        elem.classList.add('translucent')
                    })
                    document.getElementById("shuffle-colors").disabled = true
                    document.getElementById("paragraph-breaks").disabled = true
                })
                this.results.reset()
                function showCountDown(elapsed) {
                    const remaining = 40 - elapsed
                    const darkenedRed = tinycolor2('#ff0000').darken(remaining).toString("hex6");
                    document.getElementById('not_playing').innerHTML = `<span style="color: ${darkenedRed}">${remaining}</span>`
                }
                showCountDown(0)
                this.showNumber = setInterval(() => {
                    showCountDown(this.results.elapsed.increment())
                }, 1000)
            }
            afterTimerClosed() {
                document.getElementById('not_playing').innerHTML = '▶'
                document.getElementById("shuffle-colors").disabled = false
                document.getElementById("paragraph-breaks").disabled = false
                document.getElementById('play').classList.remove('playing')
                document.querySelectorAll('#tables td.false').forEach(elem => { elem.classList.add('translucent') })
                document.querySelectorAll('#tables td.true').forEach(elem => { elem.classList.remove('translucent') })
            }
            stop() {
                clearInterval(player.showNumber)
                this._timer.stop()
                this._timer.close()
            }
        }
        player = new Player()

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]]
            }
        }

        function rotateArray(arr, offset) {
            if (offset == 0) return arr
            const n = arr.length;
            const rotated = arr.slice();

            for (let i = 0; i < n; i++) {
                const newPosition = (i + offset) % n;
                rotated[newPosition] = arr[i];
            }

            return rotated;
        }

        function shuffleNoAdjacentDuplicates(array) {
            const n = array.length;
            const shuffledArray = array.slice()

            let previousValue = null
            for (let i = n - 1; i > 0; i--) {
                const possibles = Array.from({ length: i + 1 }, (_, index) => index);
                let world = possibles;
                if (previousValue !== null) {
                    world = possibles.filter(index => shuffledArray[index] !== previousValue);
                }

                let pos
                if (world.length !== 0) {
                    // Pick a random element in the world of possibles
                    const p = Math.floor(Math.random() * world.length);
                    pos = world[p]
                } else {
                    // Pick a random element in the array
                    pos = Math.floor(Math.random() * i);
                }

                previousValue = shuffledArray[pos];

                // Swap element at position pos with element at position i
                [shuffledArray[i], shuffledArray[pos]] = [shuffledArray[pos], shuffledArray[i]];
            }

            /*
            const countMap = array.reduce((acc, currentValue) => {
                acc[currentValue] = (acc[currentValue] || 0) + 1;
                return acc;
            }, {});

            console.log(countMap)
            */

            const randomPosition = Math.floor(Math.random() * n);
            return rotateArray(shuffledArray, randomPosition);
        }

        function setCellWidth(larger) {
            /* 2*52 + 18 == 2*61 == 122 */
            let cellWidth = '61px'
            if (!larger) {
                cellWidth = '52px'
            }
            document.documentElement.style.setProperty('--cell-width_and_height', cellWidth);
            document.documentElement.style.setProperty('--header-width_and_height', '18px');
            document.documentElement.style.setProperty('--border-color', '#215c4d40');
        }

        function toggleElementsVisibility(elements, displayValueWhenVisible) {
            let display = null;
            for (let tag of elements) {
                if (display == null) {
                    display = tag.style.display !== displayValueWhenVisible ? displayValueWhenVisible : 'none'
                }
                tag.style.display = display
            }
            return display
        }

        const 𝛗 = Symbol('private');
        const 𝛗2 = Symbol('private2');

        class Axes {
            constructor() {
                this[𝛗] = [null, true, false]
                this.visible = false
                setCellWidth(!this.visible)
            }
            iterate(iterator) {
                this[𝛗].forEach(iterator)
            }
            applyVisibility() {
                ((thElements) => {
                    for (let thElement of thElements) {
                        thElement.style.display = this.visible ? "table-cell" : "none"
                    }
                })(document.getElementsByTagName('th'))
            }
            toggleVisibility() {
                const display = toggleElementsVisibility(document.getElementsByTagName('th'), 'table-cell')
                this.visible = display === 'table-cell'
                setCellWidth(!this.visible)
            }
        }
        let axes = new Axes()

        class Colors {
            constructor() {
                let colors = [
                    '#F4F4F4',
                    '#FAC80A',
                    '#B40000',
                    '#00852B',
                    '#1E5AA8',
                    '#8A928D',
                    '#ABD9FF',
                    '#91501C',
                ]
                this.colors = colors.concat(colors)
                this.shuffle()
            }

            colorFalse = 'transparent'
            colorTrue = '#545955'
            currentColorIndex = 0
            nextColor() {
                const currentColor = this.colors[this.currentColorIndex++]
                this.currentColorIndex %= this.colors.length
                if (this.currentColorIndex === 0) {
                    this.shuffle()
                }
                return currentColor
            }
            shuffle() {
                this.colors = shuffleNoAdjacentDuplicates(this.colors)
            }
        }
        const colors = new Colors()

        class OneOrTwoColors {
            constructor(color1, color2) {
                this.c = 0
                this.colors = [color1]
                if (color2) {
                    this.colors.push(color2)
                }
            }
            next() {
                const color = this.colors[this.c]
                this.c = (this.c + 1) % this.colors.length
                return color
            }
        }

        class Functions {
            constructor() {
                this[𝛗] = [
                    0,
                    'false',
                    1,
                    'α & β',
                    'α & !β',
                    '!α & !β',
                    '!α & β',
                    2,
                    'α == β',
                    'α != β',
                    'α',
                    'β',
                    '!α',
                    '!β',
                    3,
                    'α | β',
                    'α | !β',
                    '!α | !β',
                    '!α | β',
                    4,
                    'true',
                ]
                this[𝛗2] = this[𝛗].slice(0)
            }

            iterate(iterator) {
                this[𝛗2].forEach(iterator)
            }

            color(f) {
                if (f === 'false') {
                    return new OneOrTwoColors(colors.colorFalse)
                }
                if (f === 'true') {
                    return new OneOrTwoColors(colors.colorTrue)
                }
                if (f === "α == β" || f === "α != β") {
                    return new OneOrTwoColors(colors.nextColor(), colors.nextColor())
                }
                return new OneOrTwoColors(colors.nextColor())
            }
            shuffle() {
                shuffleArray(this[𝛗2])
            }
            unshuffle() {
                this[𝛗2] = this[𝛗].slice(0)
            }
        }
        const functions = new Functions()

        class Blender {
            constructor() {
                this.previousElement = null
            }

            blend(html, elementID) {
                if (this.previousElement === null) {
                    document.getElementById('tables').innerHTML = html
                } else {
                    this.previousElement.insertAdjacentHTML("afterend", html)
                }
                this.previousElement = document.getElementById(elementID)
            }
        }

        function doIt() {

            if (player.playing) return

            const blender = new Blender()

            functions.iterate((func, index) => {

                const elementID = `element${index}`
                if (typeof func === 'number') {
                    const html = `<div id="${elementID}" class="separator-container" style="display: ${paragraphBreaks ? 'flex' : 'none'};">
    <span class="separator-line separator-line-left"></span>
    <span class="separator-text">${func}</span>
    <span class="separator-line separator-line-right"></span>
</div>
`
                    blender.blend(html, elementID)

                } else {
                    const theadID = `thead${index}`
                    const tbodyID = `tbody${index}`
                    const template = `<div id="${elementID}">
    <table class="table inline table-sm caption-top table-borderless">
        <caption class="text-center">${func}</caption>
        <thead id="${theadID}"></thead>
        <tbody id="${tbodyID}"></tbody>
    </table>
</div>
`
                    blender.blend(template, elementID)

                    let backgroundcolors = functions.color(func)

                    axes.iterate(rowElem => {
                        const row = document.createElement("tr")
                        axes.iterate(colElem => {
                            const col = document.createElement(rowElem === null || colElem === null ? "th" : "td")
                            if (colElem === null) {
                                if (rowElem === null) {
                                    col.innerHTML = '<div class="diagonal-line">&nbsp;</div>'
                                } else {
                                    col.innerHTML = `<div class="vertical-text">${rowElem}</div>`
                                }
                            } else {
                                if (rowElem === null) {
                                    col.innerHTML = `${colElem}`
                                } else {
                                    const α = rowElem
                                    const β = colElem
                                    const result = eval(func)
                                    col.classList.add(result ? 'true' : 'false')
                                    if (result) {
                                        col.style.backgroundColor = backgroundcolors.next()
                                        col.style.color = tinycolor2(col.style.backgroundColor).darken(3).toString("hex6")
                                        col.innerHTML = '●' // '○' // 
                                    } else {
                                        col.style.backgroundColor = colors.colorFalse
                                        col.innerHTML = '❌'
                                        col.classList.add('translucent')
                                    }
                                }
                            }
                            row.appendChild(col)
                        })
                        document.getElementById(rowElem === null ? theadID : tbodyID).appendChild(row)
                    })
                    axes.applyVisibility()
                }
            });

            document.getElementById("aletheia").style.visibility = 'visible'

            document.querySelectorAll('#tables td').forEach(elem => {
                // console.log(elem)
                elem.addEventListener('click', clickEvent => {
                    clickEvent.preventDefault()
                    clickEvent.stopPropagation()
                    if (!player.playing) return
                    if (player.playing) {
                        if (elem.classList.contains('translucent')) {
                            elem.classList.remove('translucent')
                            if (elem.classList.contains('true')) {
                                player.results.unconcealed.increment()

                                function checkDescendantsClasses(element, classA, classX, classY) {
                                    // Find the nearest ancestor with class A
                                    var ancestorWithClassA = findAncestor(element, classA);

                                    if (!ancestorWithClassA) {
                                        console.log('Ancestor with class A not found.');
                                        return false;
                                    }

                                    // Find all descendants of the ancestor with class X
                                    var elementsWithClassX = ancestorWithClassA.getElementsByClassName(classX);

                                    // Convert the HTMLCollection to an array for easier iteration
                                    var elementsArray = Array.from(elementsWithClassX);

                                    // Check if all descendants with class X also have class Y
                                    var allDescendantsHaveClassY = elementsArray.every(function (descendant) {
                                        return !descendant.classList.contains(classY);
                                    });

                                    return allDescendantsHaveClassY;
                                }

                                // Helper function to find the nearest ancestor with a specific class
                                function findAncestor(element, className) {
                                    while ((element = element.parentElement)) {
                                        if (element.classList.contains(className)) {
                                            return element;
                                        }
                                    }
                                    return null;
                                }

                                if (checkDescendantsClasses(elem, 'table', 'true', 'translucent')) {
                                    player.coin()
                                }
                            } else {
                                player.laughs()
                            }
                        }
                    }
                    if (document.querySelectorAll('#tables td.true.translucent').length === 0) {
                        player.victory()
                    }
                })
            })


        }

        window.addEventListener("load", loadEvent => {

            doIt();

            function mega_shuffle() {
                if (player.playing) return
                if (paragraphBreaks) return
                functions.shuffle()
                colors.shuffle()
                doIt()
            }

            const theTables = document.getElementById("tables")
            const hammertime = new hammerjs(theTables);

            hammertime.on('swiperight', function () {
                mega_shuffle()
            });
            hammertime.on('swipeleft', function () {
                mega_shuffle()
            });

            document.getElementById("ab-axes").addEventListener('click', clickEvent => {
                clickEvent.stopPropagation()
                axes.toggleVisibility()
            })

            document.getElementById("paragraph-breaks").addEventListener('click', clickEvent => {
                clickEvent.stopPropagation()
                paragraphBreaks = !paragraphBreaks
                toggleElementsVisibility(document.querySelectorAll('div.separator-container'), 'flex')
                if (paragraphBreaks) {
                    functions.unshuffle()
                    document.getElementById("shuffle-colors").disabled = true
                    theTables.classList.remove("center-children")
                    doIt()
                } else {
                    theTables.classList.add("center-children")
                    document.getElementById("shuffle-colors").disabled = false
                }
            })

            document.getElementById("table-borders").addEventListener('click', clickEvent => {
                clickEvent.stopPropagation()
                if (theTables.classList.contains("transparent-border")) {
                    theTables.classList.remove("transparent-border")
                } else {
                    theTables.classList.add("transparent-border")
                }
            })

            document.getElementById("shuffle-colors").addEventListener('click', clickEvent => {
                clickEvent.preventDefault()
                clickEvent.stopPropagation()
                mega_shuffle()
            })

            document.getElementById("github").addEventListener('click', clickEvent => {
                clickEvent.preventDefault()
                clickEvent.stopPropagation()
                window.open("https://github.com/cthiebaud/truth", "_github");
            })

            document.getElementById("play").addEventListener('click', clickEvent => {
                clickEvent.preventDefault()
                clickEvent.stopPropagation()
                if (player.playing) {
                    player.stop()
                } else {
                    player.start()
                }
            })

        });

    </script>
</body>

</html>