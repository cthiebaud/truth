<!DOCTYPE html>
<html lang="en">

<head>
    <!-- BEGIN Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-TPVM6DVS53"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-TPVM6DVS53');
    </script>
    <!-- END Google tag (gtag.js) -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Unconcealing of Truths</title>
    <meta name="description" content="Unconceal the colored bricks to reveal the truth tables.">

    <meta name="version" content="13">

    <!-- Open Graph data -->
    <!-- https://yoast.com/help/fb-app-id-warnings/
        Facebook’s “default APP ID” : 966242223397117 
        The Unconcealing of Truths : 1379446882965224
        https://developers.facebook.com/apps/1379446882965224/dashboard/
    -->
    <meta property="fb:app_id" content="1379446882965224" />

    <meta property="og:locale" content="en_US">
    <meta property="og:title" content="The Unconcealing of Truths" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://aletheia.cthiebaud.com" />
    <meta property="og:description" content="Unconceal the colored bricks to reveal the truth tables." />
    <meta property="og:site_name" content="aletheia.cthiebaud.com" />

    <meta property="og:image" content="https://aletheia.cthiebaud.com/screenshots/iPad10th.png" />
    <meta property="og:image:url" content="https://aletheia.cthiebaud.com/screenshots/iPad10th.png" />
    <meta property="og:image:type" content="image/jpeg" />
    <meta property="og:image:width" content="2732" />
    <meta property="og:image:height" content="2048" />

    <!-- Imports the manifest to represent the web application. 𝖠 web app must have a manifest to be a PWA. -->
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#f1efe0" />

    <!-- https://realfavicongenerator.net -->
    <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
    <!-- link rel="manifest" href="/favicons/site.webmanifest" -->
    <link rel="mask-icon" href="/favicons/safari-pinned-tab.svg" color="#173f35">
    <link rel="shortcut icon" href="/favicons/favicon.ico">
    <meta name="msapplication-TileColor" content="#f8f7ef">
    <meta name="msapplication-config" content="/favicons/browserconfig.xml">
    <meta name="theme-color" content="#f8f7ef">

    <!-- /* changed by "NODE_ENV=<development|production> node dev-oder-prod.mjs" or "npm run <dev\prod>" */ -->
    <link rel="stylesheet" href='/dist/css/bootstrap.min.css'>
    <link rel="stylesheet" href='/dist/css/index.min.css'>
    <link rel="stylesheet" href='/dist/css/timer.min.css'>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Victor+Mono&family=GFS+Didot&display=swap" rel="stylesheet">
    <!-- BEGIN livejs for test - - >
    <script type="text/javascript" src="https://livejs.com/live.js"></script>
    < ! - - END livejs for test -->
</head>

<body class="">

    <!-- Define the play, stop, tortoise, hare, achilles, etc. SVGs as symbols -->
    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
        <symbol id="svg-play" viewBox="0 0 24 24">
            <path
                d="M21.4086 9.35258C23.5305 10.5065 23.5305 13.4935 21.4086 14.6474L8.59662 21.6145C6.53435 22.736 4 21.2763 4 18.9671L4 5.0329C4 2.72368 6.53435 1.26402 8.59661 2.38548L21.4086 9.35258Z" />
        </symbol>
        <symbol id="svg-stop" viewBox="0 0 24 24">
            <path
                d="M21.4086 9.35258C23.5305 10.5065 23.5305 13.4935 21.4086 14.6474L8.59662 21.6145C6.53435 22.736 4 21.2763 4 18.9671L4 5.0329C4 2.72368 6.53435 1.26402 8.59661 2.38548L21.4086 9.35258Z" />
        </symbol>
        <symbol id="svg-replay" fill="none" viewBox="0 0 24 24">
            <path stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13a7 7 0 1 0 7-7H7m0 0 3-3M7 6l3 3" />
        </symbol>
        <symbol id="svg-tortoise" viewBox="0 0 56 56">
            <path
                d="M20.34 24.87c4.645-.017 8.53-1.656 11.571-5-3.109-3.954-6.403-5.812-11.454-5.829-5.034-.017-8.31 1.605-11.588 5.896 3.091 3.361 7.129 4.95 11.47 4.932Zm21.318 8.142c2.078-.777 3.564-2.55 7.044-2.55 4.41 0 7.298-1.504 7.298-4.005 0-5.76-3.074-9.68-7.67-9.68-3.969 0-6.385 2.4-7.381 6.217-.71 2.517-1.707 3.632-2.89 4.376.829 1.182 2.214 3.615 3.599 5.642Zm-10.524 2.027c1.537-.372 2.905-.591 4.882-.591 1.621 0 3.193-.254 3.97-.693-1.876-2.416-5.187-9.544-6.926-12.247-1.757 1.807-4.579 3.564-6.504 4.324.287 3.041 1.976 6.572 4.578 9.207Zm-21.758.084c2.534-2.432 4.578-6.267 4.899-9.24-2.264-.845-5.018-2.466-6.656-4.206-.794 1.233-1.622 2.567-2.382 4.054-1.571 3.142-3.345 4.595-4.51 5.676-.44.422-.727.912-.727 1.571 0 .98 1.047 1.52 2.889 1.52h2.027c1.909 0 3.193.237 4.46.626Zm39.31-10.338a1.528 1.528 0 0 1-1.538-1.52c0-.828.693-1.52 1.537-1.52.828 0 1.504.692 1.504 1.52a1.51 1.51 0 0 1-1.504 1.52ZM20.288 39.009c3.886 0 6.606-2.027 8.886-3.16-2.584-2.449-4.24-6.064-4.51-9.392a15.891 15.891 0 0 1-4.274.575 16.159 16.159 0 0 1-4.257-.54c-.27 3.107-1.96 6.875-4.544 9.442 2.179.862 4.831 3.075 8.7 3.075ZM4.73 41.88c2.94 0 5.93-1.301 7.365-3.278-1.672-1.098-3.767-2.128-5.743-2.212-.913.236-1.892.287-2.923.49-1.452.27-2.77.86-2.77 2.263 0 1.774 1.757 2.737 4.071 2.737Zm30.56.033c2.314 0 4.07-.962 4.07-2.736 0-1.385-1.317-2.483-2.753-2.602-1.047-.05-1.875-.067-2.94-.135-1.925.101-4.02 1.132-5.726 2.196 1.419 1.994 4.426 3.277 7.348 3.277Z" />
        </symbol>
        <symbol id="svg-hare" viewBox="0 0 56 56">
            <path
                d="M29.346 49.176c1.308 0 2.448-.616 4.916-.616 2.467 0 3.14.616 4.971.616 2.767 0 4.225-1.158 4.225-3.084 0-3.29-3.589-5.495-9.215-5.495-2.766 0-4.019.262-5.57.654l-2.019-4.598c-2-4.411-5.177-7.29-9.7-7.29h-2.206c-.73 0-1.215-.317-1.215-1.028 0-1.159 1.551-1.439 3.252-1.439 5.458 0 9.514 3.01 11.981 9.066l1.271 3.121a20.074 20.074 0 0 1 4.02-.392c1.102 0 2.111.074 3.177.224 1.121-.841 2.43-1.72 4.317-2.542 2.094 1.42 4.468 2.336 6.972 2.336 5.16 0 7.477-1.121 7.477-6 0-5.888-4.262-10.299-9.925-10.28l-5.028-6.673c-2.822-3.664-6.168-5.42-9.477-5.42-2.729 0-6.785 1.57-6.785 3.775 0 1.495 3.028 3.589 5.365 5.028l10.766 6.58c-.841.803-1.607 1.233-2.523 1.233-1.458 0-2.954-.878-5.215-2.187-5.776-3.327-10.206-6.448-16.187-6.448-6.225 0-10.954 3.57-13.477 10.523-2 0-3.514 1.308-3.514 3.234 0 2.168 1.72 3.532 4.075 3.532 2.729 3.813 7.196 5.346 12.486 5.346.28 0 .56-.018.84-.018l7.571 6.28c1.87 1.7 2.953 1.962 4.374 1.962Zm18.748-17.364c-.842 0-1.514-.71-1.514-1.533 0-.84.691-1.588 1.532-1.588.86 0 1.514.672 1.514 1.514 0 .84-.691 1.607-1.532 1.607ZM15.832 50.653c3.607 0 5.794-.691 7.589-1.925l-5.776-4.822c-.262.018-.58.056-.972.056-.935 0-2.318-.28-3.963-.28-2.093 0-3.383 1.12-3.383 2.803 0 2.505 2.542 4.168 6.505 4.168Z" />
        </symbol>
        <symbol id="svg-achilles" viewBox="-50 -50 612 612">
            <style>
                .st0 {
                    fill: #000
                }
            </style>
            <g transform="scale(-1,1) translate(-512,0)">
                <path
                    d="M209.145 273.343c-8.941-6.364-17.106-12.295-23.094-16.882-8.357-6.395-19.547-15.92-31.763-26.711-12.223-10.79-25.447-22.83-37.654-34.084a3998.823 3998.823 0 0 1-24.35-22.662L22.853 410.503l25.23-.008 34.052-95.839h70.617l-15.129 45.394-45.402-1.265-39.095 148.19s152.601 17.026 168.994-30.898c7.54-22.053 14.544-44.354 19.916-62.028l22.845-101.931c-10.222-6.996-35.028-24.03-55.736-38.775zM473.083 471.043c-49.189-54.872 6.308-141.266 6.308-261.065C479.391 90.18 382.903 0 263.104 0 196.49 0 126.001 20.004 70.552 57.041c-6.876 4.595-10.862 15.177 2.746 19.307 22.108 6.692 56.113 21.741 82.336 54.448 22.061-6.996 50.918-13.464 81.952-13.488 25.471 0 52.455 4.41 77.966 16.802 25.503 12.359 49.372 32.771 68.319 63.869a119.206 119.206 0 0 1 13.808 32.707c2.834 11.006 4.01 21.997 4.01 32.667-.024 29.337-8.837 56.256-17.522 75.964a252.81 252.81 0 0 1-5.156 10.919c12.263 4.674 20.172 20.444 24.711 56.481 8.829 69.993 37.822 87.418 58.01 100.258 20.804 13.249 43.545-.032 11.351-35.932z"
                    class="st0" />
                <path
                    d="M346.97 386.537c-1.705-17.034 3.498-28.856 11.719-34.38a223.549 223.549 0 0 0 9.902-19.724c8.108-18.315 16.097-43.218 16.073-69.08 0-9.414-1.041-18.963-3.466-28.433a102.831 102.831 0 0 0-11.854-28.072c-17.435-28.521-38.583-46.403-61.236-57.425-22.653-11.015-46.988-15.089-70.522-15.089-26.295-.024-51.47 5.131-71.561 11.087 5.459 8.716 10.374 18.402 14.472 29.257 0 0-15.009 9.653-33.172 25.983a2125.687 2125.687 0 0 0 18.219 16.33c12.07 10.662 23.117 20.044 30.849 25.951 4.98 3.811 11.791 8.781 19.348 14.184 7.556 5.412 15.873 11.262 23.91 16.874a4550.261 4550.261 0 0 0 36.99 25.527 304.114 304.114 0 0 0 2.602 1.776l4.787 3.258-21.197 94.567c15.545 25.736 48.796 66.552 101.796 63.077 16.401 0 15.136-17.658 15.136-17.658s-30.274-32.787-32.795-58.01z"
                    class="st0" />
            </g>
        </symbol>
        <symbol id="svg-scrambled-false" width="16" height="16" viewBox="0 0 24 24">
            <g transform="scale(-1, 1) translate(-24, 0)">
                <path d="M7 15h15v1H7zm-5 7h20v-1H2zM22 9H12v1h10zm0-6h-5v1h5z" />
            </g>
        </symbol>
        <symbol id="svg-scrambled-true" viewBox="0 0 49.7 49.7">
            <g>
                <path d="M27,13.85h9v8.964l13.7-9.964L36,2.886v8.964h-9c-7.168,0-13,5.832-13,13c0,6.065-4.935,11-11,11H1c-0.553,0-1,0.447-1,1
       s0.447,1,1,1h2c7.168,0,13-5.832,13-13C16,18.785,20.935,13.85,27,13.85z M38,6.814l8.3,6.036L38,18.886V6.814z" />
                <path d="M1,13.85h2c2.713,0,5.318,0.994,7.336,2.799c0.191,0.171,0.43,0.255,0.667,0.255c0.274,0,0.548-0.112,0.745-0.333
       c0.368-0.412,0.333-1.044-0.078-1.412C9.285,13.025,6.206,11.85,3,11.85H1c-0.553,0-1,0.447-1,1S0.447,13.85,1,13.85z" />
                <path d="M36,35.85h-9c-2.685,0-5.27-0.976-7.278-2.748c-0.411-0.365-1.044-0.327-1.411,0.089c-0.365,0.414-0.326,1.046,0.089,1.411
       c2.374,2.095,5.429,3.248,8.601,3.248h9v8.964l13.7-9.964L36,26.886V35.85z M38,30.814l8.3,6.036L38,42.886V30.814z" />
            </g>
        </symbol>
        <!-- 
            <symbol id="svg-scrambled-true" viewBox="0 0 49.701 43.928">
                
                <path
                d="M27 10.964h9v8.964l13.7-9.964L36 0v8.964h-9c-7.168 0-13 5.832-13 13 0 6.065-4.935 11-11 11H1a1 1 0 1 0 0 2h2c7.168 0 13-5.832 13-13 0-6.065 4.935-11 11-11zm11-7.036 8.3 6.036L38 16ZM1 10.964h2c2.713 0 5.318.994 7.336 2.799a.998.998 0 0 0 1.412-.078 1 1 0 0 0-.078-1.412A12.983 12.983 0 0 0 3 8.964H1a1 1 0 1 0 0 2zM36 32.964h-9a10.99 10.99 0 0 1-7.278-2.748 1 1 0 1 0-1.322 1.5 12.988 12.988 0 0 0 8.601 3.248h9v8.964l13.7-9.964L36 24Zm2-5.036 8.3 6.036L38 40z" />
            </symbol>
        -->
    </svg>

    <!-- Modal -->
    <div id="result-modal" class="modal fade" tabindex="-1" aria-labelledby="resultModalLabel" aria-hidden="true">

        <style>
            #modal-body {
                padding-bottom: 0.67rem;
            }

            #modal-body #result-summary {
                display: flex;
                flex-direction: column;
                align-items: center;
            }

            #modal-body #result-summary table {
                margin: auto;
                /* Center the table within the container */
            }

            #modal-body #result-summary table td:first-child {
                text-align: right;
                padding-right: 5px;
            }

            #modal-body #result-summary table td:last-child {
                text-align: left;
                padding-left: 5px;
            }

            #modal-footer {
                font-size: smaller;
                padding-top: .67rem;
                padding-bottom: .67rem;
            }
        </style>

        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title fs-5" id="resultModalLabel">The Unconcealing of Truths</h2>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div id="modal-body" class="modal-body">
                    <h1 id="result-msg"></h1>
                    <style>
                        #result-summary .nowrap-overflow {
                            white-space: nowrap;
                            overflow: hidden;
                            text-overflow: ellipsis;
                            height: 30px;
                        }

                        #result-summary>*>:first-child>* {
                            padding-right: 24px;
                            position: relative;
                        }

                        #result-summary>*>:last-child>* {
                            margin-left: 4px;
                        }

                        #result-summary>*>:first-child>*::after {
                            content: '';
                            position: absolute;
                            bottom: 40%;
                            right: 0;
                            width: 20px;
                            border-top: 1px dotted gray;
                        }
                    </style>
                    <div id="result-summary">
                        <div class="d-flex flex-row">
                            <div class="d-flex flex-column justify-content-between text-end">
                                <div class="nowrap-overflow">Elapsed Time</div>
                                <div class="nowrap-overflow">Unconcealed Bricks</div>
                                <div class="nowrap-overflow">Erred Clicks</div>
                            </div>
                            <div class="d-flex flex-column justify-content-between">
                                <div class="nowrap-overflow victor-mono-400" id="result-elapsed">0′00″0000</div>
                                <div class="nowrap-overflow"><span id="result-unconcealed" class="victor-mono-400">0</span> out of <span class="victor-mono-400">32</span></div>
                                <div class="nowrap-overflow victor-mono-400">
                                    <svg id="empty-set" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" width="16" height="16" viewBox="0 0 142.916 142.916">
                                        <path
                                            d="m32.901 114.799-12.015 16.507a7.308 7.308 0 0 0 5.903 11.61 7.301 7.301 0 0 0 5.917-3.006l12.11-16.638a56.47 56.47 0 0 0 26.644 6.651c31.342 0 56.84-25.499 56.84-56.842 0-15.979-6.636-30.427-17.283-40.764l15.074-20.709a7.31 7.31 0 0 0-1.607-10.21c-3.273-2.377-7.84-1.651-10.209 1.608L99.313 23.562a56.458 56.458 0 0 0-27.856-7.323c-31.343 0-56.842 25.499-56.842 56.841 0 16.477 7.05 31.329 18.286 41.719zm80.781-41.719c0 23.284-18.94 42.226-42.226 42.226-6.407 0-12.461-1.477-17.905-4.039l48.729-66.951c7.051 7.548 11.402 17.648 11.402 28.764zM71.457 30.856c6.901 0 13.403 1.698 19.159 4.646l-49.043 67.381C33.95 95.24 29.229 84.702 29.229 73.082c.003-23.284 18.944-42.226 42.228-42.226z" />
                                    </svg>
                                    <span id="result-erred" style="color:red;"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <style>
                        #cloche {
                            width: 50px;
                            height: 60px;
                            padding: 3px 8px;
                            border-top-left-radius: 3rem;
                            border-top-right-radius: 3rem;
                            border: .5px dashed gray;
                            opacity: .6;
                            background-color: #e7e7e780;
                        }

                        #cloche svg:not(:first-child) {
                            display: none;
                        }

                        #cloche #result-others>* {
                            width: 50%;
                        }

                        #cloche #result-level svg {
                            width: 30px;
                            height: 30px;
                        }

                        #cloche #result-scrambled svg {
                            width: 16px;
                            height: 16px;
                        }

                        /* - - - */

                        #play-again {
                            display: flex;
                            align-items: center;
                            padding: 0.25rem;
                            margin-bottom: -0.375rem;
                        }

                        #play-again label {
                            margin-right: 0.376rem;
                        }

                        #play-again button {
                            width: 36px;
                            height: 36px;
                        }
                    </style>
                    <div class="d-flex justify-content-between align-items-center mt-3">
                        <div id="cloche" class="d-flex flex-column justify-content-evenly">
                            <div id="result-level">
                                <svg id="result-level-tortoise" xmlns="http://www.w3.org/2000/svg">
                                    <use xlink:href="#svg-tortoise"></use>
                                </svg>
                                <svg id="result-level-hare" xmlns="http://www.w3.org/2000/svg">
                                    <use xlink:href="#svg-hare"></use>
                                </svg>
                                <svg id="result-level-achilles" xmlns="http://www.w3.org/2000/svg">
                                    <use xlink:href="#svg-achilles"></use>
                                </svg>
                            </div>
                            <div id="result-others" class="d-flex justify-content-center align-items-center"> <!-- -->
                                <div id="result-display-mode-symbol" style="display: none;">𝖠</div>
                                <div id="result-scrambled">
                                    <svg id="result-scrambled-false" width="16" height="16" xmlns="http://www.w3.org/2000/svg">
                                        <use xlink:href="#svg-scrambled-false"></use>
                                    </svg>
                                    <svg id="result-scrambled-true" width="16" height="16" xmlns="http://www.w3.org/2000/svg">
                                        <use xlink:href="#svg-scrambled-true"></use>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        <div id="play-again" class="ms-auto">
                            <label for="playAgainButton">Start another game</label>
                            <button id="playAgainButton" type="button" class="btn btn-outline-secondary timer-container" aria-label="play-again">
                                <svg class="timer-not-playing" xmlns="http://www.w3.org/2000/svg">
                                    <use xlink:href="#svg-play"></use>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
                <!-- 
                    <div id="modal-footer" class="modal-footer d-flex justify-content-between">
                        <div id="result-timestamp" class="ms-auto" style="margin-right: 1rem;"></div>
                            <button disabled id="replayButton" type="button" class="btn btn-sm my-button btn-outline-secondary" aria-label="re-again"
                            style="margin: 0; padding: 0; display: none;">
                            <svg id="replay" xmlns="http://www.w3.org/2000/svg" style="width: 30px; height: 30px;">
                                <use xlink:href="#svg-replay"></use>
                            </svg>
                        </button>
                    </div>
                -->
            </div>
        </div>
    </div>

    <div id="con" class="container">
        <div id="alpha-beta" class="p-2 d-flex justify-content-between align-items-start">
            <div style="display: flex; align-items: end;">
                <div id="αβ" style="display: flex; align-items: end; height: 48px; user-select: none;">
                    <span style="font-size: 36px;">(𝖠,𝖡)</span>
                </div>
                <svg width="32" height="32" preserveAspectRatio="none" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4 6L10.4 6C13.4928 6 16 8.50721 16 11.6L16 18" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    <path d="M16 18.6L12 15" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    <path d="M16 18.6L20 15" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </div>
            <div id="buttons" class="btn-group btn-group-sm shadow" role="group">

                <!-- BEGIN Button trigger modal for test - - >
                <button type="button" class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#result-modal">
                    result
                </button>
                < ! - - END Button trigger modal for test -->

                <input type="checkbox" class="btn-check" id="table-borders" autocomplete="off" aria-label="table-borders toggle">
                <label class="btn my-button" for="table-borders">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="2 2 20 20">
                        <path stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M3 3h.01M3 12h.01M3 21h.01M3 16.5h.01M3 7.5h.01M7.5 3h.01m-.01 9h.01m-.01 9h.01M16.5 3h.01m-.01 9h.01m-.01 9h.01M12 3h.01M12 12h.01M12 21h.01M12 16.5h.01m-.01-9h.01M21 3h.01M21 12h.01M21 21h.01M21 16.5h.01m-.01-9h.01" />
                    </svg>
                </label>
                <input type="checkbox" class="btn-check" id="ab-axes" autocomplete="off" aria-label="axes toggle">
                <label class="btn my-button" for="ab-axes">
                    <svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" width="16" height="16" viewBox="0 0 488 488">
                        <path stroke="none"
                            d="M487.9 40.927c-2.35 9.897-13.446 14.868-19.292 22.693-8.157 6.418-16.073 22.787-28.015 13.913-11.227-11.134 11.485-21.639 12.022-27.506H50.433v403.485c7.839-7.427 20.099-25.259 29.798-10.102 2.235 12.49-12.18 18.605-18.785 27.395-7.671 5.32-12.84 18.958-23.914 16.414-11.894-7.987-20.681-20.27-31.428-29.828-17.476-14.372 9.54-28.283 17.755-10.45 8.926 12.934 6.328-1.958 6.57-9.992V40.027c2.392-14.958 20.102-8.657 30.706-10.002h392.76C446.513 22.197 428.589 9.94 443.819.32c12.549-2.226 18.67 12.156 27.468 18.793 5.017 7.223 17.043 11.935 16.613 21.815z" />
                    </svg>
                </label>
                <input type="checkbox" class="btn-check" id="paragraph-breaks" autocomplete="off" aria-label="paragraph-breaks toggle">
                <label class="btn my-button" for="paragraph-breaks">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16">
                        <use xlink:href="#svg-scrambled-false"></use>
                    </svg>
                </label>
                <input type="checkbox" class="btn-check" id="canonical-or-javascript" autocomplete="off" aria-label="canonical / javascript toggle">
                <label id="canonical-or-javascript.label" class="btn btn-sm my-button" for="canonical-or-javascript">
                    𝖠
                </label>
            </div>
        </div>

        <div id="tables" class="transparent-border center-children" data-scrambled="false"></div>

        <div id="aletheia" class="text-center p-2 mb-0 d-flex justify-content-between align-items-end">
            <div id="copyright">
                ©&nbsp;CT
            </div>
            <div id="logo" href="https://en.wikipedia.org/wiki/Aletheia" target="_wikipedia"></div>
            <div id="buttons2" class="d-flex flex-column btn-group-vertical shadow" role="group">
                <button id="infos" type="button" class="btn btn-sm my-button" aria-label="infos" style="line-height: 1;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="20" viewBox="0 -2 32 34" style="vertical-align: bottom;">
                        <path
                            d="M18 23h-1v-8.938c0-.011-.003-.021-.003-.031S17 14.011 17 14a1 1 0 0 0-1-1h-2a1 1 0 0 0 0 2h1v8h-1a1 1 0 0 0 0 2h4a1 1 0 0 0 0-2zm-2-12a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm0-11C7.164 0 0 7.163 0 16s7.163 16 16 16 16-7.163 16-16S24.837 0 16 0zm0 30.031c-7.72 0-14-6.312-14-14.032s6.28-14 14-14 14 6.28 14 14-6.28 14.032-14 14.032z" />
                    </svg>
                </button>
            </div>
        </div>
        <style>
            nav#nav.navbar {
                border-top: 0.75px solid var(--border-color);
                background-color: #f1efe0;
                height: 3rem;
                padding: 0;
            }

            nav#nav.navbar #controls {
                display: flex;
                justify-content: space-around;
                align-items: center;
                white-space: nowrap;
            }

            nav#nav.navbar #controls>* {
                text-align: center;
                background-color: transparent;
            }

            nav#nav.navbar #controls>*:not(:first-child):not(:last-child) {
                width: 80px;
            }

            nav#nav.navbar #controls #tortoise-hare-achilles.carousel {
                display: flex;
                justify-content: center;
                align-items: center;
            }

            nav#nav.navbar #controls #tortoise-hare-achilles.carousel .carousel-item>div {
                display: flex;
                justify-content: center;
            }

            nav#nav.navbar #controls #tortoise-hare-achilles.carousel .carousel-item img {
                width: auto;
                height: 30px;
            }

            nav#nav.navbar #controls #tortoise-hare-achilles.carousel button:disabled {
                filter: opacity(0.5);
            }

            nav#nav.navbar #controls #tortoise-hare-achilles.carousel .carousel-control-next-icon,
            nav#nav.navbar #controls #tortoise-hare-achilles.carousel .carousel-control-prev-icon {
                filter: invert(1);
            }
        </style>
        <nav id="nav" class="navbar fixed-bottom align-item-center">
            <div id="controls" class="container" style="visibility: hidden">
                <!-- scramble -->
                <div>
                    <button id="shuffle-all" type="button" class="btn btn-outline-secondary" aria-label="shuffle-all"
                        style="width: 36px; height:36px; border-radius: 3rem; background-color: white; position: relative;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 49.7 49.7" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                            <use xlink:href="#svg-scrambled-true"></use>
                        </svg>
                    </button>
                </div>
                <!-- carousel -->
                <div id="tortoise-hare-achilles" class="left carousel slide" data-bs-wrap="false">
                    <div class="carousel-inner">
                        <div id="tortoise" data-time="120" class="carousel-item active" data-sound="tortoise"><!-- data-bs-interval="0" -->
                            <div>
                                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30">
                                    <use xlink:href="#svg-tortoise"></use>
                                </svg>
                            </div>
                        </div>
                        <div id="hare" data-time="60" class="carousel-item" data-sound="hare"><!-- data-bs-interval="0" -->
                            <div>
                                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30">
                                    <use xlink:href="#svg-hare"></use>
                                </svg>
                            </div>
                        </div>
                        <div id="achilles" data-time="30" class="carousel-item" data-sound="achilles"><!-- data-bs-interval="0" -->
                            <div>
                                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30">
                                    <use xlink:href="#svg-achilles"></use>
                                </svg>
                            </div>
                        </div>
                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#tortoise-hare-achilles" data-bs-slide="prev" disabled>
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#tortoise-hare-achilles" data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>
                <!-- compte à rebours -->
                <div class="compte-à-rebours victor-mono-400"></div>
                <!-- action! -->
                <div>
                    <button id="play" type="button" class="btn btn-outline-secondary timer-container" aria-label="play"
                        style="width:36px; height: 36px; margin: auto; background-color: white !important;">
                        <svg class="timer-not-playing" xmlns="http://www.w3.org/2000/svg">
                            <use xlink:href="#svg-play"></use>
                        </svg>
                        <div class="timer-playing">
                            <svg viewBox="4 4 92 92" xmlns="http://www.w3.org/2000/svg">
                                <g transform="rotate(-90 50 50)">
                                    <circle id="innerCircle1" cx="50" cy="50" r="55" stroke="rgba(23, 63, 53, .25)" stroke-width="46" fill="none" />
                                    <circle id="innerCircle2" cx="50" cy="50" r="40" stroke="rgba(23, 63, 53, .666)" stroke-width="0" fill="none" />
                                </g>
                                <!-- Black square with rounded corners centered -->
                                <rect x="34" y="34" width="32" height="32" rx="5" ry="5" fill="black" />
                            </svg>
                        </div>
                    </button>
                </div>
            </div>
        </nav>

    </div>
    <script>
        /* BEGIN comment for dev */
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/service-worker.js')
                .then((registration) => {
                    console.log('Service Worker registered with scope:', registration.scope)
                })
                .catch((error) => {
                    console.error('Service Worker registration failed:', error)
                })
        }
        /* END comment for dev */
    </script>
    <script type="module">
        import { Modal as bsModal, Carousel as bsCarousel } from 'https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/+esm'
        import hammerjs from 'https://cdn.jsdelivr.net/npm/hammerjs@2.0.8/+esm'
        import bezierEasing from 'https://cdn.jsdelivr.net/npm/bezier-easing@2.1.0/+esm'

        /* changed by "NODE_ENV=<development|production> node dev-oder-prod.mjs" or "npm run <dev|prod>" */
        import { Utils } from './dist/js/UtilsClass.min.js'
        import { Colors, BlurOverlay } from './dist/js/ColorsClass.min.js'
        import { Timer } from './dist/js/TimerClass.min.js'
        import { SoundMachine } from './dist/js/SoundMachineClass.min.js'
        import { Game, Action, Result, ResultProperty } from './dist/js/GameClass.min.js'

        let paragraphBreaks = false // true //

        class CompteARebours {
            #bezierEasing = bezierEasing(0.50, 0.20, 0.50, 1.00)
            #duration
            #animationFrameId
            #animationTimeInMilliseconds

            constructor() {
                this.#duration = 120
                this.#animationTimeInMilliseconds = 600
            }

            get animationTimeInMilliseconds() {
                return this.#animationTimeInMilliseconds;
            };

            set animationTimeInMilliseconds(animationTimeInMillisecondsParam) {
                this.#animationTimeInMilliseconds = animationTimeInMillisecondsParam
            }

            get duration() {
                return this.#duration;
            };

            set duration(duration) {
                this.animateSetDuration(duration)
            };

            animateSetDuration(durationParam) {
                let nextDuration = Number(durationParam);
                let prevDuration = this.duration;
                const startTime = performance.now();
                const updateAnimation = () => {
                    const elapsedTime = Math.min(performance.now() - startTime, this.#animationTimeInMilliseconds);
                    const normalized = Utils.normalizeVraiment(elapsedTime, 0, this.#animationTimeInMilliseconds, 0, 1)
                    const bezierized = this.#bezierEasing(normalized)
                    const whereAreWe = prevDuration + bezierized * (nextDuration - prevDuration)
                    this._duration_ = whereAreWe

                    if (elapsedTime < this.animationTimeInMilliseconds) {
                        requestAnimationFrame(updateAnimation);
                    } else {
                        this._duration_ = nextDuration
                    }
                };

                cancelAnimationFrame(this.#animationFrameId);
                this.#animationFrameId = requestAnimationFrame(updateAnimation);
            }

            set _duration_(durationParam) {
                if (!Utils.isFiniteNumber(durationParam)) throw new Error(`not a finite number: ${durationParam} !`)
                this.#duration = durationParam;
                const gradientizedColor = Colors.mapNumberToColor(this.#duration);
                const element = document.querySelector(".compte-à-rebours");
                element.innerHTML = `<span style="color: ${gradientizedColor}">${Utils.formatDuration(this.#duration)}</span>`;
            };
        }

        class Games {
            #currentGame = undefined
            #games = []
            #callbacks
            constructor(callbacks) {
                this.#callbacks = {
                    onNext: () => { },
                    onPrev: () => { },
                };

                // Override default callbacks with provided callbacks
                this.#callbacks = Object.assign(this.#callbacks, callbacks);
            }
            get games() {
                return this.#games
            }
            newGame(screenshot, level) {
                this.#games.push(new Game(screenshot, level))
                this.#currentGame = this.#games.length - 1
            }
            currentGame() {
                if (0 <= this.#currentGame && this.#currentGame < this.#games.length) {
                    return this.#games[this.#currentGame]
                }
                return undefined
            }
            prev() {
                if (0 < this.#currentGame) {
                    this.#currentGame -= 1
                    return this.#callbacks.onPrev(this.#currentGame)
                }
                console.log("cannot prev", this.#currentGame)
            }
            next() {
                if (this.#currentGame < this.#games.length - 1) {
                    this.#currentGame += 1
                    return this.#callbacks.onNext(this.#currentGame)
                }
                console.log("cannot next", this.#currentGame)
            }
        }
        function onNextGame(gameIndex) {
            console.log("onNextGame", gameIndex, games.games.length)
        }
        function onPrevGame(gameIndex) {
            console.log("onPrevGame", gameIndex, games.games.length)
        }
        const games = new Games({
            onPrev: onPrevGame,
            onNext: onNextGame,
        })

        let player = null
        class Player {
            #restarting
            constructor() {
                const resultModal = document.getElementById("result-modal")
                resultModal.addEventListener('hidden.bs.modal', event => {
                    player.stop()
                })
                this.restarting = false

                this._soundMachine = new SoundMachine()
                document.getElementById('controls').style.visibility = 'visible'

                this.compteARebours = new CompteARebours()
                this.compteARebours.duration = Number(document.querySelector('.carousel-item.active').dataset.time)
                this._timer = new Timer(this.compteARebours.duration, 'play', {
                    onStart: this.onTimerStart,
                    onTick: this.onTimerTick,
                    onExpired: this.onTimerExpired,
                    onStop: this.onTimerStop,
                    onClose: this.onTimerClose,
                })

                this.tortoiseHareAchilles = new bsCarousel(document.getElementById('tortoise-hare-achilles'), {})
                let startSlide = undefined
                document.getElementById('tortoise-hare-achilles').addEventListener('slide.bs.carousel', event => {
                    // console.log(event)
                    startSlide = performance.now()
                    this.compteARebours.animateSetDuration(event.relatedTarget.dataset.time)
                })
                document.getElementById('tortoise-hare-achilles').addEventListener('slid.bs.carousel', event => {
                    // console.log(event)
                    if (startSlide) {
                        this.compteARebours.animationTimeInMilliseconds = performance.now() - startSlide
                    }
                    // BEGIN CAROUSEL
                    const carousel = document.getElementById('tortoise-hare-achilles')
                    const active = carousel.querySelector('.carousel-item.active')
                    carousel.style.opacity = '1'
                    carousel.querySelector('.carousel-control-next').disabled = false
                    carousel.querySelector('.carousel-control-prev').disabled = false
                    if (active.id === 'tortoise') {
                        carousel.querySelector('.carousel-control-prev').disabled = true
                    } else if (active.id === 'achilles') {
                        carousel.querySelector('.carousel-control-next').disabled = true
                    }
                    // END CAROUSEL
                })

            }

            get restarting() {
                // console.log(`GET restarting ${this.#restarting}`)
                return this.#restarting
            }
            set restarting(restarting) {
                // console.log(`SET restarting from ${this.#restarting} to ${restarting}`)
                this.#restarting = restarting
            }

            get level() {
                return document.querySelector('.carousel-item.active').dataset.sound
            }

            stopTimerShowResultThenCloseTimer(msg, result) {
                // stop timer
                player.result.timerDuration = player._timer.stop()

                document.getElementById('result-msg').innerHTML = msg

                Array.from(document.querySelectorAll('#cloche svg')).forEach(elem => {
                    elem.style.display = 'none'
                })

                Utils.safeGetElementByIdThen('result-display-mode-symbol', (element, arg) => { element.innerHTML = arg }, result.displayModeSymbol);

                document.getElementById(`result-level-${result.level}`).style.display = 'block'
                document.getElementById(`result-scrambled-${result.scrambled}`).style.display = 'block'

                document.getElementById('result-elapsed').innerHTML = Utils.formatDuration(result.timerDuration, 'milliseconds')
                document.getElementById('result-unconcealed').innerHTML = result.unconcealed.value
                if (result.erred.value !== 0) {
                    document.getElementById('empty-set').style.display = 'none'
                    document.getElementById('result-erred').innerHTML = result.erred.value
                } else {
                    document.getElementById('result-erred').innerHTML = ''
                    document.getElementById('empty-set').style.display = 'block'

                }

                const currentDate = new Date()
                const options = {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: 'numeric',
                    minute: 'numeric',
                    // second: 'numeric',
                    // timeZoneName: 'short',
                }

                Utils.safeGetElementByIdThen('result-timestamp', (element, arg) => { element.innerHTML = arg }, currentDate.toLocaleString('en-US', options));

                games.currentGame()?.dump()

                // show result
                let resultModal = new bsModal(document.getElementById("result-modal"))
                resultModal.show() // will close timer when dismissed
            }

            onTimerStart() {
                player._soundMachine.underwater.play();
                player._soundMachine[player.level].play();
            }

            onTimerTick(totalTime, ticks) {
                player.compteARebours.duration = (totalTime - ticks)
                player.result.elapsed.increment()

                if (player.compteARebours.duration <= 17 && !player._soundMachine.riser.playing()) {
                    player._soundMachine.riser.play()
                }
            }

            onTimerExpired() {
                requestAnimationFrame(() => { // let the javascript paint everything it needs to paint before brining the modal
                    let msg
                    if (player.result.erred.value === 0 && player.result.unconcealed.value === 0) {
                        player.boredom()
                        msg = `Rather quiet today, isn't it?`
                    } else {
                        player.fail()
                        msg = `Time's up!`
                    }
                    player.stopTimerShowResultThenCloseTimer(msg, player.result)
                })
            }

            onTimerStop() {
                if (player.level === 'achilles') {
                    // can listen to the complete warrior music only when victory, otherwise, fade !
                    if (!player.result.victory) {
                        player._soundMachine[player.level].fade(undefined, 0.001, 2500);
                    }
                } else {
                    // always stop tic-tac
                    player._soundMachine[player.level].fade(undefined, 0.001);
                }
                player._soundMachine.underwater.fade(undefined, 0.001);
                player._soundMachine.riser.fade(undefined, 0.001, 1500);
            }

            onTimerClose() {
                document.getElementById("shuffle-all").disabled = false
                document.getElementById("paragraph-breaks").disabled = false
                player.unveilBricks()
                player._soundMachine[player.level].stop()
                player._soundMachine.underwater.stop()
            }

            victory() {
                requestAnimationFrame(() => { // let the javascript paint everything it needs to paint before brining the modal
                    let msg
                    if (player.result.erred.value >= 32 && player.result.unconcealed.value === 0) {
                        player.guitar()
                        msg = `Ooooh&hellip; Subtle!`
                    } else if (player.result.erred.value === 0 && player.result.unconcealed.value === 32) {
                        if (player.level != 'achilles' || !player.result.victory) {
                            player.tada()
                        } else {
                            player.gong()
                        }
                        msg = `You won!`
                    } else if (player.result.erred.value >= 28 && player.result.unconcealed.value === 32) {
                        player.boo()
                        msg = `You cheated?!`
                    } else {
                        player.completed_with_errors()
                        msg = `You <i>quasi</i> won&hellip;`
                    }
                    player.stopTimerShowResultThenCloseTimer(msg, player.result)
                })
            }

            get isPlaying() {
                return document.getElementById('play').classList.contains('playing')
            }

            set isPlaying(newIsPlaying) {
                const currentIsPlaying = this.isPlaying
                if (currentIsPlaying !== newIsPlaying) {
                    if (newIsPlaying) {
                        document.getElementById('play').classList.add('playing')
                    } else {
                        document.getElementById('play').classList.remove('playing')
                    }
                }
            }

            coin() {
                this._soundMachine.coin.play()
            }

            tada() {
                this._soundMachine.tada.play()
            }

            gong() {
                this._soundMachine.gong.play()
            }

            laughs() {
                this._soundMachine.laughs.play()
                this.result.erred.increment()
            }

            fail() {
                this._soundMachine.fail.play()
            }

            abortSound() {
                this._soundMachine.abort.play()
            }

            completed_with_errors() {
                this._soundMachine.completed_with_errors.play()
            }

            boo() {
                this._soundMachine.boo.play()
            }

            guitar() {
                this._soundMachine.guitar.play()
            }

            boredom() {
                this._soundMachine.boredom.play()
            }

            veilBricks() {
                this.veilUnveilBricks('veil')
            }

            unveilBricks() {
                if (!this.restarting) this.veilUnveilBricks('unveil')
            }

            async veilUnveilBricks(veilParam) {
                const veil = veilParam === 'veil';

                function methodThatReturnsAPromise(tbody, veil) {
                    return new Promise((resolve) => {
                        const tds = tbody.querySelectorAll('td')
                        if (veil) {
                            tds.forEach(td => {
                                td.classList.add('translucent')
                                td.classList.remove('clicked')
                            })
                        } else {
                            tds.forEach(td => {
                                if (td.classList.contains('true')) {
                                    td.classList.remove('translucent')
                                } else if (td.classList.contains('false')) {
                                    td.classList.add('translucent')
                                }
                            })
                        }
                        setTimeout(() => {
                            resolve(tbody)
                        }, 25);
                    })
                }

                const tbodies = Array.from(document.querySelectorAll('#tables tbody'))
                for (let i = 0; i < tbodies.length; i++) {
                    const index = veil ? i : tbodies.length - 1 - i
                    const tbody = tbodies[index]
                    await methodThatReturnsAPromise(tbody, veil);
                }
            }

            async start() {
                if (this.isPlaying) {
                    return
                }
                this.isPlaying = true
                games.newGame(screenshot(), this.level)
                this.result = new Result(this.level, document.getElementById('tables').dataset.scrambled, functions.displayMode.symbol)
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth' // Use 'smooth' for smooth scrolling
                })
                await this.veilBricks()
                const totalTime = Number(document.querySelector('.carousel-item.active').dataset.time)
                this._timer.start(totalTime)
                document.getElementById("shuffle-all").disabled = true
                document.getElementById("paragraph-breaks").disabled = true
                // BEGIN CAROUSEL
                document.getElementById('tortoise-hare-achilles').style.opacity = '.5'
                document.querySelectorAll('#tortoise-hare-achilles button').forEach(button => {
                    button.disabled = true
                })
                // END CAROUSEL
                this.result.reset()
                this.restarting = false
            }

            abort() {
                requestAnimationFrame(() => { // let the javascript paint everything it needs to paint before brining the modal
                    player.abortSound()
                    let msg = `You stopped!`
                    player.stopTimerShowResultThenCloseTimer(msg, player.result)
                })
            }

            stop() {
                // if (!this.playing) return
                this.isPlaying = false
                this.compteARebours.duration = Number(document.querySelector('.carousel-item.active').dataset.time)
                // BEGIN CAROUSEL
                const carousel = document.getElementById('tortoise-hare-achilles')
                const active = carousel.querySelector('.carousel-item.active')
                carousel.style.opacity = '1'
                carousel.querySelector('.carousel-control-next').disabled = false
                carousel.querySelector('.carousel-control-prev').disabled = false
                if (active.id === 'tortoise') {
                    carousel.querySelector('.carousel-control-prev').disabled = true
                } else if (active.id === 'achilles') {
                    carousel.querySelector('.carousel-control-next').disabled = true
                }
                // END CAROUSEL
                if (this.result) this.result.timerDuration = this._timer.stop()
                this._timer.close()
            }
        }
        player = new Player()

        class Axes {
            static setCellWidth(larger) {
                /* 2*52 + 18 == 2*61 == 122 */
                let cellWidth = '61px'
                if (!larger) {
                    cellWidth = '52px'
                }
                document.documentElement.style.setProperty('--cell-width_and_height', cellWidth)
                document.documentElement.style.setProperty('--header-width_and_height', '18px')
                document.documentElement.style.setProperty('--border-color', '#215c4d40')
            }

            constructor() {
                this.axesArray = [null, true, false]
                this.visible = false
                Axes.setCellWidth(!this.visible)
            }
            iterate(iterator) {
                this.axesArray.forEach(iterator)
            }
            applyVisibility() {
                ((thElements) => {
                    for (let thElement of thElements) {
                        thElement.style.display = this.visible ? "table-cell" : "none"
                    }
                })(document.getElementsByTagName('th'))
            }
            toggleVisibility() {
                const displayStyle = Utils.toggleElementsVisibility(document.getElementsByTagName('th'), 'table-cell')
                this.visible = displayStyle === 'table-cell'
                Axes.setCellWidth(!this.visible)
            }
        }
        const axes = new Axes()
        const colors = new Colors()

        class OneOrTwoColors {
            constructor(color1, color2) {
                this.c = 0
                this.colors = [color1]
                if (color2) {
                    this.colors.push(color2)
                }
            }
            next() {
                const color = this.colors[this.c]
                this.c = (this.c + 1) % this.colors.length
                return color
            }
        }

        class Functions {
            #functionArray = [
                0,
                'false',
                1,
                'α & β',
                'α & !β',
                '!α & !β',
                '!α & β',
                2,
                'α',
                'β',
                '!α',
                '!β',
                'α == β',
                'α != β',
                3,
                'α | β',
                'α | !β',
                '!α | !β',
                '!α | β',
                4,
                'true',
            ]
            #displayMode = {
                'canonical': {
                    symbol: '𝖠',
                    facade: "(𝖠,𝖡)",
                    key: 'canonical'
                },
                'javascript': {
                    symbol: 'α',
                    facade: "(α,β)",
                    key: 'javascript'
                }
            }
            #currentDisplayModeKey = 'canonical'
            constructor() {
                const negationMap = {
                    '!α': "<span class='negation canonical'>𝖠</span>",
                    '!β': "<span class='negation canonical'>𝖡</span>"
                };
                this.#functionArray.forEach(item => {
                    if (typeof item === 'string') {
                        const key = item
                        // javascript
                        {
                            this.#displayMode.javascript[key] = item
                                /*
                                .replace(/α & β \| !α & !β/g, "α == β")
                                .replace(/!α & β \| α & !β/g, "α != β")
                                */
                                .replace(/true/g, "Τ")
                                .replace(/false/g, "&nbsp;")
                        }
                        // canonical 
                        {
                            let tmp = item
                                .replace(/α == β/g, "α ⊻ β")
                                .replace(/α != β/g, "α ⊻ !β")
                            /*
                            cf. CSS rule for .negation.canonical:before
                            ¬
                            */
                            tmp = tmp.replace(/(!?)α|(!?)β/g, (match, negationA, negationB) => {
                                if (negationA === '!') {
                                    return negationMap['!α'];
                                } else if (negationB === '!') {
                                    return negationMap['!β'];
                                } else {
                                    return match === 'α' ? '𝖠' : '𝖡';
                                }
                            });
                            this.#displayMode.canonical[item] = tmp
                                .replace(/&/g, "∧")
                                .replace(/\|/g, "∨")
                                .replace(/true/, "⊤")
                                .replace(/false/, "⊥")
                        }
                    }
                });
            }

            iterate(iterator) {
                this.#functionArray.forEach(iterator)
            }

            getOneOrTwoColors(f) {
                if (f === 'false') {
                    return new OneOrTwoColors(colors.colorFalse)
                }
                if (f === 'true') {
                    return new OneOrTwoColors(colors.colorTrue)
                }
                if (f.includes('!=') || f.includes('==')) {
                    return new OneOrTwoColors(colors.nextColor(), colors.nextColor())
                }
                return new OneOrTwoColors(colors.nextColor())
            }
            toggleDisplay() {
                this.#currentDisplayModeKey = this.#currentDisplayModeKey === 'canonical' ? 'javascript' : 'canonical'
            }
            get displayMode() {
                return this.#displayMode[this.#currentDisplayModeKey]
            }
        }
        const functions = new Functions()
        document.querySelector('#αβ > span').innerHTML = functions.displayMode.facade

        class Blender {
            constructor() {
                this.previousElement = null
            }

            blend(html, elementID) {
                if (this.previousElement === null) {
                    document.getElementById('tables').innerHTML = html
                } else {
                    this.previousElement.insertAdjacentHTML("afterend", html)
                }
                this.previousElement = document.getElementById(elementID)
            }
        }

        function screenshot() {
            return Array.from(document.querySelectorAll('#tables>div')).map(element => {
                return element.dataset.function;
            })
        }

        function scrambleIt(originalElementsArray, shuffleParam = true) {
            // Detach each element with an ID
            const detachedElements = originalElementsArray.map(element => {
                const parent = element.parentNode;
                parent.removeChild(element);
                return element;
            });

            // Shuffle the detached elements
            document.getElementById('tables').dataset.scrambled = false
            if (shuffleParam) {
                Utils.shuffleArray(detachedElements);
                document.getElementById('tables').dataset.scrambled = true
            }

            // Reattach the shuffled elements
            detachedElements.forEach(element => {
                document.getElementById('tables').appendChild(element);
            });
        }

        function shuffleBrickColors(originalElementsArray) {
            originalElementsArray.forEach(elem => {
                if (elem.dataset.function) {
                    let backgroundcolors = functions.getOneOrTwoColors(elem.dataset.function)
                    elem.querySelectorAll('td.true').forEach(trueTD => {
                        trueTD.style.backgroundColor = backgroundcolors.next()
                        trueTD.style.color = colors.bg2color(trueTD.style.backgroundColor)
                    })
                }
            })
        }

        function doIt() {

            if (player.isPlaying) return

            const blender = new Blender()

            functions.iterate((func, index) => {

                const elementID = `element${index}`
                if (typeof func === 'number') {
                    const html = `<div id="${elementID}" class="separator-container" style="display: ${paragraphBreaks ? 'flex' : 'none'};">
        <span class="separator-line separator-line-left"></span>
        <span class="separator-text">${func}</span>
        <span class="separator-line separator-line-right"></span>
    </div>
    `
                    blender.blend(html, elementID)

                } else {
                    const theadID = `thead${index}`
                    const tbodyID = `tbody${index}`
                    const template = `<div id="${elementID}" data-function="${func}">
        <table class="table inline table-sm caption-top table-borderless">
            <caption class="text-center">${functions.displayMode[func]}</caption>
            <thead id="${theadID}"></thead>
            <tbody id="${tbodyID}"></tbody>
        </table>
    </div>
    `
                    blender.blend(template, elementID)

                    let backgroundcolors = functions.getOneOrTwoColors(func)

                    axes.iterate(rowElem => {
                        const row = document.createElement("tr")
                        axes.iterate(colElem => {
                            const col = document.createElement(rowElem === null || colElem === null ? "th" : "td")
                            if (colElem === null) {
                                if (rowElem === null) {
                                    col.innerHTML = '<div class="diagonal-line">&nbsp;</div>'
                                } else {
                                    col.innerHTML = `<div class="vertical-text">${rowElem}</div>`
                                }
                            } else {
                                if (rowElem === null) {
                                    col.innerHTML = `${colElem}`
                                } else {
                                    const α = rowElem
                                    const β = colElem
                                    const result = eval(func)
                                    col.classList.add(result ? 'true' : 'false')
                                    if (result) {
                                        col.style.backgroundColor = backgroundcolors.next()
                                        col.style.color = colors.bg2color(col.style.backgroundColor)
                                        col.innerHTML = '●' // '○' // 
                                    } else {
                                        col.style.backgroundColor = colors.colorFalse
                                        col.innerHTML = '❌'
                                        col.classList.add('translucent')
                                    }
                                }
                            }
                            row.appendChild(col)
                        })
                        document.getElementById(rowElem === null ? theadID : tbodyID).appendChild(row)
                    })
                    axes.applyVisibility()
                }
            })

            document.getElementById("aletheia").style.visibility = 'visible'

            document.querySelectorAll('#tables td').forEach(elem => {

                elem.addEventListener('click', clickEvent => {
                    clickEvent.preventDefault()
                    clickEvent.stopPropagation()
                    if (!player.isPlaying) return

                    // action
                    player.currentGame?.addAction(new Action(clickEvent))

                    if (elem.classList.contains('translucent')) {
                        elem.classList.remove('translucent')
                        if (elem.classList.contains('true')) {
                            player.result.unconcealed.increment()

                            function checkDescendantsClasses(element, classA, classX, classY) {
                                // Find the nearest ancestor with class A
                                let ancestorWithClassA = findAncestor(element, classA)

                                if (!ancestorWithClassA) {
                                    return false
                                }

                                // Find all descendants of the ancestor with class X
                                let elementsWithClassX = ancestorWithClassA.getElementsByClassName(classX)

                                // Convert the HTMLCollection to an array for easier iteration
                                let elementsArray = Array.from(elementsWithClassX)

                                // Check if all descendants with class X also have class Y
                                let allDescendantsHaveClassY = elementsArray.every(function (descendant) {
                                    return !descendant.classList.contains(classY)
                                })

                                return allDescendantsHaveClassY
                            }

                            // Helper function to find the nearest ancestor with a specific class
                            function findAncestor(element, className) {
                                while ((element = element.parentElement)) {
                                    if (element.classList.contains(className)) {
                                        return element
                                    }
                                }
                                return null
                            }

                            if (checkDescendantsClasses(elem, 'table', 'true', 'translucent')) {
                                player.coin()
                            }
                        } else {
                            player.laughs()
                            elem.classList.add('clicked')
                            setTimeout(() => {
                                elem.classList.add('translucent')
                            }, 1000)
                        }
                    }
                    let remainingTrue = document.querySelectorAll('#tables td.true.translucent').length
                    let falseClicked = document.querySelectorAll('#tables td.false.clicked').length
                    if ((remainingTrue === 0)
                        ||
                        (falseClicked === 32 && remainingTrue === 32)) {
                        player.victory()
                    }
                })

            })

            // BEGIN HINTS 
            let timout = null
            let overlay = new BlurOverlay('td')
            function clearHints() {
                if (timout) {
                    clearTimeout(timout)
                    timout = null
                }
                const hints = document.querySelectorAll('.hint')
                Array.from(hints).forEach((hint) => {
                    hint.classList.remove("hint")
                })
                overlay.hide()
                player._soundMachine.underwater.fade(undefined, 0.001, 1500)
            }
            window.addEventListener("scroll", function (e) {
                clearHints()
            })
            window.addEventListener("touchmove", function (e) {
                clearHints()
            })
            const captions = document.getElementsByTagName('caption')
            Array.from(captions).forEach((caption) => {
                caption.addEventListener('pointerdown', (e) => {

                    if (!player.isPlaying) return

                    overlay.move(caption.parentNode)
                    overlay.show()

                    caption.setPointerCapture(e.pointerId);
                    player._soundMachine.underwater.fade(undefined, 0.33)

                    timout = setTimeout(() => {
                        e.target.parentNode.classList.add("hint")
                        e.target.parentNode.parentNode.classList.add("hint")
                    }, 300);
                })
                caption.addEventListener('pointerup', (e) => {
                    clearHints()
                    caption.releasePointerCapture(e.pointerId);
                })
            })
            // END HINTS 

            // Get all elements with the selector '#tables>div'
            return Array.from(document.querySelectorAll('#tables>div'))
        }

        window.addEventListener("load", loadEvent => {

            const originalElementsArray = doIt()

            function mega_shuffle() {
                if (player.isPlaying) return
                if (paragraphBreaks) return
                scrambleIt(originalElementsArray)
            }

            function mega_reorder() {
                if (player.isPlaying) return
                if (document.getElementById('tables').dataset.scrambled === 'false') {
                    shuffleBrickColors(originalElementsArray)
                } else {
                    scrambleIt(originalElementsArray, false)
                }
            }

            function toggle_borders() {
                if (document.getElementById("tables").classList.contains("transparent-border")) {
                    document.getElementById("tables").classList.remove("transparent-border")
                } else {
                    document.getElementById("tables").classList.add("transparent-border")
                }
            }

            function toggle_paragraphs() {
                if (player.isPlaying) return
                paragraphBreaks = !paragraphBreaks
                Utils.toggleElementsVisibility(document.querySelectorAll('div.separator-container'), 'flex')
                if (paragraphBreaks) {
                    document.getElementById("shuffle-all").disabled = true
                    document.getElementById("tables").classList.remove("center-children")
                    scrambleIt(originalElementsArray, false)
                } else {
                    document.getElementById("tables").classList.add("center-children")
                    document.getElementById("shuffle-all").disabled = false
                }
            }

            function toggle_displayMode() {
                functions.toggleDisplay()
                if (functions.displayMode.key === 'canonical') {
                    document.getElementsByTagName('body')[0].classList.remove('javascript')
                } else {
                    document.getElementsByTagName('body')[0].classList.add('javascript')
                }
                document.getElementById('canonical-or-javascript.label').innerHTML = functions.displayMode.symbol
                document.querySelector('#αβ > span').innerHTML = functions.displayMode.facade
                document.querySelectorAll('[data-function] caption').forEach((c) => {
                    c.innerHTML = functions.displayMode[c.parentNode.parentNode.dataset.function]
                })
            }

            const hammertime = new hammerjs(document.getElementById("tables"))

            hammertime.on('swiperight', function () {
                // mega_shuffle()
                games.prev()
            })
            hammertime.on('swipeleft', function () {
                // mega_reorder()
                games.next()
            })

            document.getElementById("table-borders").addEventListener('click', clickEvent => {
                clickEvent.stopPropagation()
                toggle_borders()
            })

            document.getElementById("ab-axes").addEventListener('click', clickEvent => {
                clickEvent.stopPropagation()
                axes.toggleVisibility()
            })

            document.getElementById("paragraph-breaks").addEventListener('click', clickEvent => {
                clickEvent.stopPropagation()
                toggle_paragraphs()
            })

            document.getElementById("shuffle-all").addEventListener('click', clickEvent => {
                clickEvent.preventDefault()
                clickEvent.stopPropagation()
                mega_shuffle()
            })

            document.getElementById("canonical-or-javascript")?.addEventListener('click', clickEvent => {
                clickEvent.stopPropagation()
                toggle_displayMode()
            })

            document.getElementById("infos").addEventListener('click', clickEvent => {
                clickEvent.preventDefault()
                clickEvent.stopPropagation()
                window.open("/showdown.html?/HOWTO.md", "_howto")
            })

            {
                function playToggle(event) {
                    event.preventDefault()
                    event.stopPropagation()
                    if (player.isPlaying) {
                        player.abort()
                    } else {
                        player.start()
                    }
                }
                function playAgain() {
                    player.restarting = true
                    player.veilBricks()
                    let resultModal = document.getElementById("result-modal")
                    resultModal.addEventListener('hidden.bs.modal', event => {
                        requestAnimationFrame(() => { // let the javascript paint everything it needs to paint before brining the modal
                            // player.stop() // already in initial hidden.bs.modal event
                            mega_shuffle()
                            player.start()
                        })
                    }, { once: true, })
                    let modal = bsModal.getInstance(resultModal)
                    modal.hide()
                }

                document.getElementById("play").addEventListener('click', clickEvent => {
                    playToggle(clickEvent)
                    // remove focus from element
                    document.activeElement?.blur()
                })
                document.addEventListener('keyup', function (keyboardEvent) {
                    {
                        const element = document.getElementById("result-modal");
                        const computedStyle = window.getComputedStyle(element);
                        const displayValue = computedStyle.getPropertyValue("display");
                        // console.log('modal', displayValue, 'event.code', event.code)
                        if (displayValue !== 'none') {
                            if (event.code === 'Space') {
                                playAgain()
                            }
                            return
                        }
                    }
                    switch (event.code) {
                        case 'Space':
                            playToggle(keyboardEvent);
                            break;
                        case 'Escape':
                            if (player.isPlaying) {
                                player.stop();
                            }
                            break;
                        case 'KeyS':
                            mega_shuffle();
                            break;
                        case 'KeyO':
                            mega_reorder();
                            break;
                        case 'KeyQ':
                            toggle_borders();
                            break;
                        case 'KeyW':
                            axes.toggleVisibility();
                            break;
                        case 'KeyE':
                            toggle_paragraphs();
                            break;
                        case 'KeyA':
                            toggle_displayMode();
                            break;
                        case 'ArrowRight':
                            if (!player.isPlaying) {
                                if (keyboardEvent.altKey) {
                                    player.tortoiseHareAchilles.next();
                                } else {
                                    games.next()
                                }
                            }
                            break;
                        case 'ArrowLeft':
                            if (!player.isPlaying) {
                                if (keyboardEvent.altKey) {
                                    player.tortoiseHareAchilles.prev();
                                } else {
                                    games.prev()
                                }
                            }
                            break;
                    }
                })

                document.getElementById("play-again").addEventListener('click', clickEvent => {
                    clickEvent.preventDefault()
                    clickEvent.stopPropagation()
                    playAgain()
                })
            }

            // BEGIN CAROUSEL
            ;[...document.getElementsByClassName('carousel-item')].forEach(carouselItem => {
                carouselItem.addEventListener('click', clickEvent => {
                    clickEvent.preventDefault()
                    clickEvent.stopPropagation()

                    if (player.isPlaying) return

                    const target = clickEvent.target;
                    const rect = target.getBoundingClientRect();
                    const clickX = event.clientX - rect.left;
                    const midpoint = rect.width / 2;

                    if (clickX < midpoint) {
                        // Clicked on the left half
                        player.tortoiseHareAchilles.prev()
                    } else {
                        // Clicked on the right half
                        player.tortoiseHareAchilles.next()
                    }
                })
            });
            // END CAROUSEL


        })

    </script>
</body>

</html>