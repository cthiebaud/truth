<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-TPVM6DVS53"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-TPVM6DVS53');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Unconcealment of Truths</title>
    <meta name="description" content="Unconceal the colored bricks to reveal the truth tables.">

    <meta name="version" content="13">

    <!-- Open Graph data -->
    <!-- https://yoast.com/help/fb-app-id-warnings/
        Facebook’s “default APP ID” : 966242223397117 
        The Unconcealment of Truths : 1379446882965224
        https://developers.facebook.com/apps/1379446882965224/dashboard/
    -->
    <meta property="fb:app_id" content="1379446882965224" />

    <meta property="og:locale" content="en_US">
    <meta property="og:title" content="The Unconcealment of Truths" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://aletheia.cthiebaud.com" />
    <meta property="og:description" content="Unconceal the colored bricks to reveal the truth tables." />
    <meta property="og:site_name" content="aletheia.cthiebaud.com" />

    <meta property="og:image" content="https://aletheia.cthiebaud.com/screenshots/iPad10th.png" />
    <meta property="og:image:url" content="https://aletheia.cthiebaud.com/screenshots/iPad10th.png" />
    <meta property="og:image:type" content="image/jpeg" />
    <meta property="og:image:width" content="2732" />
    <meta property="og:image:height" content="2048" />

    <!-- Imports the manifest to represent the web application. A web app must have a manifest to be a PWA. -->
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#f1efe0" />

    <!-- https://realfavicongenerator.net -->
    <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
    <!-- link rel="manifest" href="/favicons/site.webmanifest" -->
    <link rel="mask-icon" href="/favicons/safari-pinned-tab.svg" color="#173f35">
    <link rel="shortcut icon" href="/favicons/favicon.ico">
    <meta name="msapplication-TileColor" content="#f8f7ef">
    <meta name="msapplication-config" content="/favicons/browserconfig.xml">
    <meta name="theme-color" content="#f8f7ef">

    <!-- /* changed by "NODE_ENV=<development|production> node my-build.js" or "npm run <dev\prod>" */ -->
    <link rel="stylesheet" href='/dist/css/bootstrap.min.css'>
    <link rel="stylesheet" href='/dist/css/index.min.css'>
    <link rel="stylesheet" href='/dist/css/timer.min.css'>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@500&family=Victor+Mono&display=swap" rel="stylesheet">
    <!-- BEGIN livejs for test - - >
    <script type="text/javascript" src="https://livejs.com/live.js"></script>
    < ! - - END livejs for test -->
</head>

<body class="">

    <!-- Define the play button svg as a symbol -->
    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
        <symbol id="svg-play" viewBox="0 0 24 24">
            <path
                d="M21.4086 9.35258C23.5305 10.5065 23.5305 13.4935 21.4086 14.6474L8.59662 21.6145C6.53435 22.736 4 21.2763 4 18.9671L4 5.0329C4 2.72368 6.53435 1.26402 8.59661 2.38548L21.4086 9.35258Z" />
        </symbol>
        <symbol id="svg-stop" viewBox="0 0 24 24">
            <path
                d="M21.4086 9.35258C23.5305 10.5065 23.5305 13.4935 21.4086 14.6474L8.59662 21.6145C6.53435 22.736 4 21.2763 4 18.9671L4 5.0329C4 2.72368 6.53435 1.26402 8.59661 2.38548L21.4086 9.35258Z" />
        </symbol>
    </svg>

    <!-- Modal -->
    <div id="resultsModal" class="modal fade" tabindex="-1" aria-labelledby="resultsModalLabel" aria-hidden="true">

        <style>
            #modal-body #results-display {
                display: flex;
                flex-direction: column;
                align-items: center;
            }

            #modal-body #results-display table {
                margin: auto;
                /* Center the table within the container */
            }

            #modal-body #results-display table td:first-child {
                text-align: right;
                padding-right: 5px;
            }

            #modal-body #results-display table td:last-child {
                text-align: left;
                padding-left: 5px;
            }
        </style>

        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="resultsModalLabel">The Unconcealment of Truths</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div id="modal-body" class="modal-body">
                    <h1 id="results-msg"></h1>
                    <div id="results-display">
                        <table>
                            <tr>
                                <td>Elapsed</td>
                                <td><span id="results-elapsed"></span> seconds</td>
                            </tr>
                            <tr>
                                <td>Unconcealed</td>
                                <td><span id="results-unconcealed"></span> out of 32</td>
                            </tr>
                            <tr>
                                <td>Erred</td>
                                <td><span id="results-erred"></span></td>
                            </tr>
                        </table>
                    </div>
                    <div id="play-again" class="float-end">
                        <label for="playAgainButton">Start another game</label>
                        <button id="playAgainButton" type="button" class="btn btn-light timer-container" aria-label="play-again" style="width:36px; height: 36px;">
                            <svg class="timer-not-playing" xmlns="http://www.w3.org/2000/svg">
                                <use xlink:href="#svg-play"></use>
                            </svg>
                        </button>
                    </div>
                </div>
                <div id="modal-footer" class="modal-footer" style="font-size: smaller;">
                    &nbsp;
                </div>
            </div>
        </div>
    </div>

    <div id="con" class="container">
        <div id="alpha-beta" class="p-2 d-flex justify-content-between align-items-start">
            <h1 id="αβ">(A,B)<svg width="32" height="32" preserveAspectRatio="none" viewBox="0 -2 24 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4 6L10.4 6C13.4928 6 16 8.50721 16 11.6L16 18" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    <path d="M16 18.6L12 15" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    <path d="M16 18.6L20 15" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </h1>
            <div id="buttons" class="btn-group btn-group-sm" role="group">

                <!-- BEGIN Button trigger modal for test - - >
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#resultsModal">
                    *
                </button>
                < ! - - END Button trigger modal for test -->

                <input type="checkbox" class="btn-check" id="table-borders" autocomplete="off" aria-label="table-borders toggle">
                <label class="btn btn-outline-light" for="table-borders">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="2 2 20 20">
                        <path stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M3 3h.01M3 12h.01M3 21h.01M3 16.5h.01M3 7.5h.01M7.5 3h.01m-.01 9h.01m-.01 9h.01M16.5 3h.01m-.01 9h.01m-.01 9h.01M12 3h.01M12 12h.01M12 21h.01M12 16.5h.01m-.01-9h.01M21 3h.01M21 12h.01M21 21h.01M21 16.5h.01m-.01-9h.01" />
                    </svg>
                </label>
                <input type="checkbox" class="btn-check" id="ab-axes" autocomplete="off" aria-label="axes toggle">
                <label class="btn btn-outline-light" for="ab-axes">
                    <svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" width="16" height="16" viewBox="0 0 488 488">
                        <path stroke="none"
                            d="M487.9 40.927c-2.35 9.897-13.446 14.868-19.292 22.693-8.157 6.418-16.073 22.787-28.015 13.913-11.227-11.134 11.485-21.639 12.022-27.506H50.433v403.485c7.839-7.427 20.099-25.259 29.798-10.102 2.235 12.49-12.18 18.605-18.785 27.395-7.671 5.32-12.84 18.958-23.914 16.414-11.894-7.987-20.681-20.27-31.428-29.828-17.476-14.372 9.54-28.283 17.755-10.45 8.926 12.934 6.328-1.958 6.57-9.992V40.027c2.392-14.958 20.102-8.657 30.706-10.002h392.76C446.513 22.197 428.589 9.94 443.819.32c12.549-2.226 18.67 12.156 27.468 18.793 5.017 7.223 17.043 11.935 16.613 21.815z" />
                    </svg>
                </label>
                <input type="checkbox" class="btn-check" id="paragraph-breaks" autocomplete="off" aria-label="paragraph-breaks toggle">
                <label class="btn btn-outline-light" for="paragraph-breaks">
                    <svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" width="16" height="16" viewBox="0 0 24 24">

                        <g transform="scale(-1, 1) translate(-24, 0)">
                            <path d="M7 15h15v1H7zm-5 7h20v-1H2zM22 9H12v1h10zm0-6h-5v1h5z" />
                        </g>
                    </svg>
                </label>
                <button id="shuffle-colors" type="button" class="btn btn-outline-light float-end" aria-label="shuffle-colors">
                    <svg width="16" height="16" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 49.7 49.7"
                        xml:space="preserve">
                        <g>
                            <path d="M27,13.85h9v8.964l13.7-9.964L36,2.886v8.964h-9c-7.168,0-13,5.832-13,13c0,6.065-4.935,11-11,11H1c-0.553,0-1,0.447-1,1
                       s0.447,1,1,1h2c7.168,0,13-5.832,13-13C16,18.785,20.935,13.85,27,13.85z M38,6.814l8.3,6.036L38,18.886V6.814z" />
                            <path d="M1,13.85h2c2.713,0,5.318,0.994,7.336,2.799c0.191,0.171,0.43,0.255,0.667,0.255c0.274,0,0.548-0.112,0.745-0.333
                       c0.368-0.412,0.333-1.044-0.078-1.412C9.285,13.025,6.206,11.85,3,11.85H1c-0.553,0-1,0.447-1,1S0.447,13.85,1,13.85z" />
                            <path d="M36,35.85h-9c-2.685,0-5.27-0.976-7.278-2.748c-0.411-0.365-1.044-0.327-1.411,0.089c-0.365,0.414-0.326,1.046,0.089,1.411
                       c2.374,2.095,5.429,3.248,8.601,3.248h9v8.964l13.7-9.964L36,26.886V35.85z M38,30.814l8.3,6.036L38,42.886V30.814z" />
                        </g>
                    </svg>
                </button>
            </div>
        </div>

        <div id="tables" class="transparent-border center-children"></div>

        <h1 id="aletheia" class="text-center p-2 mb-0 d-flex justify-content-between align-items-end">
            <div id="copyright">
                ©&nbsp;CT
            </div>
            <a href="https://en.wikipedia.org/wiki/Aletheia" target="_wikipedia">ἀλήθεια</a>
            <!-- github 
                <button id="github" type="button" class="btn btn-sm btn-outline-light float-end" aria-label="github">
                    <svg width="16" height="16" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" stroke="none" clip-rule="evenodd"
                        d="M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z"
                        transform="scale(64)" />
                    </svg>
                </button>
            -->
            <button id="infos" type="button" class="btn btn-sm btn-outline-light float-end" aria-label="infos">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 32 32">
                    <path
                        d="M18 23h-1v-8.938c0-.011-.003-.021-.003-.031S17 14.011 17 14a1 1 0 0 0-1-1h-2a1 1 0 0 0 0 2h1v8h-1a1 1 0 0 0 0 2h4a1 1 0 0 0 0-2zm-2-12a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm0-11C7.164 0 0 7.163 0 16s7.163 16 16 16 16-7.163 16-16S24.837 0 16 0zm0 30.031c-7.72 0-14-6.312-14-14.032s6.28-14 14-14 14 6.28 14 14-6.28 14.032-14 14.032z" />
                </svg>
            </button>
        </h1>
        <style>
            #nav.navbar #controls {
                display: flex;
                justify-content: center;
                align-items: center;
            }

            #nav.navbar #controls .left,
            #nav.navbar #controls .right {
                width: 80px;
                background-color: transparent;
            }

            #nav.navbar #controls .center {
                width: 100px;
                text-align: center;
            }

            #nav.navbar #controls #tortoise-hare-achilles.carousel {
                display: flex;
                justify-content: center;
                align-items: center;
            }

            #nav.navbar #controls #tortoise-hare-achilles.carousel .carousel-item {
                transition: none;
            }

            #nav.navbar #controls #tortoise-hare-achilles.carousel .carousel-item>div {
                display: flex;
                justify-content: center;
            }

            #nav.navbar #controls #tortoise-hare-achilles.carousel .carousel-item img {
                width: auto;
                height: 30px;
            }

            #nav.navbar #controls #tortoise-hare-achilles.carousel .carousel-control-next-icon,
            #nav.navbar #controls #tortoise-hare-achilles.carousel .carousel-control-prev-icon {
                filter: invert(1);
            }
        </style>
        <nav id="nav" class="navbar fixed-bottom">
            <div id="controls" class="container-fluid">

                <div id="tortoise-hare-achilles" class="left carousel carousel-fade" data-bs-touch="false">
                    <div class="carousel-indicators" style="display: none;"> <!--  -->
                        <button type="button" data-bs-target="#tortoise-hare-achilles" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                        <button type="button" data-bs-target="#tortoise-hare-achilles" data-bs-slide-to="1" aria-label="Slide 2"></button>
                        <button type="button" data-bs-target="#tortoise-hare-achilles" data-bs-slide-to="2" aria-label="Slide 3"></button>
                    </div>
                    <div class="carousel-inner">
                        <div id="tortoise" data-time="120" class="carousel-item active" data-bs-interval="0">
                            <div>
                                <img src="/assets/svg/tortoise-fill-svgrepo-com.svg">
                            </div>
                        </div>
                        <div id="hare" data-time="60" class="carousel-item" data-bs-interval="0">
                            <div>
                                <img src="/assets/svg/hare-fill-svgrepo-com.svg">
                            </div>
                        </div>
                        <div id="achilles" data-time="30" class="carousel-item" data-bs-interval="0">
                            <div>
                                <img src="/assets/svg/ancient-greek-helmet-1-svgrepo-com.svg">
                            </div>
                        </div>
                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#tortoise-hare-achilles" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#tortoise-hare-achilles" data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>
                <!-- ########################## -->
                <div class="center compte-à-rebours victor-mono-400"></div>
                <!-- ########################## -->
                <div class="right" style="width: 80px;">
                    <button id="play" type="button" class="btn btn-light timer-container" aria-label="play" disabled style="width:36px; height: 36px; margin: auto;">
                        <!-- div class="timer-not-playing">⏵</!-->
                        <svg class="timer-not-playing" xmlns="http://www.w3.org/2000/svg">
                            <use xlink:href="#svg-play"></use>
                        </svg>
                        <div class="timer-playing">
                            <!-- div class="compte-à-rebours"></!-->
                            <svg viewBox="4 4 92 92" xmlns="http://www.w3.org/2000/svg">

                                <g transform="rotate(-90 50 50)">
                                    <circle id="innerCircle1" cx="50" cy="50" r="55" stroke="rgba(23, 63, 53, .25)" stroke-width="46" fill="none" />
                                    <circle id="innerCircle2" cx="50" cy="50" r="40" stroke="rgba(23, 63, 53, .666)" stroke-width="0" fill="none" />
                                </g>
                                <!-- Black square with rounded corners centered -->
                                <rect x="34" y="34" width="32" height="32" rx="5" ry="5" fill="black" />
                            </svg>
                        </div>
                    </button>
                </div>
            </div>
        </nav>

    </div>
    <script>
        /* BEGIN comment for dev */
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/service-worker.js')
                .then((registration) => {
                    console.log('Service Worker registered with scope:', registration.scope)
                })
                .catch((error) => {
                    console.error('Service Worker registration failed:', error)
                })
        }
        /* END comment for dev */
    </script>
    <script type="module">
        import { Modal as bsModal } from 'https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/+esm'
        import { Carousel as bsCarousel } from 'https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/+esm'
        import hammerjs from 'https://cdn.jsdelivr.net/npm/hammerjs@2.0.8/+esm'
        import tinycolor2 from 'https://cdn.jsdelivr.net/npm/tinycolor2@1.6.0/+esm'

        /* changed by "NODE_ENV=<development|production> node my-build.js" or "npm run <dev|prod>" */
        import { Timer } from './dist/js/TimerClass.min.js'

        let paragraphBreaks = false // true //

        class ResultProperty {
            constructor(value) {
                this._value = value
            }

            // Getter for value
            get value() {
                return this._value
            }

            // Setter for value
            set value(newValue) {
                if (typeof newValue === 'number') {
                    this._value = newValue
                } else {
                    console.error('Value must be a number')
                }
            }

            // Method to increment value
            increment() {
                const previous = this._value
                this._value += 1
                return previous
            }
        }

        class Results {
            constructor() {
                this.reset()
            }

            reset() {
                this._elapsed = new ResultProperty(1)
                this._erred = new ResultProperty(0)
                this._revealed = new ResultProperty(0)
            }

            // Getter for elapsed
            get elapsed() {
                return this._elapsed
            }

            // Getter for erred
            get erred() {
                return this._erred
            }

            // Getter for unconcealed
            get unconcealed() {
                return this._revealed
            }
        }

        class CompteARebours {
            formatDuration(durationInSeconds) {
                // Ensure duration is within the range of 30 seconds to 2 minutes
                if (durationInSeconds > 120) {
                    throw new Error('Duration must be under 2 minutes');
                }

                // Calculate minutes and seconds
                var minutes = Math.floor(durationInSeconds / 60);
                var seconds = durationInSeconds % 60;

                // Format the time
                var formattedTime = '<span style="color: transparent">00</span>' + minutes + '′' + (seconds < 10 ? '0' : '') + seconds + '″';

                return formattedTime;
            }

            display(duration) {
                const darkenedRed = tinycolor2('#ff0000').darken(duration).toString("hex6")

                Array.from(document.getElementsByClassName("compte-à-rebours")).forEach(element => element.innerHTML = `<span style="color: ${darkenedRed}">${this.formatDuration(duration)}</span>`);
            }

            reset() {
                this.display(Number(document.querySelector('.carousel-item.active').dataset.time))
            }
        }

        let player = null
        class Player {
            constructor() {
                this.results = new Results()
                const resultsModal = document.getElementById('resultsModal')
                resultsModal.addEventListener('hidden.bs.modal', event => {
                    player.stop()
                })
                this._playing = false
                this._timer = new Timer(120, 'play', this.ready, this.tick, this.expired, this.afterTimerClosed)
                this._timer.loadResources()
                this.compteARebours = new CompteARebours()
                this.tortoiseHareAchilles = new bsCarousel(document.getElementById('tortoise-hare-achilles'), {
                    interval: 0,
                    touch: false
                })
                document.getElementById('tortoise-hare-achilles').addEventListener('slid.bs.carousel', event => {
                    this.compteARebours.reset()
                })

            }

            stopTimerShowResultsThenCloseTimer(msg, results) {
                // stop number drawing
                clearInterval(player.showNumber)
                // stop timer
                player._timer.stop()
                document.getElementById('results-msg').innerHTML = msg
                document.getElementById('results-elapsed').innerHTML = results.elapsed.value - 2
                document.getElementById('results-unconcealed').innerHTML = results.unconcealed.value
                document.getElementById('results-erred').innerHTML = results.erred.value !== 0 ? results.erred.value : '∅'
                const currentDate = new Date()
                const options = {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: 'numeric',
                    minute: 'numeric',
                    // second: 'numeric',
                    // timeZoneName: 'short',
                }
                const formattedDate = currentDate.toLocaleString('en-US', options)
                document.getElementById('modal-footer').innerHTML = formattedDate
                // show results
                let resultsModal = new bsModal(document.getElementById('resultsModal'))
                resultsModal.show() // will close timer when dismissed
            }

            ready() {
                document.getElementById("play").style.visibility = 'visible'
                document.getElementById("play").disabled = false
                player.compteARebours.reset()
            }

            tick(totalTime, ticks) {
                /*
                function showCountDown(elapsed) {
                    const remaining = totalTime - elapsed
                    const darkenedRed = tinycolor2('#ff0000').darken(remaining).toString("hex6")

                    Array.from(document.getElementsByClassName("compte-à-rebours")).forEach(element => element.innerHTML = `<span style="color: ${darkenedRed}">${remaining}</span>`);
                }
                showCountDown(ticks)
                */
                player.compteARebours.display(totalTime - ticks)
                player.results.elapsed.increment()
            }

            expired() {
                setTimeout(() => {
                    let msg
                    if (player.results.erred.value === 0 && player.results.unconcealed.value === 0) {
                        player.boredom()
                        msg = `Rather quiet today, isn't it?`
                    } else {
                        player.fail()
                        msg = `Oops! Time's up!`
                    }
                    player.stopTimerShowResultsThenCloseTimer(msg, player.results)
                }, 100)
            }

            abort() {
                setTimeout(() => {
                    let msg
                    msg = `You stopped!`
                    player.stopTimerShowResultsThenCloseTimer(msg, player.results)
                }, 100)
            }

            victory() {
                setTimeout(() => {
                    let msg
                    if (player.results.erred.value === 32 && player.results.unconcealed.value === 0) {
                        player.guitar()
                        msg = `Ooooh ... Subtle!`
                    } else if (player.results.erred.value === 0 && player.results.unconcealed.value === 32) {
                        player.tada()
                        msg = `You won!`
                    } else if (player.results.erred.value >= 28 && player.results.unconcealed.value === 32) {
                        player.boo()
                        msg = `You cheated?!`
                    } else {
                        player.completed_with_errors()
                        msg = `Nicely done, but you can do better.`
                    }
                    player.stopTimerShowResultsThenCloseTimer(msg, player.results)
                }, 100)
            }

            get playing() {
                return this._playing && this._timer.timerId != null
            }

            set playing(value) {
                this._playing = value
                if (this._playing) {
                    document.getElementById('play').classList.add('playing')
                } else {
                    document.getElementById('play').classList.remove('playing')
                }
            }

            coin() {
                this._timer.coin.play()
            }

            tada() {
                this._timer.tada.play()
            }

            laughs() {
                this._timer.laughs.play()
                this.results.erred.increment()
            }

            fail() {
                this._timer.fail.play()
            }

            completed_with_errors() {
                this._timer.completed_with_errors.play()
            }

            boo() {
                this._timer.boo.play()
            }

            guitar() {
                this._timer.guitar.play()
            }

            boredom() {
                this._timer.boredom.play()
            }

            start() {
                if (this.playing) return
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth' // Use 'smooth' for smooth scrolling
                })
                document.querySelectorAll('#tables td').forEach(elem => {
                    elem.classList.add('translucent')
                })
                document.getElementById('tortoise-hare-achilles').style.opacity = '.5'
                document.querySelectorAll('#tortoise-hare-achilles button').forEach(button => {
                    button.disabled = true
                })
                this._timer.initializeAudio().then(() => {
                    const totalTime = Number(document.querySelector('.carousel-item.active').dataset.time)
                    this._timer.start(totalTime)
                }).catch((error) => {
                    console.log('Error initializing audio context', error)
                    document.querySelectorAll('#tables td').forEach(elem => {
                        elem.classList.remove('translucent')
                    })
                }).finally(() => {
                    document.getElementById("shuffle-colors").disabled = true
                    document.getElementById("paragraph-breaks").disabled = true
                })
                this.results.reset()
                this.playing = true
            }
            afterTimerClosed() {
                document.getElementById("shuffle-colors").disabled = false
                document.getElementById("paragraph-breaks").disabled = false
                document.getElementById('play').classList.remove('playing')
                document.querySelectorAll('#tables td.false').forEach(elem => { elem.classList.add('translucent') })
                document.querySelectorAll('#tables td.true').forEach(elem => { elem.classList.remove('translucent') })
            }
            stop() {
                // if (!this.playing) return
                this.compteARebours.reset()
                document.getElementById('tortoise-hare-achilles').style.opacity = '1'
                document.querySelectorAll('#tortoise-hare-achilles button').forEach(button => {
                    button.disabled = false
                })
                this._timer.stop()
                this._timer.close()
                this.playing = false
            }
        }
        player = new Player()

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1))
                    ;[array[i], array[j]] = [array[j], array[i]]
            }
        }

        function rotateArray(arr, offset) {
            if (offset == 0) return arr
            const n = arr.length
            const rotated = arr.slice()

            for (let i = 0; i < n; i++) {
                const newPosition = (i + offset) % n
                rotated[newPosition] = arr[i]
            }

            return rotated
        }

        function shuffleNoAdjacentDuplicates(array) {
            const n = array.length
            const shuffledArray = array.slice()

            let previousValue = null
            for (let i = n - 1; i > 0; i--) {
                const possibles = Array.from({ length: i + 1 }, (_, index) => index)
                let world = possibles
                if (previousValue !== null) {
                    world = possibles.filter(index => shuffledArray[index] !== previousValue)
                }

                let pos
                if (world.length !== 0) {
                    // Pick a random element in the world of possibles
                    const p = Math.floor(Math.random() * world.length)
                    pos = world[p]
                } else {
                    // Pick a random element in the array
                    pos = Math.floor(Math.random() * i)
                }

                previousValue = shuffledArray[pos]

                    // Swap element at position pos with element at position i
                    ;[shuffledArray[i], shuffledArray[pos]] = [shuffledArray[pos], shuffledArray[i]]
            }

            const randomPosition = Math.floor(Math.random() * n)
            return rotateArray(shuffledArray, randomPosition)
        }

        function setCellWidth(larger) {
            /* 2*52 + 18 == 2*61 == 122 */
            let cellWidth = '61px'
            if (!larger) {
                cellWidth = '52px'
            }
            document.documentElement.style.setProperty('--cell-width_and_height', cellWidth)
            document.documentElement.style.setProperty('--header-width_and_height', '18px')
            document.documentElement.style.setProperty('--border-color', '#215c4d40')
        }

        function toggleElementsVisibility(elements, displayValueWhenVisible) {
            let display = null
            for (let tag of elements) {
                if (display == null) {
                    display = tag.style.display !== displayValueWhenVisible ? displayValueWhenVisible : 'none'
                }
                tag.style.display = display
            }
            return display
        }

        const 𝛗 = Symbol('private')
        const 𝛗2 = Symbol('private2')

        class Axes {
            constructor() {
                this[𝛗] = [null, true, false]
                this.visible = false
                setCellWidth(!this.visible)
            }
            iterate(iterator) {
                this[𝛗].forEach(iterator)
            }
            applyVisibility() {
                ((thElements) => {
                    for (let thElement of thElements) {
                        thElement.style.display = this.visible ? "table-cell" : "none"
                    }
                })(document.getElementsByTagName('th'))
            }
            toggleVisibility() {
                const display = toggleElementsVisibility(document.getElementsByTagName('th'), 'table-cell')
                this.visible = display === 'table-cell'
                setCellWidth(!this.visible)
            }
        }
        let axes = new Axes()

        class Colors {
            constructor() {
                let colors = [
                    '#F4F4F4',
                    '#FAC80A',
                    '#B40000',
                    '#00852B',
                    '#1E5AA8',
                    '#8A928D',
                    '#ABD9FF',
                    '#91501C',
                ]
                this.colors = colors.concat(colors)
                this.shuffle()
            }

            colorFalse = 'transparent'
            colorTrue = '#545955'
            currentColorIndex = 0
            nextColor() {
                const currentColor = this.colors[this.currentColorIndex++]
                this.currentColorIndex %= this.colors.length
                if (this.currentColorIndex === 0) {
                    this.shuffle()
                }
                return currentColor
            }
            shuffle() {
                this.colors = shuffleNoAdjacentDuplicates(this.colors)
            }
        }
        const colors = new Colors()

        class OneOrTwoColors {
            constructor(color1, color2) {
                this.c = 0
                this.colors = [color1]
                if (color2) {
                    this.colors.push(color2)
                }
            }
            next() {
                const color = this.colors[this.c]
                this.c = (this.c + 1) % this.colors.length
                return color
            }
        }

        class Functions {
            constructor() {
                this[𝛗] = [
                    0,
                    'false',
                    1,
                    'α & β',
                    'α & !β',
                    '!α & !β',
                    '!α & β',
                    2,
                    'α',
                    'β',
                    '!α',
                    '!β',
                    'α & β | !α & !β', // look for new RegExp('α', ...) ~40 lines below before changing these two lines. 
                    '!α & β | α & !β', // It assumes there are 2 'α' chars to enable various colors for the bricks.
                    3,
                    'α | β',
                    'α | !β',
                    '!α | !β',
                    '!α | β',
                    4,
                    'true',
                ]
                this[𝛗2] = this[𝛗].slice(0)
                this.display = {
                }
                const negationMap = {
                    '!α': "<span class='negation'>A</span>",
                    '!β': "<span class='negation'>B</span>"
                };
                this[𝛗].forEach(item => {
                    if (typeof item === 'string') {
                        this.display[item] = item.replace(/(!?)α|(!?)β/g, (match, negationA, negationB) => {
                            if (negationA === '!') {
                                return negationMap['!α'];
                            } else if (negationB === '!') {
                                return negationMap['!β'];
                            } else {
                                return match === 'α' ? 'A' : 'B';
                            }
                        });
                    }
                });
            }

            iterate(iterator) {
                this[𝛗2].forEach(iterator)
            }

            color(f) {
                if (f === 'false') {
                    return new OneOrTwoColors(colors.colorFalse)
                }
                if (f === 'true') {
                    return new OneOrTwoColors(colors.colorTrue)
                }
                if ((f.match(new RegExp('α', "g")) || []).length === 2) {
                    return new OneOrTwoColors(colors.nextColor(), colors.nextColor())
                }
                return new OneOrTwoColors(colors.nextColor())
            }
            shuffle() {
                shuffleArray(this[𝛗2])
            }
            unshuffle() {
                this[𝛗2] = this[𝛗].slice(0)
            }
        }
        const functions = new Functions()

        class Blender {
            constructor() {
                this.previousElement = null
            }

            blend(html, elementID) {
                if (this.previousElement === null) {
                    document.getElementById('tables').innerHTML = html
                } else {
                    this.previousElement.insertAdjacentHTML("afterend", html)
                }
                this.previousElement = document.getElementById(elementID)
            }
        }

        function doIt() {

            if (player.playing) return

            const blender = new Blender()

            functions.iterate((func, index) => {

                const elementID = `element${index}`
                if (typeof func === 'number') {
                    const html = `<div id="${elementID}" class="separator-container" style="display: ${paragraphBreaks ? 'flex' : 'none'};">
        <span class="separator-line separator-line-left"></span>
        <span class="separator-text">${func}</span>
        <span class="separator-line separator-line-right"></span>
    </div>
    `
                    blender.blend(html, elementID)

                } else {
                    const theadID = `thead${index}`
                    const tbodyID = `tbody${index}`
                    const template = `<div id="${elementID}">
        <table class="table inline table-sm caption-top table-borderless">
            <caption class="text-center">${functions.display[func]}</caption>
            <thead id="${theadID}"></thead>
            <tbody id="${tbodyID}"></tbody>
        </table>
    </div>
    `
                    blender.blend(template, elementID)

                    let backgroundcolors = functions.color(func)

                    axes.iterate(rowElem => {
                        const row = document.createElement("tr")
                        axes.iterate(colElem => {
                            const col = document.createElement(rowElem === null || colElem === null ? "th" : "td")
                            if (colElem === null) {
                                if (rowElem === null) {
                                    col.innerHTML = '<div class="diagonal-line">&nbsp;</div>'
                                } else {
                                    col.innerHTML = `<div class="vertical-text">${rowElem}</div>`
                                }
                            } else {
                                if (rowElem === null) {
                                    col.innerHTML = `${colElem}`
                                } else {
                                    const α = rowElem
                                    const β = colElem
                                    const result = eval(func)
                                    col.classList.add(result ? 'true' : 'false')
                                    if (result) {
                                        col.style.backgroundColor = backgroundcolors.next()
                                        col.style.color = tinycolor2(col.style.backgroundColor).darken(3).toString("hex6")
                                        col.innerHTML = '●' // '○' // 
                                    } else {
                                        col.style.backgroundColor = colors.colorFalse
                                        col.innerHTML = '❌'
                                        col.classList.add('translucent')
                                    }
                                }
                            }
                            row.appendChild(col)
                        })
                        document.getElementById(rowElem === null ? theadID : tbodyID).appendChild(row)
                    })
                    axes.applyVisibility()
                }
            })

            document.getElementById("aletheia").style.visibility = 'visible'

            document.querySelectorAll('#tables td').forEach(elem => {

                elem.addEventListener('click', clickEvent => {
                    clickEvent.preventDefault()
                    clickEvent.stopPropagation()
                    if (!player.playing) return
                    if (player.playing) {
                        if (elem.classList.contains('translucent')) {
                            elem.classList.remove('translucent')
                            if (elem.classList.contains('true')) {
                                player.results.unconcealed.increment()

                                function checkDescendantsClasses(element, classA, classX, classY) {
                                    // Find the nearest ancestor with class A
                                    let ancestorWithClassA = findAncestor(element, classA)

                                    if (!ancestorWithClassA) {
                                        return false
                                    }

                                    // Find all descendants of the ancestor with class X
                                    let elementsWithClassX = ancestorWithClassA.getElementsByClassName(classX)

                                    // Convert the HTMLCollection to an array for easier iteration
                                    let elementsArray = Array.from(elementsWithClassX)

                                    // Check if all descendants with class X also have class Y
                                    let allDescendantsHaveClassY = elementsArray.every(function (descendant) {
                                        return !descendant.classList.contains(classY)
                                    })

                                    return allDescendantsHaveClassY
                                }

                                // Helper function to find the nearest ancestor with a specific class
                                function findAncestor(element, className) {
                                    while ((element = element.parentElement)) {
                                        if (element.classList.contains(className)) {
                                            return element
                                        }
                                    }
                                    return null
                                }

                                if (checkDescendantsClasses(elem, 'table', 'true', 'translucent')) {
                                    player.coin()
                                }
                            } else {
                                player.laughs()
                            }
                        }
                    }
                    let remainingTrue = document.querySelectorAll('#tables td.true.translucent').length
                    let remainingFalse = document.querySelectorAll('#tables td.false.translucent').length
                    if ((remainingTrue === 0)
                        ||
                        (remainingFalse === 0 && remainingTrue === 32)) {
                        player.victory()
                    }
                })

                const captions = document.getElementsByTagName('caption')
                Array.from(captions).forEach(function (caption, index) {
                    const hammerpress = new hammerjs(caption, {
                        press: {
                            time: 0 // Set the time option for the 'press' event to 10 milliseconds
                        }
                    })
                    hammerpress.on('press', function (e) {
                        if (!player.playing) return
                        // When trigger element is tapped, show the target element
                        console.log("PRESSED", e, e.target.parentNode)
                        e.target.parentNode.classList.add("hint")
                    })

                    hammerpress.on('pressup', function (e) {
                        if (!player.playing) return
                        // When the press on the trigger element is released, hide the target element
                        console.log("RELEASED", e)
                        Array.from(captions).forEach(function (caption2, index) {
                            caption2.parentNode.classList.remove("hint")
                        })
                    })
                })
            })
        }

        window.addEventListener("load", loadEvent => {

            doIt()

            function mega_shuffle() {
                if (player.playing) return
                if (paragraphBreaks) return
                functions.shuffle()
                colors.shuffle()
                doIt()
            }
            function mega_reorder() {
                if (player.playing) return
                if (paragraphBreaks) return
                functions.unshuffle()
                colors.shuffle()
                doIt()
            }

            const theTables = document.getElementById("tables")
            const hammertime = new hammerjs(theTables)

            hammertime.on('swiperight', function () {
                mega_shuffle()
            })
            hammertime.on('swipeleft', function () {
                mega_reorder()
            })

            document.getElementById("ab-axes").addEventListener('click', clickEvent => {
                clickEvent.stopPropagation()
                axes.toggleVisibility()
            })

            document.getElementById("paragraph-breaks").addEventListener('click', clickEvent => {
                clickEvent.stopPropagation()
                paragraphBreaks = !paragraphBreaks
                toggleElementsVisibility(document.querySelectorAll('div.separator-container'), 'flex')
                if (paragraphBreaks) {
                    functions.unshuffle()
                    document.getElementById("shuffle-colors").disabled = true
                    theTables.classList.remove("center-children")
                    doIt()
                } else {
                    theTables.classList.add("center-children")
                    document.getElementById("shuffle-colors").disabled = false
                }
            })

            document.getElementById("table-borders").addEventListener('click', clickEvent => {
                clickEvent.stopPropagation()
                if (theTables.classList.contains("transparent-border")) {
                    theTables.classList.remove("transparent-border")
                } else {
                    theTables.classList.add("transparent-border")
                }
            })

            document.getElementById("shuffle-colors").addEventListener('click', clickEvent => {
                clickEvent.preventDefault()
                clickEvent.stopPropagation()
                mega_shuffle()
            })
            /*
            document.getElementById("github").addEventListener('click', clickEvent => {
                clickEvent.preventDefault()
                clickEvent.stopPropagation()
                window.open("https://github.com/cthiebaud/truth", "_github")
            })
            */
            document.getElementById("infos").addEventListener('click', clickEvent => {
                clickEvent.preventDefault()
                clickEvent.stopPropagation()
                window.open("/showdown.html?/HOWTO.md", "_howto")
            })

            {
                function playToggle(event) {
                    event.preventDefault()
                    event.stopPropagation()
                    if (player.playing) {
                        player.abort()
                    } else {
                        player.start()
                    }
                }
                document.getElementById("play").addEventListener('click', clickEvent => {
                    playToggle(clickEvent)
                    document.activeElement?.blur()
                })
                document.addEventListener('keydown', function (keyboardEvent) {
                    if (event.code === 'Space') {
                        playToggle(keyboardEvent)
                    }
                    if (event.code === 'Escape') {
                        if (player.playing) {
                            player.stop()
                        }
                    }
                })
            }

            document.getElementById("play-again").addEventListener('click', clickEvent => {
                clickEvent.preventDefault()
                clickEvent.stopPropagation()
                player.stop()
                mega_shuffle()
                let resultsModal = document.getElementById('resultsModal')
                resultsModal.addEventListener('hidden.bs.modal', event => {
                    setTimeout(() => {
                        player.start()
                    }, 100)
                }, { once: true, })
                let modal = bsModal.getInstance(resultsModal)
                modal.hide()
            })

                ;[...document.getElementsByClassName('carousel-item')].forEach(carouselItem => {
                    carouselItem.addEventListener('click', clickEvent => {
                        clickEvent.preventDefault()
                        clickEvent.stopPropagation()
                        if (player.playing) return
                        player.tortoiseHareAchilles.next()
                    })
                });

        })

    </script>
</body>

</html>